<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payroll - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-payroll.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <!-- Navigation links rendered by Navigation.init() -->
        </div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <span class="current">Payroll</span>
                </nav>
                <div class="hrms-header-row">
                    <!-- Hamburger Toggle Button -->
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation menu">
                        <!-- Hamburger icon (shown when sidebar closed) -->
                        <span class="hamburger-icon">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </span>
                        <!-- Left arrow icon (shown when sidebar open) -->
                        <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <path d="M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h1>Payroll Management</h1>
                </div>
                <div class="active-tab-title" id="activeTabTitle">
                    <span class="tab-indicator"></span>
                    <span id="activeTabName">Salary Components</span>
                </div>
            </div>
            <div class="header-actions" id="adminActions" style="display: none;">
                <!-- Admin actions for payroll processing -->
            </div>
        </div>

        <!-- Sidebar Overlay (hidden by CSS) -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Sidebar + Content Layout -->
        <div class="payroll-layout">
            <!-- Collapsible Sidebar Navigation -->
            <aside class="payroll-sidebar" id="payrollSidebar">
                <div class="sidebar-header">
                    <h3>Payroll</h3>
                </div>
                <nav class="sidebar-nav">
                    <!-- Setup Section -->
                    <div class="nav-group" data-group="setup">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                    <path d="M2 17l10 5 10-5"></path>
                                    <path d="M2 12l10 5 10-5"></path>
                                </svg>
                                Setup
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn active" data-tab="salary-components" id="salaryComponentsTab">
                                <span class="nav-number">1</span><span class="nav-label">Salary Components</span>
                            </button>
                            <button class="sidebar-btn" data-tab="location-taxes" id="locationTaxesTab">
                                <span class="nav-number">2</span><span class="nav-label">Location Taxes</span>
                            </button>
                            <button class="sidebar-btn" data-tab="salary-structures" id="salaryStructuresTab">
                                <span class="nav-number">3</span><span class="nav-label">Salary Structures</span>
                            </button>
                        </div>
                    </div>

                    <!-- Employee Section -->
                    <div class="nav-group" data-group="employee">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                Employee
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn" data-tab="loans" id="loansTab">
                                <span class="nav-number">4</span><span class="nav-label">Loans & Advances</span>
                            </button>
                            <button class="sidebar-btn" data-tab="voluntary-deductions" id="voluntaryDeductionsTab">
                                <span class="nav-number">5</span><span class="nav-label">Voluntary Deductions</span>
                            </button>
                            <button class="sidebar-btn" data-tab="adjustments" id="adjustmentsTab">
                                <span class="nav-number">6</span><span class="nav-label">Adjustments</span>
                            </button>
                            <button class="sidebar-btn" data-tab="arrears" id="arrearsTab">
                                <span class="nav-number">7</span><span class="nav-label">Arrears</span>
                            </button>
                        </div>
                    </div>

                    <!-- Processing Section -->
                    <div class="nav-group" data-group="processing">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                </svg>
                                Processing
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn" data-tab="payroll-drafts" id="payrollDraftsTab">
                                <span class="nav-number">8</span><span class="nav-label">Payroll Drafts</span>
                            </button>
                            <button class="sidebar-btn" data-tab="payroll-runs" id="payrollRunsTab">
                                <span class="nav-number">9</span><span class="nav-label">Finalized Runs</span>
                            </button>
                            <button class="sidebar-btn" data-tab="all-payslips" id="allPayslipsTab">
                                <span class="nav-number">10</span><span class="nav-label">All Payslips</span>
                            </button>
                            <button class="sidebar-btn" data-tab="salary-reports" id="salaryReportsTab">
                                <span class="nav-number">11</span><span class="nav-label">Salary Reports</span>
                            </button>
                        </div>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="payroll-content">
        <!-- Salary Components Tab -->
        <div class="tab-content active" id="salary-components">
            <div class="filters-bar">
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="componentSearch" placeholder="Search components...">
                </div>
                <div class="filter-group">
                    <select id="componentType" class="form-select">
                        <option value="">All Types</option>
                        <option value="earning">Earnings</option>
                        <option value="deduction">Deductions</option>
                    </select>
                </div>
                <div class="toggle-wrapper" onclick="toggleShowInactiveComponents()">
                    <input type="checkbox" id="showInactiveComponents">
                    <span>Show Inactive</span>
                </div>
                <button class="btn btn-primary" onclick="showCreateComponentModal()" id="createComponentBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Component
                </button>
            </div>

            <div class="component-sections">
                <div class="component-section">
                    <h3>Earnings</h3>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Component Name</th>
                                    <th>Code</th>
                                    <th>Type</th>
                                    <th>Value</th>
                                    <th>Taxable</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="earningsTable">
                                <tr class="empty-state">
                                    <td colspan="7"><p>No earnings components</p></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="component-section">
                    <h3>Deductions</h3>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Component Name</th>
                                    <th>Code</th>
                                    <th>Type</th>
                                    <th>Value</th>
                                    <th>Pre-Tax</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="deductionsTable">
                                <tr class="empty-state">
                                    <td colspan="7"><p>No deduction components</p></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location Taxes Tab -->
        <div class="tab-content" id="location-taxes">
            <!-- Sub-tabs for Tax Types and Office Tax Rules -->
            <div class="sub-tabs">
                <button class="sub-tab-btn active" data-subtab="tax-types">Tax Types</button>
                <button class="sub-tab-btn" data-subtab="office-tax-rules">Office Tax Rules</button>
            </div>

            <!-- Tax Types Sub-tab -->
            <div class="sub-tab-content active" id="tax-types">
                <div class="filters-bar">
                    <div class="search-box-modern">
                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="taxTypeSearch" placeholder="Search tax types...">
                    </div>
                    <label class="toggle-inactive-label">
                        <input type="checkbox" id="showInactiveTaxTypes" onchange="loadTaxTypes()">
                        <span>Show Inactive</span>
                    </label>
                    <button class="btn btn-primary" onclick="showCreateTaxTypeModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Tax Type
                    </button>
                </div>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tax Name</th>
                                <th>Code</th>
                                <th>Deduction From</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="taxTypesTable">
                            <tr class="empty-state">
                                <td colspan="6">
                                    <div class="empty-message">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                            <path d="M4 7h16M4 12h16M4 17h10"></path>
                                        </svg>
                                        <p>No tax types configured</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Office Tax Rules Sub-tab -->
            <div class="sub-tab-content" id="office-tax-rules">
                <div class="filters-bar">
                    <div class="search-box-modern">
                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="taxRuleSearch" placeholder="Search tax rules...">
                    </div>
                    <div class="filter-group">
                        <select id="taxRuleOffice" class="form-select" onchange="loadOfficeTaxRules()">
                            <option value="">All Offices</option>
                        </select>
                        <select id="taxRuleTaxType" class="form-select" onchange="loadOfficeTaxRules()">
                            <option value="">All Tax Types</option>
                        </select>
                    </div>
                    <label class="toggle-inactive-label">
                        <input type="checkbox" id="showInactiveTaxRules" onchange="loadOfficeTaxRules()">
                        <span>Show Inactive</span>
                    </label>
                    <button class="btn btn-secondary" onclick="showCopyTaxRulesModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy Rules
                    </button>
                    <button class="btn btn-secondary" onclick="showTaxPreviewModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                        Preview Tax
                    </button>
                    <button class="btn btn-primary" onclick="showCreateTaxRuleModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Tax Rule
                    </button>
                </div>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Office</th>
                                <th>Tax Type</th>
                                <th>Rule Name</th>
                                <th>Jurisdiction</th>
                                <th>Calculation</th>
                                <th>Amount/Rate</th>
                                <th>Effective From</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="taxRulesTable">
                            <tr class="empty-state">
                                <td colspan="9">
                                    <div class="empty-message">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                        </svg>
                                        <p>No tax rules configured</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Salary Structures Tab -->
        <div class="tab-content" id="salary-structures">
            <!-- Office filter cards for salary structures -->
            <div class="office-structure-status" id="officeStructureStatus">
                <!-- Dynamically populated by JavaScript -->
            </div>

            <div class="filters-bar">
                <div class="filter-group">
                    <select id="structureOfficeFilter" class="form-select">
                        <option value="">All Offices</option>
                    </select>
                </div>
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="structureSearch" placeholder="Search structures...">
                </div>
                <div class="toggle-wrapper" onclick="toggleShowInactiveStructures()">
                    <input type="checkbox" id="showInactiveStructures">
                    <span>Show Inactive</span>
                </div>
                <button class="btn btn-primary" onclick="showCreateStructureModal()" id="createStructureBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Create Structure
                </button>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Office</th>
                            <th>Structure Name</th>
                            <th>Code</th>
                            <th>Components</th>
                            <th>Employees</th>
                            <th>Default</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="salaryStructuresTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    </svg>
                                    <p>No salary structures defined</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Payroll Drafts Tab -->
        <div class="tab-content" id="payroll-drafts">
            <div class="filters-bar">
                <div class="filter-group">
                    <div class="month-picker-container" id="draftMonthPicker"></div>
                    <select id="draftOffice" class="form-select" onchange="loadPayrollDrafts()">
                        <option value="">All Offices</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="openCreateDraftModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Create Draft
                </button>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Draft Name</th>
                            <th>Period</th>
                            <th>Office</th>
                            <th>Employees</th>
                            <th>Gross Amount</th>
                            <th>Net Amount</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="payrollDraftsTable">
                        <tr class="empty-state">
                            <td colspan="9">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                    <p>No payroll drafts found</p>
                                    <p class="hint">Create a new draft to start payroll processing</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Payroll Runs Tab (Finalized) -->
        <div class="tab-content" id="payroll-runs">
            <div class="filters-bar">
                <div class="filter-group">
                    <div class="month-picker-container" id="runMonthPicker"></div>
                    <select id="runOffice" class="form-select" onchange="loadPayrollRuns()">
                        <option value="">All Offices</option>
                    </select>
                </div>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Run ID</th>
                            <th>Period</th>
                            <th>Office</th>
                            <th>Employees</th>
                            <th>Gross Amount</th>
                            <th>Net Amount</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="payrollRunsTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    <p>No finalized payroll runs found</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Loans Tab -->
        <div class="tab-content" id="loans">
            <div class="filters-bar">
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="loanSearch" placeholder="Search loans...">
                </div>
                <div class="filter-group">
                    <select id="loanStatus" class="form-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="showCreateLoanModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Apply for Loan
                </button>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Loan Type</th>
                            <th>Principal Amount</th>
                            <th>EMI</th>
                            <th>Balance</th>
                            <th>Start Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="loansTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                    <p>No loans found</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Voluntary Deductions Tab -->
        <div class="tab-content" id="voluntary-deductions">
            <!-- Sub-tabs for VD Types and Enrollments -->
            <div class="sub-tabs">
                <button class="sub-tab-btn active" data-subtab="vd-enrollments" onclick="switchVDSubTab('vd-enrollments')">All Enrollments</button>
                <button class="sub-tab-btn" data-subtab="vd-types" onclick="switchVDSubTab('vd-types')">VD Types</button>
            </div>

            <!-- VD Enrollments Sub-tab -->
            <div class="sub-tab-content active" id="vd-enrollments">
                <div class="filters-bar">
                    <div class="search-box-modern">
                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="vdEnrollmentSearch" placeholder="Search by employee name or code..." oninput="filterVDEnrollments()">
                    </div>
                    <div class="filter-group">
                        <select id="vdEnrollmentStatus" class="form-select" onchange="loadVDEnrollments()">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="pending">Pending Approval</option>
                            <option value="approved">Approved</option>
                            <option value="opted_out">Opted Out</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <select id="vdEnrollmentType" class="form-select" onchange="loadVDEnrollments()">
                            <option value="">All Types</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="showCreateVDEnrollmentModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        New Enrollment
                    </button>
                </div>

                <!-- Summary Stats -->
                <div class="stats-row" id="vdEnrollmentStats">
                    <div class="stat-card">
                        <div class="stat-value" id="vdTotalActive">0</div>
                        <div class="stat-label">Active Enrollments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vdTotalPending">0</div>
                        <div class="stat-label">Pending Approval</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vdTotalMonthly">₹0</div>
                        <div class="stat-label">Total Monthly VD</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vdTotalTypes">0</div>
                        <div class="stat-label">VD Types</div>
                    </div>
                </div>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>VD Type</th>
                                <th>Amount</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="vdEnrollmentsTable">
                            <tr class="empty-state">
                                <td colspan="7">
                                    <div class="empty-message">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                            <line x1="12" y1="18" x2="12" y2="12"></line>
                                            <line x1="9" y1="15" x2="15" y2="15"></line>
                                        </svg>
                                        <p>No voluntary deduction enrollments found</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VD Types Sub-tab -->
            <div class="sub-tab-content" id="vd-types">
                <div class="filters-bar">
                    <div class="search-box-modern">
                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="vdTypeSearch" placeholder="Search VD types..." oninput="filterVDTypes()">
                    </div>
                    <div class="toggle-wrapper" onclick="toggleShowInactiveVDTypes()">
                        <input type="checkbox" id="showInactiveVDTypes">
                        <span>Show Inactive</span>
                    </div>
                    <button class="btn btn-primary" onclick="showCreateVDTypeModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add VD Type
                    </button>
                </div>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Code</th>
                                <th>Description</th>
                                <th>Default Amount</th>
                                <th>Enrollments</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="vdTypesTable">
                            <tr class="empty-state">
                                <td colspan="7">
                                    <div class="empty-message">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                        </svg>
                                        <p>No voluntary deduction types configured</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- All Payslips Tab (HR Admin) -->
        <div class="tab-content" id="all-payslips">
            <div class="filters-bar">
                <div class="filter-group">
                    <div class="month-picker-container" id="allPayslipsMonthPicker"></div>
                    <select id="allPayslipsOffice" class="form-select">
                        <option value="">All Offices</option>
                    </select>
                    <select id="allPayslipsDepartment" class="form-select">
                        <option value="">All Departments</option>
                    </select>
                </div>
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="allPayslipsSearch" placeholder="Search by employee name or code...">
                </div>
                <button class="btn btn-secondary" onclick="loadAllPayslips()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="1 4 1 10 7 10"></polyline>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                    </svg>
                    Refresh
                </button>
            </div>

            <!-- Summary Stats -->
            <div class="stats-row" id="allPayslipsStats">
                <div class="stat-card">
                    <div class="stat-value" id="totalPayslipsCount">0</div>
                    <div class="stat-label">Total Payslips</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalGrossAmount">₹0</div>
                    <div class="stat-label">Total Gross</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalNetAmount">₹0</div>
                    <div class="stat-label">Total Net</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgNetSalary">₹0</div>
                    <div class="stat-label">Avg Net Salary</div>
                </div>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Emp Code</th>
                            <th>Department</th>
                            <th>Month/Year</th>
                            <th>Gross Salary</th>
                            <th>Deductions</th>
                            <th>Net Salary</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="allPayslipsTable">
                        <tr class="empty-state">
                            <td colspan="9">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                        <line x1="1" y1="10" x2="23" y2="10"></line>
                                    </svg>
                                    <p>Select filters and search to find payslips</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Salary Reports Tab -->
        <div class="tab-content" id="salary-reports">
            <!-- Filters Bar -->
            <div class="filters-bar">
                <div class="filter-group">
                    <select id="salaryReportOffice" class="form-select">
                        <option value="">All Offices</option>
                    </select>
                    <select id="salaryReportDepartment" class="form-select">
                        <option value="">All Departments</option>
                    </select>
                </div>
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="salaryReportSearch" placeholder="Search by employee..." onkeyup="filterSalaryReport()">
                </div>
                <button class="btn btn-secondary" onclick="loadSalaryReports()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6"></path>
                        <path d="M1 20v-6h6"></path>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                        <path d="M20.49 15a9 9 0 0 1-14.85 3.36L1 14"></path>
                    </svg>
                    Refresh
                </button>
                <button class="btn btn-secondary" onclick="exportSalaryReport('csv')">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Export CSV
                </button>
            </div>

            <!-- Summary Dashboard Cards -->
            <div class="salary-reports-summary" id="salaryReportsSummary">
                <div class="summary-card summary-employees">
                    <div class="summary-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </div>
                    <div class="summary-content">
                        <div class="summary-value" id="totalEmployeesWithSalary">0</div>
                        <div class="summary-label">Employees with Salary</div>
                        <div class="summary-sublabel">
                            <span id="employeesWithoutSalary">0</span> without salary assigned
                        </div>
                    </div>
                </div>
                <div class="summary-card summary-ctc">
                    <div class="summary-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </div>
                    <div class="summary-content">
                        <div class="summary-value" id="totalAnnualCtc">₹0</div>
                        <div class="summary-label">Total Annual CTC</div>
                        <div class="summary-sublabel">Across all employees</div>
                    </div>
                </div>
                <div class="summary-card summary-monthly">
                    <div class="summary-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <div class="summary-content">
                        <div class="summary-value" id="totalMonthlyGross">₹0</div>
                        <div class="summary-label">Monthly Gross Payroll</div>
                        <div class="summary-sublabel">Total monthly outflow</div>
                    </div>
                </div>
                <div class="summary-card summary-average">
                    <div class="summary-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 20V10"></path>
                            <path d="M18 20V4"></path>
                            <path d="M6 20v-4"></path>
                        </svg>
                    </div>
                    <div class="summary-content">
                        <div class="summary-value" id="averageCtc">₹0</div>
                        <div class="summary-label">Average CTC</div>
                        <div class="summary-sublabel">Per employee</div>
                    </div>
                </div>
            </div>

            <!-- Department-wise Breakdown -->
            <div class="report-section">
                <h3 class="section-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <line x1="20" y1="8" x2="20" y2="14"></line>
                        <line x1="23" y1="11" x2="17" y2="11"></line>
                    </svg>
                    Department-wise Breakdown
                </h3>
                <div class="department-breakdown" id="departmentBreakdown">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Detailed Employee Salary List -->
            <div class="report-section">
                <h3 class="section-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    Employee Salary Details
                </h3>
                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Code</th>
                                <th>Department</th>
                                <th>Designation</th>
                                <th class="text-right">Annual CTC</th>
                                <th class="text-right">Monthly Gross</th>
                                <th class="text-right">Monthly Net</th>
                                <th>Effective From</th>
                            </tr>
                        </thead>
                        <tbody id="salaryReportTable">
                            <tr class="empty-state">
                                <td colspan="8">
                                    <div class="empty-message">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                        </svg>
                                        <p>Loading salary data...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Adjustments Tab (Reimbursements, Bonuses, Deductions, etc.) -->
        <div class="tab-content" id="adjustments">
            <div class="filters-bar">
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="adjustmentSearch" placeholder="Search by employee name or code..." onkeyup="filterAdjustments()">
                </div>
                <div class="filter-group">
                    <select id="adjustmentStatusFilter" class="form-select" onchange="filterAdjustments()">
                        <option value="">All Status</option>
                        <option value="pending">Pending Approval</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                        <option value="applied">Applied to Payroll</option>
                    </select>
                    <select id="adjustmentTypeFilter" class="form-select" onchange="filterAdjustments()">
                        <option value="">All Types</option>
                        <option value="reimbursement">Reimbursement</option>
                        <option value="bonus">Bonus</option>
                        <option value="incentive">Incentive</option>
                        <option value="recovery">Recovery</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="showCreateAdjustmentModal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Adjustment
                </button>
            </div>

            <!-- Adjustment Stats Cards -->
            <div class="stats-row" id="adjustmentStats">
                <div class="stat-card">
                    <div class="stat-value" id="pendingAdjustmentsCount">0</div>
                    <div class="stat-label">Pending Approval</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="approvedAdjustmentsCount">0</div>
                    <div class="stat-label">Approved This Month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalReimbursements">₹0</div>
                    <div class="stat-label">Total Reimbursements</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalBonuses">₹0</div>
                    <div class="stat-label">Total Bonuses</div>
                </div>
            </div>

            <!-- Adjustments Table -->
            <div class="data-table-container">
                <table class="data-table" id="adjustmentsTable">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Effective Period</th>
                            <th>Reason</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adjustmentsTableBody">
                        <tr>
                            <td colspan="7" class="text-center">
                                <p class="empty-state">Loading adjustments...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Arrears Management Tab -->
        <div class="tab-content" id="arrears">
            <!-- Sub-tabs for Arrears Types -->
            <div class="sub-tabs">
                <button class="sub-tab-btn active" data-subtab="version-arrears" onclick="switchArrearsSubtab('version-arrears')">Version Arrears</button>
                <button class="sub-tab-btn" data-subtab="ctc-arrears" onclick="switchArrearsSubtab('ctc-arrears')">CTC Revision Arrears</button>
            </div>

            <!-- Version Arrears Section -->
            <div class="arrears-subtab-content active" id="version-arrears-content">
                <div class="filters-bar">
                    <div class="filter-group">
                        <select id="arrearsStatus" class="form-select" onchange="loadPendingArrears()">
                            <option value="pending">Pending</option>
                            <option value="applied">Applied</option>
                            <option value="cancelled">Cancelled</option>
                            <option value="">All</option>
                        </select>
                        <select id="arrearsStructure" class="form-select" onchange="loadPendingArrears()">
                            <option value="">All Structures</option>
                        </select>
                    </div>
                    <div class="search-box-modern">
                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="arrearsSearch" placeholder="Search by employee..." onkeyup="filterArrearsTable()">
                    </div>
                    <button class="btn btn-secondary" onclick="loadPendingArrears()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                        Refresh
                    </button>
                </div>

                <!-- Arrears Summary Stats -->
                <div class="stats-row" id="arrearsStats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalArrearsCount">0</div>
                        <div class="stat-label">Total Arrears</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pendingArrearsCount">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalArrearsAmount">₹0</div>
                        <div class="stat-label">Total Amount</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="affectedEmployeesCount">0</div>
                        <div class="stat-label">Employees Affected</div>
                    </div>
                </div>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Structure</th>
                                <th>Version</th>
                                <th>Period</th>
                                <th>Old Gross</th>
                                <th>New Gross</th>
                                <th>Arrears Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="arrearsTable">
                            <tr class="empty-state">
                                <td colspan="9">
                                    <div class="empty-message">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                        </svg>
                                        <p>No arrears found</p>
                                        <p class="hint">Arrears are generated when salary structure versions are applied retrospectively</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- CTC Revision Arrears Section -->
            <div class="arrears-subtab-content" id="ctc-arrears-content">
                <div class="filters-bar">
                    <div class="filter-group">
                        <select id="ctcArrearsStatus" class="form-select" onchange="loadCtcRevisionArrears()">
                            <option value="pending">Pending</option>
                            <option value="applied">Applied</option>
                            <option value="cancelled">Cancelled</option>
                            <option value="">All</option>
                        </select>
                    </div>
                    <div class="search-box-modern">
                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="ctcArrearsSearch" placeholder="Search by employee..." onkeyup="filterCtcArrearsTable()">
                    </div>
                    <button class="btn btn-secondary" onclick="loadCtcRevisionArrears()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                        Refresh
                    </button>
                    <button class="btn btn-primary" onclick="showBulkApplyCtcArrearsModal()" id="bulkApplyCtcArrearsBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 11 12 14 22 4"></polyline>
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                        </svg>
                        Bulk Apply
                    </button>
                </div>

                <!-- CTC Arrears Summary Stats -->
                <div class="stats-row" id="ctcArrearsStats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCtcArrearsCount">0</div>
                        <div class="stat-label">Total Arrears</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pendingCtcArrearsCount">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCtcArrearsAmount">₹0</div>
                        <div class="stat-label">Total Amount</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="affectedCtcEmployeesCount">0</div>
                        <div class="stat-label">Employees Affected</div>
                    </div>
                </div>

                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="ctcArrearsSelectAll" onchange="toggleAllCtcArrears(this)"></th>
                                <th>Employee</th>
                                <th>Revision Type</th>
                                <th>Period</th>
                                <th>Old CTC</th>
                                <th>New CTC</th>
                                <th>Arrears Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ctcArrearsTable">
                            <tr class="empty-state">
                                <td colspan="9">
                                    <div class="empty-message">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                        <p>No CTC revision arrears found</p>
                                        <p class="hint">Arrears are generated when employee salaries are revised retroactively</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
            </main>
        </div>
    </div>

    <!-- Create Payroll Draft Modal -->
    <div class="modal" id="createDraftModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Payroll Draft</h5>
                    <button class="close-btn" onclick="closeModal('createDraftModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="createDraftForm">
                        <div class="form-section">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="draftName">Draft Name</label>
                                    <input type="text" id="draftName" name="draftName" class="form-control" placeholder="e.g., Main Draft, Scenario A" value="Draft">
                                    <small class="form-text text-muted">Give this draft a name to distinguish it from others</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="draftPayrollPeriod">Payroll Period *</label>
                                    <input type="month" id="draftPayrollPeriod" name="period" class="form-control" required onchange="updateDraftPeriodDates()">
                                    <small class="form-text text-muted">Select the month and year for this payroll</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="draftPayrollOffice">Office</label>
                                    <select id="draftPayrollOffice" name="officeId" class="form-control">
                                        <option value="">All Offices</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="draftPeriodStart">Pay Period Start *</label>
                                    <input type="date" id="draftPeriodStart" name="periodStart" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="draftPeriodEnd">Pay Period End *</label>
                                    <input type="date" id="draftPeriodEnd" name="periodEnd" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="draftNotes">Notes</label>
                                    <textarea id="draftNotes" name="notes" class="form-control" rows="2" placeholder="Optional notes about this draft"></textarea>
                                </div>
                            </div>
                            <div class="info-box">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                <span>Create an empty draft first, then click "Process" to generate payslips. You can create multiple drafts for the same period to compare different scenarios.</span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="createPayrollDraft()">Create Draft</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Draft Details Modal -->
    <div class="modal" id="draftDetailsModal">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="draftDetailTitle">Draft Details</h5>
                    <button class="close-btn" onclick="closeModal('draftDetailsModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Summary Cards -->
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-value" id="draftTotalEmployees">0</div>
                            <div class="stat-label">Employees</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="draftTotalGross">$0</div>
                            <div class="stat-label">Total Gross</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="draftTotalDeductions">$0</div>
                            <div class="stat-label">Total Deductions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="draftTotalNet">$0</div>
                            <div class="stat-label">Total Net Pay</div>
                        </div>
                    </div>

                    <!-- Toolbar: Search + Action Buttons -->
                    <div class="draft-toolbar">
                        <div class="search-box">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="M21 21l-4.35-4.35"></path>
                            </svg>
                            <input type="text" id="draftPayslipSearch" placeholder="Search by name, code, or department..." oninput="filterDraftPayslips(this.value)">
                        </div>
                        <div class="draft-actions">
                            <button type="button" class="btn-icon btn-icon-warning" onclick="event.stopPropagation(); recalculateDraft(document.getElementById('draftDetailsModal').dataset.draftId)" title="Recalculate payroll for all employees">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                </svg>
                            </button>
                            <button type="button" class="btn-icon btn-icon-success" onclick="event.stopPropagation(); finalizeDraft(document.getElementById('draftDetailsModal').dataset.draftId)" title="Finalize draft and create payroll run">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </button>
                            <button type="button" class="btn-icon btn-icon-primary" onclick="event.stopPropagation(); exportDraftToCSV()" title="Export to CSV">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Payslips Table -->
                    <div class="data-table-container" style="max-height: 400px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee Code</th>
                                    <th>Employee Name</th>
                                    <th>Department</th>
                                    <th>Gross</th>
                                    <th>Deductions</th>
                                    <th>Net Pay</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="draftPayslipsTable">
                                <tr>
                                    <td colspan="7" class="text-center">No payslips generated yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Process Selected Employees Modal -->
    <div class="modal" id="processSelectedModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Process Selected Employees</h5>
                    <button class="close-btn" onclick="closeModal('processSelectedModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Draft info header -->
                    <div class="process-selected-header">
                        <div class="draft-info-row">
                            <div class="draft-info-item">
                                <span class="label">Draft:</span>
                                <span id="pseDraftName" class="value">-</span>
                            </div>
                            <div class="draft-info-item">
                                <span class="label">Period:</span>
                                <span id="psePeriod" class="value">-</span>
                            </div>
                            <div class="draft-info-item">
                                <span class="label">Office:</span>
                                <span id="pseOffice" class="value">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Search and filters -->
                    <div class="filters-bar compact">
                        <div class="search-box-modern">
                            <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <input type="text" id="pseSearch" placeholder="Search employees..." oninput="filterProcessSelectedEmployees()">
                        </div>
                        <div class="select-all-wrapper">
                            <label class="checkbox-label">
                                <input type="checkbox" id="pseSelectAll" onchange="toggleAllProcessSelectedEmployees()">
                                <span>Select All</span>
                            </label>
                        </div>
                        <div class="selection-count">
                            <span id="pseSelectedCount">0</span> of <span id="pseTotalCount">0</span> selected
                        </div>
                    </div>

                    <!-- Employee list -->
                    <div class="employee-selection-list" id="pseEmployeeList">
                        <div class="loading-placeholder">
                            <div class="spinner"></div>
                            <p>Loading eligible employees...</p>
                        </div>
                    </div>

                    <!-- Stats summary -->
                    <div class="selection-summary" id="pseSelectionSummary" style="display: none;">
                        <div class="summary-stat">
                            <span class="stat-label">Total Employees:</span>
                            <span class="stat-value" id="pseSummaryTotal">0</span>
                        </div>
                        <div class="summary-stat">
                            <span class="stat-label">Estimated Gross:</span>
                            <span class="stat-value" id="pseSummaryGross">₹0</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('processSelectedModal')">Cancel</button>
                    <button type="button" class="btn btn-primary" id="pseProcessBtn" onclick="processSelectedEmployees()" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Process Selected
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Salary Structure Modal -->
    <div class="modal" id="structureModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="structureModalTitle">Create Salary Structure</h5>
                    <button class="close-btn" onclick="closeModal('structureModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                <form id="structureForm">
                    <input type="hidden" id="structureId" name="id">
                    <div class="form-section">
                        <div class="form-row three-col">
                            <div class="form-group">
                                <label for="structureOffice">Office *</label>
                                <select id="structureOffice" name="office_id" class="form-control" required>
                                    <option value="">Select Office</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="structureName">Structure Name *</label>
                                <input type="text" id="structureName" name="name" class="form-control" required placeholder="e.g., Standard Employee">
                            </div>
                            <div class="form-group">
                                <label for="structureCode">Code *</label>
                                <input type="text" id="structureCode" name="code" class="form-control" required placeholder="e.g., STD">
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="structureDescription">Description</label>
                                <textarea id="structureDescription" name="description" class="form-control" rows="1"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="structureIsDefault">Default for Office</label>
                                <select id="structureIsDefault" name="is_default" class="form-control">
                                    <option value="false">No</option>
                                    <option value="true">Yes</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <div class="status-toggle-row">
                                    <label>Status</label>
                                    <div class="status-toggle-container">
                                        <span class="status-label inactive">Inactive</span>
                                        <label class="status-toggle">
                                            <input type="checkbox" id="structureIsActive" name="is_active" checked>
                                            <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                        </label>
                                        <span class="status-label active">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <!-- Compact Structure Summary - Above Components -->
                        <div class="structure-summary-compact" id="structureSummary" style="display: none;">
                            <div class="summary-metrics">
                                <div class="metric gross">
                                    <span class="metric-value" id="totalGrossCtc">0%</span>
                                    <span class="metric-label">Gross</span>
                                </div>
                                <div class="metric-divider">+</div>
                                <div class="metric balance" id="balanceMetric">
                                    <span class="metric-value" id="balanceWillFill">0%</span>
                                    <span class="metric-label" id="balanceComponentName">Auto-Balance</span>
                                </div>
                                <div class="metric-divider">=</div>
                                <div class="metric total">
                                    <span class="metric-value">100%</span>
                                    <span class="metric-label">CTC</span>
                                </div>
                                <div class="metric-separator"></div>
                                <div class="metric deductions">
                                    <span class="metric-value" id="deductionsBasicTotal">0%</span>
                                    <span class="metric-label">Deductions</span>
                                </div>
                            </div>
                            <div class="summary-note" id="balanceNote"></div>
                            <div class="summary-warning" id="summaryWarning" style="display: none;"></div>
                            <!-- Hidden fields for JS compatibility -->
                            <span id="remainingCtc" style="display:none;">0%</span>
                            <span id="earningsCtcTotal" style="display:none;">0%</span>
                            <span id="earningsBasicTotal" style="display:none;">0%</span>
                            <span id="earningsBasicEffective" style="display:none;">0%</span>
                            <span id="fixedAmountsCount" style="display:none;">0</span>
                            <span id="summaryInfo" style="display:none;"></span>
                            <span id="balancePreview" style="display:none;"></span>
                            <span id="remainingItem" style="display:none;"></span>
                        </div>
                        <div class="components-header">
                            <span class="components-title">Components</span>
                            <button type="button" class="btn-add-component" onclick="addStructureComponent()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Add
                            </button>
                        </div>
                        <div class="components-list" id="structureComponents">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </form>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveSalaryStructure()">Save Structure</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Component Modal -->
    <div class="modal" id="componentModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="componentModalTitle">Create Salary Component</h5>
                    <button class="close-btn" onclick="closeModal('componentModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                <form id="componentForm">
                    <input type="hidden" id="componentId" name="id">
                    <div class="form-section">
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="componentName">Component Name *</label>
                                <input type="text" id="componentName" name="name" class="form-control" required placeholder="e.g., Basic Salary">
                            </div>
                            <div class="form-group">
                                <label for="componentCode">Code *</label>
                                <input type="text" id="componentCode" name="code" class="form-control" required placeholder="e.g., BASIC">
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="componentCategory">Category *</label>
                                <select id="componentCategory" name="category" class="form-control" required>
                                    <option value="earning">Earning</option>
                                    <option value="deduction">Deduction</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="calculationType">Calculation Type *</label>
                                <select id="calculationType" name="calculationType" class="form-control" required>
                                    <option value="fixed">Fixed Amount</option>
                                    <option value="percentage">Percentage</option>
                                </select>
                            </div>
                        </div>
                        <!-- Percentage fields (shown when calculation type is percentage) -->
                        <div class="form-row two-col" id="percentageFieldsRow" style="display: none;">
                            <div class="form-group">
                                <label for="componentPercentage">Percentage *</label>
                                <input type="number" id="componentPercentage" name="percentage" class="form-control" placeholder="e.g., 50" step="0.01" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="calculationBase">Calculation Base *</label>
                                <select id="calculationBase" name="calculationBase" class="form-control">
                                    <option value="basic">Basic Salary</option>
                                    <option value="gross">Gross Salary</option>
                                    <option value="ctc">CTC</option>
                                </select>
                            </div>
                        </div>
                        <!-- Fixed Amount field (shown when calculation type is fixed) -->
                        <div class="form-row" id="fixedAmountFieldsRow" style="display: flex;">
                            <div class="form-group">
                                <label for="componentFixedAmount">Default Fixed Amount</label>
                                <input type="number" id="componentFixedAmount" name="fixed_amount" class="form-control" placeholder="e.g., 5000" step="0.01" min="0">
                                <small class="form-text text-muted">Optional default amount. Can be overridden per employee in salary structure.</small>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="isTaxable">Taxable</label>
                                <select id="isTaxable" name="isTaxable" class="form-control">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="isStatutory">Statutory</label>
                                <select id="isStatutory" name="isStatutory" class="form-control">
                                    <option value="false">No</option>
                                    <option value="true">Yes</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="componentDescription">Description</label>
                                <textarea id="componentDescription" name="description" class="form-control" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <div class="status-toggle-row">
                                    <label>Status</label>
                                    <div class="status-toggle-container">
                                        <span class="status-label inactive">Inactive</span>
                                        <label class="status-toggle">
                                            <input type="checkbox" id="componentIsActive" name="is_active" checked>
                                            <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                        </label>
                                        <span class="status-label active">Active</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="status-toggle-row">
                                    <label>Mark as Basic Component</label>
                                    <div class="status-toggle-container">
                                        <span class="status-label inactive">No</span>
                                        <label class="status-toggle">
                                            <input type="checkbox" id="isBasicComponent" name="is_basic_component">
                                            <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                        </label>
                                        <span class="status-label active">Yes</span>
                                    </div>
                                    <small class="form-text text-muted">Enable to use this component as base for percentage calculations (e.g., HRA = 50% of Basic)</small>
                                </div>
                            </div>
                        </div>
                        <!-- Balance Component Option REMOVED - Balance is now automatic and implicit in every salary structure -->
                        <!-- Backend automatically adds and calculates the balance component -->
                    </div>
                </form>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveComponent()">Save Component</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Loan Modal -->
    <div class="modal" id="loanModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loanModalTitle">Apply for Loan</h5>
                    <button class="close-btn" onclick="closeModal('loanModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                <form id="loanForm">
                    <input type="hidden" id="loanId" name="id">
                    <div class="form-section">
                        <div class="form-row" id="loanEmployeeRow">
                            <div class="form-group">
                                <label for="loanEmployee">Employee *</label>
                                <select id="loanEmployee" name="employeeId" class="form-control" required>
                                    <option value="">Select Employee</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="loanType">Loan Type *</label>
                                <select id="loanType" name="loanType" class="form-control" required>
                                    <option value="salary_advance">Salary Advance</option>
                                    <option value="personal_loan">Personal Loan</option>
                                    <option value="emergency_loan">Emergency Loan</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="loanAmount">Amount *</label>
                                <input type="number" id="loanAmount" name="amount" class="form-control" required min="0" step="0.01">
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="interestRate">Interest Rate (%)</label>
                                <input type="number" id="interestRate" name="interestRate" class="form-control" min="0" max="100" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label for="interestCalculationType">Interest Calculation Type</label>
                                <select id="interestCalculationType" name="interestCalculationType" class="form-control">
                                    <option value="simple">Simple Interest</option>
                                    <option value="reducing_balance">Reducing Balance (EMI)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="emiAmount">EMI Amount *</label>
                                <input type="number" id="emiAmount" name="emiAmount" class="form-control" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="tenureMonths">Tenure (Months)</label>
                                <input type="number" id="tenureMonths" name="tenureMonths" class="form-control" min="1" max="360" placeholder="Auto-calculated from installments">
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="loanStartDate">Start Date *</label>
                                <input type="date" id="loanStartDate" name="startDate" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="numberOfInstallments">No. of Installments *</label>
                                <input type="number" id="numberOfInstallments" name="installments" class="form-control" required min="1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="loanReason">Reason</label>
                                <textarea id="loanReason" name="reason" class="form-control" rows="2" placeholder="Purpose of the loan"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveLoan()">Submit Application</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Loan Modal -->
    <div class="modal" id="viewLoanModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Loan Details</h5>
                    <button class="close-btn" onclick="closeModal('viewLoanModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="loanDetailsContent">
                        <!-- Loan details will be populated here -->
                    </div>
                </div>
                <div class="modal-footer" id="loanActionsFooter">
                    <!-- Action buttons will be populated based on loan status and user role -->
                </div>
            </div>
        </div>
    </div>

    <!-- Reject Loan Modal -->
    <div class="modal" id="rejectLoanModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reject Loan Application</h5>
                    <button class="close-btn" onclick="closeModal('rejectLoanModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="rejectLoanId">
                    <div class="form-group">
                        <label for="rejectionReason">Rejection Reason *</label>
                        <textarea id="rejectionReason" class="form-control" rows="3" required placeholder="Please provide a reason for rejection"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="confirmRejectLoan()">Reject Loan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Disburse Loan Modal -->
    <div class="modal" id="disburseLoanModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Disburse Loan</h5>
                    <button class="close-btn" onclick="closeModal('disburseLoanModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="disburseLoanId">
                    <div class="form-group">
                        <label for="disbursementMode">Disbursement Mode *</label>
                        <select id="disbursementMode" class="form-control" required>
                            <option value="">Select Mode</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="cheque">Cheque</option>
                            <option value="cash">Cash</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="disbursementReference">Reference Number</label>
                        <input type="text" id="disbursementReference" class="form-control" placeholder="Transaction/Cheque number">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="confirmDisburseLoan()">Confirm Disbursement</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Payslip Modal -->
    <div class="modal" id="payslipModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Payslip Details</h5>
                    <div class="modal-header-actions">
                        <button type="button" class="btn btn-sm btn-outline" onclick="downloadPayslip()" title="Download PDF">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </button>
                        <button class="close-btn" onclick="closeModal('payslipModal')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="payslip-container" id="payslipContent">
                        <!-- Dynamically populated -->
                    </div>
                    <!-- Multi-Location Breakdown Section -->
                    <div id="locationBreakdownSection" class="location-breakdown-section" style="display:none;">
                        <h4 class="section-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Multi-Location Breakdown
                        </h4>
                        <div class="location-cards" id="locationCards">
                            <!-- Location cards rendered by JS -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="payslipModalFooter">
                    <div id="payslipStatusInfo" class="payslip-status-info">
                        <!-- Status info populated by JS -->
                    </div>
                    <div class="footer-actions">
                        <button type="button" class="btn btn-success" id="finalizePayslipBtn" onclick="finalizePayslip()" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                            Finalize Payslip
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payroll Run Details Modal -->
    <div class="modal" id="payrollRunDetailsModal">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 1400px; width: 95%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="payrollRunDetailsTitle">Payroll Run Details</h5>
                    <button class="close-btn" onclick="closeModal('payrollRunDetailsModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                    <div id="payrollRunDetailsContent">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline btn-danger" id="deletePayrollRunBtn" onclick="deleteCurrentPayrollRun()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Delete Draft
                    </button>
                    <button type="button" class="btn btn-outline" id="processPayrollRunBtn" onclick="processCurrentPayrollRun()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Process Payroll
                    </button>
                    <button type="button" class="btn btn-outline" id="downloadCsvBtn" onclick="downloadPayrollCsv()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download CSV
                    </button>
                    <button type="button" class="btn btn-outline" id="downloadBankFileBtn" onclick="downloadBankFile()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                            <line x1="1" y1="10" x2="23" y2="10"></line>
                        </svg>
                        Bank File
                    </button>
                    <button type="button" class="btn btn-success" id="approvePayrollRunBtn" onclick="approvePayrollRun()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        Approve
                    </button>
                    <button type="button" class="btn btn-primary" id="markPaidBtn" onclick="showMarkPaidModal()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Mark as Paid
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Version History Modal -->
    <div class="modal" id="versionHistoryModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="versionHistoryTitle">Version History</h5>
                    <button class="close-btn" onclick="closeModal('versionHistoryModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="version-info-banner">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>Structure versions track component changes over time. Each version has an effective date for mid-month proration calculations.</span>
                    </div>
                    <div class="data-table-container" style="max-height: 400px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Version</th>
                                    <th>Effective From</th>
                                    <th>Effective To</th>
                                    <th>Components</th>
                                    <th>Change Reason</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="versionHistoryTable">
                                <tr class="empty-state">
                                    <td colspan="6">
                                        <div class="empty-message">
                                            <p>No versions found</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="openArrearsModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Manage Arrears
                    </button>
                    <button type="button" class="btn btn-outline" onclick="openBulkAssignModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Bulk Assign
                    </button>
                    <button type="button" class="btn btn-outline" onclick="previewVersionedSalary()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="9" x2="21" y2="9"></line>
                            <line x1="9" y1="21" x2="9" y2="9"></line>
                        </svg>
                        Preview Calculation
                    </button>
                    <button type="button" class="btn btn-primary" onclick="showCreateVersionModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Create New Version
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Version Modal -->
    <div class="modal" id="createVersionModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createVersionModalTitle">Create New Version</h5>
                    <button class="close-btn" onclick="closeModal('createVersionModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="newVersionForm">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="versionEffectiveDate">Effective From *</label>
                                    <input type="date" id="versionEffectiveDate" name="effectiveFrom" class="form-control" required>
                                    <small class="form-text text-muted">Payroll will use this version for days after this date</small>
                                </div>
                                <div class="form-group">
                                    <label for="versionChangeReason">Change Reason</label>
                                    <input type="text" id="versionChangeReason" name="changeReason" class="form-control" placeholder="e.g., Added Professional Tax">
                                </div>
                            </div>
                        </div>
                        <div class="form-section">
                            <h3>Components</h3>
                            <p class="text-muted">Select components and set their values for this version</p>
                            <div class="version-components-list" id="newVersionComponents">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveNewVersion()">Create Version</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Arrears Management Modal -->
    <div class="modal" id="arrearsModal">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="arrearsModalTitle">Version Arrears Management</h5>
                    <button class="close-btn" onclick="closeModal('arrearsModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="version-info-banner" style="background: var(--color-warning-light); border-left: 4px solid var(--color-warning);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-warning-text)" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <span class="text-warning-dark">Arrears are automatically calculated when a version is created with a retrospective effective date. Review and apply them to the next payroll.</span>
                    </div>

                    <div class="arrears-summary" id="arrearsSummary" style="display: none; margin: 16px 0; padding: 16px; background: var(--color-info-light); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
                            <div>
                                <span class="text-muted">Total Employees Affected</span>
                                <h4 id="arrearsEmployeeCount" style="margin: 4px 0;">0</h4>
                            </div>
                            <div>
                                <span class="text-muted">Total Arrears Amount</span>
                                <h4 id="arrearsTotalAmount" class="text-success" style="margin: 4px 0;">₹0.00</h4>
                            </div>
                            <div>
                                <span class="text-muted">Pending Arrears</span>
                                <h4 id="arrearsPendingCount" class="text-danger" style="margin: 4px 0;">0</h4>
                            </div>
                        </div>
                    </div>

                    <div class="data-table-container" style="max-height: 400px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllArrears" onchange="toggleAllArrears()"></th>
                                    <th>Employee</th>
                                    <th>Month/Year</th>
                                    <th>Old Gross</th>
                                    <th>New Gross</th>
                                    <th>Arrears</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="modalArrearsTable">
                                <tr class="empty-state">
                                    <td colspan="8">
                                        <div class="empty-message">
                                            <p>No arrears found</p>
                                            <small class="text-muted">Arrears are created when versions have retrospective effective dates</small>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="refreshArrears()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                        Refresh
                    </button>
                    <button type="button" class="btn btn-danger" onclick="cancelSelectedArrears()" id="cancelArrearsBtn" disabled>
                        Cancel Selected
                    </button>
                    <button type="button" class="btn btn-primary" onclick="applySelectedArrears()" id="applyArrearsBtn" disabled>
                        Apply Selected to Payroll
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Assignment Modal -->
    <div class="modal" id="bulkAssignModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bulkAssignModalTitle">Bulk Version Assignment</h5>
                    <button class="close-btn" onclick="closeModal('bulkAssignModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="version-info-banner">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>Assign a salary structure version to multiple employees at once. Filter by office, department, or designation.</span>
                    </div>

                    <form id="bulkAssignForm">
                        <div class="form-section">
                            <h3>Filter Employees</h3>
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label for="bulkOfficeId">Office</label>
                                    <select id="bulkOfficeId" class="form-control" onchange="previewBulkAssignment()">
                                        <option value="">All Offices</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="bulkDepartmentId">Department</label>
                                    <select id="bulkDepartmentId" class="form-control" onchange="previewBulkAssignment()">
                                        <option value="">All Departments</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="bulkDesignationId">Designation</label>
                                    <select id="bulkDesignationId" class="form-control" onchange="previewBulkAssignment()">
                                        <option value="">All Designations</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Assignment Details</h3>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="bulkEffectiveFrom">Effective From *</label>
                                    <input type="date" id="bulkEffectiveFrom" class="form-control" required onchange="previewBulkAssignment()">
                                </div>
                                <div class="form-group">
                                    <label for="bulkReason">Reason</label>
                                    <input type="text" id="bulkReason" class="form-control" placeholder="e.g., FY 2025-26 structure update">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="bulkCalculateArrears" checked>
                                    <span>Calculate arrears for affected employees</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-section" id="bulkPreviewSection" style="display: none;">
                            <h3>Preview</h3>
                            <div class="bulk-preview-summary" style="display: flex; gap: 24px; margin-bottom: 16px;">
                                <div style="padding: 12px; background: var(--color-info-light); border-radius: 8px; flex: 1;">
                                    <span class="text-muted">Employees Matched</span>
                                    <h4 id="bulkMatchedCount" style="margin: 4px 0;">0</h4>
                                </div>
                                <div style="padding: 12px; background: var(--color-success-light); border-radius: 8px; flex: 1;">
                                    <span class="text-muted">To Be Assigned</span>
                                    <h4 id="bulkToAssignCount" class="text-success" style="margin: 4px 0;">0</h4>
                                </div>
                                <div style="padding: 12px; background: var(--color-warning-light); border-radius: 8px; flex: 1;">
                                    <span class="text-muted">Est. Arrears</span>
                                    <h4 id="bulkEstArrears" class="text-warning-dark" style="margin: 4px 0;">₹0.00</h4>
                                </div>
                            </div>
                            <div class="data-table-container" style="max-height: 200px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Employee</th>
                                            <th>Current Structure</th>
                                            <th>CTC</th>
                                            <th>Est. Arrears</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bulkPreviewTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="previewBulkAssignment()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        Preview
                    </button>
                    <button type="button" class="btn btn-primary" onclick="executeBulkAssignment()" id="executeBulkBtn" disabled>
                        Execute Assignment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Version Comparison Modal -->
    <div class="modal" id="versionCompareModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="versionCompareTitle">Version Comparison</h5>
                    <button class="close-btn" onclick="closeModal('versionCompareModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="comparison-header" style="display: flex; justify-content: space-between; margin-bottom: 24px; padding: 16px; background: var(--gray-50); border-radius: 8px;">
                        <div style="text-align: center; flex: 1;">
                            <span class="text-muted">From Version</span>
                            <h4 id="compareFromVersion" style="margin: 4px 0;">v1</h4>
                            <small id="compareFromDate" class="text-muted">-</small>
                        </div>
                        <div style="display: flex; align-items: center; padding: 0 24px;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-secondary)" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                <polyline points="12 5 19 12 12 19"></polyline>
                            </svg>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <span class="text-muted">To Version</span>
                            <h4 id="compareToVersion" style="margin: 4px 0;">v2</h4>
                            <small id="compareToDate" class="text-muted">-</small>
                        </div>
                    </div>

                    <div class="comparison-summary" style="display: flex; gap: 12px; margin-bottom: 24px;">
                        <span class="badge" id="addedCount" style="background: var(--color-success-light); color: var(--color-success-text); padding: 6px 12px; border-radius: 16px;">
                            + 0 Added
                        </span>
                        <span class="badge" id="removedCount" style="background: var(--color-danger-light); color: var(--color-danger-text); padding: 6px 12px; border-radius: 16px;">
                            - 0 Removed
                        </span>
                        <span class="badge" id="modifiedCount" style="background: var(--color-warning-light); color: var(--color-warning-text); padding: 6px 12px; border-radius: 16px;">
                            ~ 0 Modified
                        </span>
                        <span class="badge" id="unchangedCount" style="background: var(--gray-200); color: var(--gray-700); padding: 6px 12px; border-radius: 16px;">
                            = 0 Unchanged
                        </span>
                    </div>

                    <div class="comparison-details">
                        <!-- Added Components -->
                        <div id="addedSection" style="display: none; margin-bottom: 16px;">
                            <h4 class="text-success-dark" style="margin-bottom: 8px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Added Components
                            </h4>
                            <div id="addedList" style="background: var(--color-success-light); padding: 12px; border-radius: 8px;"></div>
                        </div>

                        <!-- Removed Components -->
                        <div id="removedSection" style="display: none; margin-bottom: 16px;">
                            <h4 class="text-danger-dark" style="margin-bottom: 8px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Removed Components
                            </h4>
                            <div id="removedList" style="background: var(--color-danger-light); padding: 12px; border-radius: 8px;"></div>
                        </div>

                        <!-- Modified Components -->
                        <div id="modifiedSection" style="display: none; margin-bottom: 16px;">
                            <h4 class="text-warning-dark" style="margin-bottom: 8px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                                Modified Components
                            </h4>
                            <div id="modifiedList" style="background: var(--color-warning-light); padding: 12px; border-radius: 8px;"></div>
                        </div>

                        <!-- Unchanged Components -->
                        <div id="unchangedSection" style="display: none;">
                            <h4 style="color: var(--gray-700); margin-bottom: 8px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                                Unchanged Components
                            </h4>
                            <div id="unchangedList" style="background: var(--gray-200); padding: 12px; border-radius: 8px;"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <!-- Mark as Paid Modal -->
    <div class="modal" id="markPaidModal">
        <div class="modal-backdrop" onclick="closeModal('markPaidModal')"></div>
        <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mark Payroll as Paid</h5>
                    <button class="close-btn" onclick="closeModal('markPaidModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <p style="color: var(--gray-600); margin-bottom: 16px;">
                        Enter the payment batch reference number for this payroll disbursement.
                    </p>
                    <div class="form-group">
                        <label for="paymentBatchRef">Payment Batch Reference *</label>
                        <input type="text" id="paymentBatchRef" class="form-input"
                               placeholder="e.g., BATCH-2025-12-001" required>
                        <small class="form-help">This reference will be recorded for audit purposes</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('markPaidModal')">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="confirmMarkPaid()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Confirm Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Arrears Details Modal -->
    <div class="modal" id="arrearsDetailsModal">
        <div class="modal-backdrop" onclick="closeModal('arrearsDetailsModal')"></div>
        <div class="modal-dialog modal-dialog-centered" style="max-width: 700px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Arrears Details</h5>
                    <button class="close-btn" onclick="closeModal('arrearsDetailsModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                    <div id="arrearsDetailsContent">
                        <!-- Content populated by JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline btn-danger" id="cancelArrearsBtn" onclick="cancelArrears()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                        Cancel Arrears
                    </button>
                    <button type="button" class="btn btn-success" id="applyArrearsBtn" onclick="applyArrears()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Apply to Next Payroll
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tax Type Modal -->
    <div id="taxTypeModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taxTypeModalTitle">Create Tax Type</h5>
                    <button class="close-btn" onclick="closeModal('taxTypeModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="taxTypeForm">
                        <input type="hidden" id="taxTypeId" name="id">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="taxTypeName">Tax Name *</label>
                                    <input type="text" id="taxTypeName" name="tax_name" class="form-control" required placeholder="e.g., Professional Tax">
                                </div>
                                <div class="form-group">
                                    <label for="taxTypeCode">Tax Code *</label>
                                    <input type="text" id="taxTypeCode" name="tax_code" class="form-control" required placeholder="e.g., PT">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="taxTypeDeductionFrom">Deduction From *</label>
                                    <select id="taxTypeDeductionFrom" name="deduction_from" class="form-control" required>
                                        <option value="employee">Employee</option>
                                        <option value="employer">Employer</option>
                                        <option value="both">Both</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="taxTypeDisplayOrder">Display Order</label>
                                    <input type="number" id="taxTypeDisplayOrder" name="display_order" class="form-control" min="0" value="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="taxTypeDescription">Description</label>
                                    <textarea id="taxTypeDescription" name="description" class="form-control" rows="2" placeholder="Brief description of this tax type"></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="status-toggle-row">
                                        <label>Status</label>
                                        <div class="status-toggle-container">
                                            <span class="status-label inactive">Inactive</span>
                                            <label class="status-toggle">
                                                <input type="checkbox" id="taxTypeIsActive" name="is_active" checked>
                                                <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                            </label>
                                            <span class="status-label active">Active</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveTaxType()">Save Tax Type</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tax Rule Modal -->
    <div id="taxRuleModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taxRuleModalTitle">Create Tax Rule</h5>
                    <button class="close-btn" onclick="closeModal('taxRuleModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="taxRuleForm">
                        <input type="hidden" id="taxRuleId" name="id">
                        <div class="form-section">
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label for="taxRuleOfficeId">Office *</label>
                                    <select id="taxRuleOfficeId" name="office_id" class="form-control" required>
                                        <option value="">Select Office</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="taxRuleTaxTypeId">Tax Type *</label>
                                    <select id="taxRuleTaxTypeId" name="tax_type_id" class="form-control" required>
                                        <option value="">Select Tax Type</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="taxRuleName">Rule Name *</label>
                                    <input type="text" id="taxRuleName" name="rule_name" class="form-control" required placeholder="e.g., Maharashtra PT">
                                </div>
                            </div>
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label for="taxRuleCode">Tax Code</label>
                                    <input type="text" id="taxRuleCode" name="tax_code" class="form-control" placeholder="e.g., MH-PT">
                                </div>
                                <div class="form-group">
                                    <label for="taxRuleJurisdictionLevel">Jurisdiction Level *</label>
                                    <select id="taxRuleJurisdictionLevel" name="jurisdiction_level" class="form-control" required>
                                        <option value="federal">Federal</option>
                                        <option value="state" selected>State</option>
                                        <option value="province">Province</option>
                                        <option value="city">City</option>
                                        <option value="county">County</option>
                                        <option value="local">Local</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="taxRuleJurisdictionName">Jurisdiction Name *</label>
                                    <input type="text" id="taxRuleJurisdictionName" name="jurisdiction_name" class="form-control" required placeholder="e.g., Maharashtra">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="taxRuleJurisdictionCode">Jurisdiction Code</label>
                                    <input type="text" id="taxRuleJurisdictionCode" name="jurisdiction_code" class="form-control" placeholder="e.g., MH">
                                </div>
                                <div class="form-group">
                                    <label for="taxRuleCalculationType">Calculation Type *</label>
                                    <select id="taxRuleCalculationType" name="calculation_type" class="form-control" required onchange="toggleCalculationFields()">
                                        <option value="fixed">Fixed Amount</option>
                                        <option value="percentage">Percentage</option>
                                        <option value="slab">Slab Based</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Fixed Amount Fields -->
                            <div class="form-row" id="fixedAmountFields">
                                <div class="form-group">
                                    <label for="taxRuleFixedAmount">Fixed Amount *</label>
                                    <input type="number" id="taxRuleFixedAmount" name="fixed_amount" class="form-control" step="0.01" min="0" placeholder="e.g., 200">
                                </div>
                            </div>

                            <!-- Percentage Fields -->
                            <div class="form-row two-col" id="percentageFields" style="display: none;">
                                <div class="form-group">
                                    <label for="taxRulePercentage">Percentage *</label>
                                    <input type="number" id="taxRulePercentage" name="percentage" class="form-control" step="0.01" min="0" max="100" placeholder="e.g., 12.5">
                                </div>
                                <div class="form-group">
                                    <label for="taxRulePercentageOf">Percentage Of *</label>
                                    <select id="taxRulePercentageOf" name="percentage_of" class="form-control">
                                        <option value="basic">Basic Salary</option>
                                        <option value="gross">Gross Salary</option>
                                        <option value="taxable">Taxable Income</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Slab Fields -->
                            <div id="slabFields" style="display: none;">
                                <div class="form-group">
                                    <div class="slab-header">
                                        <div>
                                            <label>Tax Slabs</label>
                                            <small class="form-text">Define income slabs and corresponding tax amounts</small>
                                        </div>
                                        <button type="button" class="btn btn-secondary btn-sm" onclick="addSlabRow()">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                            Add Slab
                                        </button>
                                    </div>
                                    <div id="slabContainer" class="slab-container-scroll">
                                        <div class="slab-row">
                                            <input type="number" class="form-control slab-from" placeholder="From" min="0">
                                            <span class="slab-separator">to</span>
                                            <input type="number" class="form-control slab-to" placeholder="To" min="0">
                                            <span class="slab-separator">=</span>
                                            <input type="number" class="form-control slab-amount" placeholder="Amount" min="0" step="0.01">
                                            <button type="button" class="btn btn-sm btn-danger" onclick="removeSlabRow(this)">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label for="taxRuleEffectiveFrom">Effective From *</label>
                                    <input type="date" id="taxRuleEffectiveFrom" name="effective_from" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="taxRuleEffectiveTo">Effective To</label>
                                    <input type="date" id="taxRuleEffectiveTo" name="effective_to" class="form-control">
                                    <small class="form-text">Leave empty for no end date</small>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div class="status-toggle-container">
                                        <span class="status-label inactive">Inactive</span>
                                        <label class="status-toggle">
                                            <input type="checkbox" id="taxRuleIsActive" name="is_active" checked>
                                            <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                        </label>
                                        <span class="status-label active">Active</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="taxRuleNotes">Notes</label>
                                    <textarea id="taxRuleNotes" name="notes" class="form-control" rows="2" placeholder="Additional notes about this rule"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveTaxRule()">Save Tax Rule</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Copy Tax Rules Modal -->
    <div id="copyTaxRulesModal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Copy Tax Rules</h5>
                    <button class="close-btn" onclick="closeModal('copyTaxRulesModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="copyTaxRulesForm">
                        <div class="form-section">
                            <div class="form-group">
                                <label for="copySourceOffice">Source Office *</label>
                                <select id="copySourceOffice" name="source_office_id" class="form-control" required>
                                    <option value="">Select Source Office</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="copyTargetOffice">Target Office *</label>
                                <select id="copyTargetOffice" name="target_office_id" class="form-control" required>
                                    <option value="">Select Target Office</option>
                                </select>
                            </div>
                            <div class="alert alert-info" style="margin-top: 12px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                This will copy all active tax rules from the source office to the target office. Existing rules in the target office will not be affected.
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="copyTaxRules()">Copy Rules</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tax Preview Modal -->
    <div id="taxPreviewModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tax Calculation Preview</h5>
                    <button class="close-btn" onclick="closeModal('taxPreviewModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="taxPreviewForm">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="previewOffice">Office *</label>
                                    <select id="previewOffice" name="office_id" class="form-control" required>
                                        <option value="">Select Office</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="previewEffectiveDate">Effective Date *</label>
                                    <input type="date" id="previewEffectiveDate" name="effective_date" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label for="previewBasicSalary">Basic Salary</label>
                                    <input type="number" id="previewBasicSalary" name="basic_salary" class="form-control" step="0.01" min="0" placeholder="e.g., 50000">
                                </div>
                                <div class="form-group">
                                    <label for="previewGrossSalary">Gross Salary *</label>
                                    <input type="number" id="previewGrossSalary" name="gross_salary" class="form-control" step="0.01" min="0" required placeholder="e.g., 100000">
                                </div>
                                <div class="form-group">
                                    <label for="previewTaxableIncome">Taxable Income</label>
                                    <input type="number" id="previewTaxableIncome" name="taxable_income" class="form-control" step="0.01" min="0" placeholder="e.g., 90000">
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="calculateTaxPreview()">Calculate</button>
                        </div>
                    </form>

                    <div id="taxPreviewResults" style="display: none; margin-top: 20px;">
                        <h6>Tax Calculation Results</h6>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Tax Type</th>
                                        <th>Rule</th>
                                        <th>Calculation</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody id="taxPreviewResultsTable">
                                </tbody>
                                <tfoot>
                                    <tr style="font-weight: bold; background: var(--gray-50);">
                                        <td colspan="3">Total Tax</td>
                                        <td id="taxPreviewTotal">0.00</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VD Type Modal -->
    <div id="vdTypeModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="vdTypeModalTitle">Create VD Type</h5>
                    <button class="close-btn" onclick="closeVDTypeModal()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="vdTypeForm">
                        <input type="hidden" id="vdTypeId">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="vdTypeName">Name *</label>
                                    <input type="text" class="form-control" id="vdTypeName" placeholder="e.g., Additional Medical Insurance" required>
                                </div>
                                <div class="form-group">
                                    <label for="vdTypeCode">Code *</label>
                                    <input type="text" class="form-control" id="vdTypeCode" placeholder="e.g., MED-EXT" required>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="vdTypeDefaultAmount">Default Amount (₹)</label>
                                    <input type="number" class="form-control" id="vdTypeDefaultAmount" placeholder="0.00" step="0.01" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="vdTypeIsActive">Status</label>
                                    <select class="form-control" id="vdTypeIsActive">
                                        <option value="true">Active</option>
                                        <option value="false">Inactive</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vdTypeDescription">Description</label>
                                    <textarea class="form-control" id="vdTypeDescription" rows="2" placeholder="Describe this voluntary deduction..."></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeVDTypeModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveVDType()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- VD Enrollment Modal -->
    <div id="vdEnrollmentModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="vdEnrollmentModalTitle">New VD Enrollment</h5>
                    <button class="close-btn" onclick="closeVDEnrollmentModal()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="vdEnrollmentForm">
                        <input type="hidden" id="vdEnrollmentId">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="vdEnrollmentEmployee">Employee *</label>
                                    <input type="hidden" id="vdEnrollmentEmployee" required>
                                    <div id="vdEnrollmentEmployeeDropdown"></div>
                                </div>
                                <div class="form-group">
                                    <label for="vdEnrollmentDeductionType">Deduction Type *</label>
                                    <select class="form-control" id="vdEnrollmentDeductionType" required onchange="onVDTypeChange()">
                                        <option value="">Select VD Type</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="vdEnrollmentAmount">Monthly Amount (₹) *</label>
                                    <input type="number" class="form-control" id="vdEnrollmentAmount" placeholder="0.00" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <!-- Empty for alignment -->
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="vdEnrollmentStartDate">Start Date *</label>
                                    <input type="date" class="form-control" id="vdEnrollmentStartDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="vdEnrollmentEndDate">End Date (Optional)</label>
                                    <input type="date" class="form-control" id="vdEnrollmentEndDate">
                                    <small class="form-hint">Leave blank for ongoing deduction</small>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeVDEnrollmentModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveVDEnrollment()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        Submit for Approval
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- VD View/Approve Modal -->
    <div id="vdViewModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="vdViewModalTitle">Enrollment Details</h5>
                    <button class="close-btn" onclick="closeVDViewModal()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="details-card">
                        <div class="details-header">
                            <div class="details-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="8.5" cy="7" r="4"></circle>
                                    <line x1="20" y1="8" x2="20" y2="14"></line>
                                    <line x1="23" y1="11" x2="17" y2="11"></line>
                                </svg>
                            </div>
                            <div class="details-title">
                                <h4 id="vdViewEmployee">-</h4>
                                <span class="badge" id="vdViewStatus">-</span>
                            </div>
                        </div>
                        <div class="details-grid">
                            <div class="detail-item">
                                <span class="detail-label">VD Type</span>
                                <span class="detail-value" id="vdViewType">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Monthly Amount</span>
                                <span class="detail-value amount" id="vdViewAmount">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Start Date</span>
                                <span class="detail-value" id="vdViewStartDate">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">End Date</span>
                                <span class="detail-value" id="vdViewEndDate">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Created At</span>
                                <span class="detail-value" id="vdViewCreatedAt">-</span>
                            </div>
                            <div class="detail-item" id="vdViewApprovedByRow" style="display: none;">
                                <span class="detail-label">Approved By</span>
                                <span class="detail-value" id="vdViewApprovedBy">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="vdViewModalFooter">
                    <button type="button" class="btn btn-secondary" onclick="closeVDViewModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- VD Opt-Out Modal -->
    <div id="vdOptOutModal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Opt-Out of Voluntary Deduction</h5>
                    <button class="close-btn" onclick="closeVDOptOutModal()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="vdOptOutId">
                    <div class="alert alert-warning">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <div>
                            <p>You are about to opt-out of <strong id="vdOptOutTypeName">-</strong> for <strong id="vdOptOutEmployeeName">-</strong>.</p>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vdOptOutDate">Last Deduction Date *</label>
                                <input type="date" class="form-control" id="vdOptOutDate" required>
                                <small class="form-hint">The final month will be prorated based on this date</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeVDOptOutModal()">Cancel</button>
                    <button type="button" class="btn btn-warning" onclick="confirmVDOptOut()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                            <line x1="12" y1="2" x2="12" y2="12"></line>
                        </svg>
                        Confirm Opt-Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- VD Reject Modal -->
    <div id="vdRejectModal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reject Enrollment</h5>
                    <button class="close-btn" onclick="closeVDRejectModal()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="vdRejectId">
                    <div class="form-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vdRejectReason">Reason for Rejection *</label>
                                <textarea class="form-control" id="vdRejectReason" rows="3" placeholder="Please provide a reason for rejection..." required></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeVDRejectModal()">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmVDReject()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                        Reject
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Adjustment Modal -->
    <div class="modal" id="createAdjustmentModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; vertical-align: -3px;">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        New Adjustment
                    </h5>
                    <button class="close-btn" onclick="closeModal('createAdjustmentModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="createAdjustmentForm">
                        <!-- Employee Selection -->
                        <div class="form-group" style="margin-bottom: 16px;">
                            <label class="form-label">Employee <span class="required">*</span></label>
                            <input type="hidden" id="adjustmentEmployeeId" name="employeeId" required>
                            <div class="employee-search-dropdown" id="adjustmentEmployeeDropdown">
                                <div class="employee-search-selected" id="adjustmentEmployeeSelected" onclick="toggleAdjustmentEmployeeDropdown()">
                                    <span class="selected-employee-text" id="adjustmentSelectedText">Select an employee...</span>
                                    <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="employee-search-panel" id="adjustmentEmployeePanel">
                                    <div class="search-box-modern">
                                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="11" cy="11" r="8"/>
                                            <path d="m21 21-4.35-4.35"/>
                                        </svg>
                                        <input type="text" id="adjustmentEmployeeSearch" placeholder="Search by name or code..." oninput="filterAdjustmentEmployeeList()">
                                        <button type="button" class="clear-search-btn" id="clearAdjustmentSearchBtn" style="display: none;" onclick="clearAdjustmentEmployeeSearch()">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="18" y1="6" x2="6" y2="18"/>
                                                <line x1="6" y1="6" x2="18" y2="18"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="employee-list-header">
                                        <span id="adjustmentEmployeeCountDisplay">0 employees</span>
                                    </div>
                                    <div id="adjustmentEmployeeList" class="employees-list-modern">
                                        <p class="text-muted" style="text-align: center; font-size: 0.8rem; padding: 16px;">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Adjustment Type Cards -->
                        <div class="form-group" style="margin-bottom: 16px;">
                            <label class="form-label">Adjustment Type <span class="required">*</span></label>
                            <div class="adjustment-type-cards">
                                <label class="type-card" data-type="reimbursement">
                                    <input type="radio" name="adjustmentType" value="reimbursement" required>
                                    <div class="type-card-content">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="2" y="5" width="20" height="14" rx="2"/>
                                            <line x1="2" y1="10" x2="22" y2="10"/>
                                        </svg>
                                        <span class="type-name">Reimbursement</span>
                                        <span class="type-desc">Expense claims</span>
                                    </div>
                                </label>
                                <label class="type-card" data-type="bonus">
                                    <input type="radio" name="adjustmentType" value="bonus" required>
                                    <div class="type-card-content">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                        </svg>
                                        <span class="type-name">Bonus</span>
                                        <span class="type-desc">Performance reward</span>
                                    </div>
                                </label>
                                <label class="type-card" data-type="incentive">
                                    <input type="radio" name="adjustmentType" value="incentive" required>
                                    <div class="type-card-content">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                            <polyline points="17 6 23 6 23 12"/>
                                        </svg>
                                        <span class="type-name">Incentive</span>
                                        <span class="type-desc">Target achievement</span>
                                    </div>
                                </label>
                                <label class="type-card" data-type="recovery">
                                    <input type="radio" name="adjustmentType" value="recovery" required>
                                    <div class="type-card-content">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="12" y1="1" x2="12" y2="23"/>
                                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                        </svg>
                                        <span class="type-name">Recovery</span>
                                        <span class="type-desc">Salary deduction</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Amount and Period Row -->
                        <div class="form-row" style="display: flex; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label" for="adjustmentAmount">Amount (₹) <span class="required">*</span></label>
                                <input type="number" id="adjustmentAmount" class="form-control" min="0" step="0.01" placeholder="Enter amount" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label" for="adjustmentEffectivePeriod">Effective Period <span class="required">*</span></label>
                                <input type="month" id="adjustmentEffectivePeriod" class="form-control" required>
                            </div>
                        </div>

                        <!-- Recurring Toggle Row -->
                        <div class="form-group" style="margin-bottom: 16px;">
                            <div class="recurring-toggle-row">
                                <div class="recurring-toggle-left">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="adjustmentRecurring" onchange="toggleRecurringOptions()">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <div class="recurring-label">
                                        <span class="recurring-title">Recurring Adjustment</span>
                                        <span class="recurring-hint">Apply this amount for multiple months</span>
                                    </div>
                                </div>
                                <div class="recurring-months-input" id="recurringOptionsRow" style="display: none;">
                                    <input type="number" id="adjustmentRecurringMonths" class="form-control" min="2" max="36" placeholder="Months" style="width: 80px;">
                                    <span class="months-label">months</span>
                                </div>
                            </div>
                        </div>

                        <!-- Reason -->
                        <div class="form-group">
                            <label class="form-label" for="adjustmentReason">Reason <span class="required">*</span></label>
                            <textarea id="adjustmentReason" class="form-control" rows="2" placeholder="Brief description of this adjustment..." required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('createAdjustmentModal')">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createAdjustment()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Create Adjustment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View/Approve Adjustment Modal -->
    <div class="modal" id="viewAdjustmentModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; vertical-align: -3px;">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Adjustment Details
                    </h5>
                    <button class="close-btn" onclick="closeModal('viewAdjustmentModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" style="padding: 16px 20px;">
                    <input type="hidden" id="viewAdjustmentId">

                    <!-- Employee & Type Header -->
                    <div class="adjustment-detail-header">
                        <div class="adj-employee-info">
                            <span class="adj-employee-name" id="viewAdjustmentEmployee">-</span>
                            <span class="adj-employee-code" id="viewAdjustmentEmployeeCode">-</span>
                        </div>
                        <span class="adj-type-badge" id="viewAdjustmentType">-</span>
                    </div>

                    <!-- Amount Card -->
                    <div class="adjustment-amount-card">
                        <div class="adj-amount-main">
                            <span class="adj-amount-label">Amount</span>
                            <span class="adj-amount-value" id="viewAdjustmentAmount">-</span>
                        </div>
                        <div class="adj-amount-meta">
                            <div class="adj-meta-item">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                <span id="viewAdjustmentPeriod">-</span>
                            </div>
                            <div class="adj-meta-item">
                                <span class="adj-status-badge" id="viewAdjustmentStatus">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Reason -->
                    <div class="adjustment-reason-section">
                        <span class="adj-section-label">Reason</span>
                        <p class="adj-reason-text" id="viewAdjustmentReason">-</p>
                    </div>

                    <!-- Rejection Reason (if rejected) -->
                    <div class="adjustment-reason-section rejection" id="viewAdjustmentRejectionRow" style="display: none;">
                        <span class="adj-section-label">Rejection Reason</span>
                        <p class="adj-reason-text" id="viewAdjustmentRejectionReason">-</p>
                    </div>

                    <!-- Footer Meta -->
                    <div class="adjustment-footer-meta">
                        <div class="adj-footer-item">
                            <span class="adj-footer-label">Created</span>
                            <span class="adj-footer-value"><span id="viewAdjustmentCreatedAt">-</span> <span class="adj-by-text" id="viewAdjustmentCreatedBy"></span></span>
                        </div>
                        <div class="adj-footer-item" id="viewAdjustmentApprovedByRow" style="display: none;">
                            <span class="adj-footer-label">Approved</span>
                            <span class="adj-footer-value"><span id="viewAdjustmentApprovedAt">-</span> <span class="adj-by-text" id="viewAdjustmentApprovedBy"></span></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="viewAdjustmentFooter">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('viewAdjustmentModal')">Close</button>
                    <button type="button" class="btn btn-danger" id="btnRejectAdjustment" onclick="showRejectAdjustmentModal()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                        Reject
                    </button>
                    <button type="button" class="btn btn-success" id="btnApproveAdjustment" onclick="approveAdjustment()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Approve
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reject Adjustment Modal -->
    <div class="modal" id="rejectAdjustmentModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reject Adjustment</h5>
                    <button class="close-btn" onclick="closeModal('rejectAdjustmentModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="rejectAdjustmentId">
                    <div class="form-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adjustmentRejectReason">Reason for Rejection *</label>
                                <textarea class="form-control" id="adjustmentRejectReason" rows="3" placeholder="Please provide a reason for rejection..." required></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('rejectAdjustmentModal')">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmRejectAdjustment()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                        Reject
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/roleUtils.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/hrms-signalr.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/payroll.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</body>
</html>
