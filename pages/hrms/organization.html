<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script>document.write('<link rel="stylesheet" href="../../css/flatpickr-custom.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-organization.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-payroll.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/searchable-dropdown.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/brand_logo.png" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <!-- Navigation links rendered by Navigation.init() -->
        </div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <span class="current">Organization</span>
                </nav>
                <div class="hrms-header-row">
                    <!-- Hamburger Toggle Button -->
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation menu">
                        <!-- Hamburger icon (shown when sidebar closed) -->
                        <span class="hamburger-icon">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </span>
                        <!-- Left arrow icon (shown when sidebar open) -->
                        <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <path d="M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h1>Organization Setup</h1>
                </div>
                <div class="active-tab-title" id="activeTabTitle">
                    <span class="tab-indicator"></span>
                    <span id="activeTabName">Offices</span>
                </div>
            </div>
        </div>

        <!-- Sidebar Overlay (hidden by CSS) -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Sidebar + Content Layout -->
        <div class="organization-layout">
            <!-- Collapsible Sidebar Navigation -->
            <aside class="organization-sidebar gradient-bg-ambient" id="organizationSidebar">
                <div class="sidebar-header">
                    <h3>Organization</h3>
                </div>
                <nav class="sidebar-nav">
                    <!-- Locations Section -->
                    <div class="nav-group" data-group="locations">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                                Locations
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn active" data-tab="offices" id="officesTab">
                                <span class="nav-number">1</span><span class="nav-label">Offices</span>
                            </button>
                        </div>
                    </div>

                    <!-- Structure Section -->
                    <div class="nav-group" data-group="structure">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                    <line x1="8" y1="21" x2="16" y2="21"></line>
                                    <line x1="12" y1="17" x2="12" y2="21"></line>
                                </svg>
                                Structure
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn" data-tab="departments" id="departmentsTab">
                                <span class="nav-number">2</span><span class="nav-label">Departments</span>
                            </button>
                            <button class="sidebar-btn" data-tab="designations" id="designationsTab">
                                <span class="nav-number">3</span><span class="nav-label">Designations</span>
                            </button>
                        </div>
                    </div>

                    <!-- Scheduling Section -->
                    <div class="nav-group" data-group="scheduling">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                                Scheduling
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn" data-tab="shifts" id="shiftsTab">
                                <span class="nav-number">4</span><span class="nav-label">Shifts</span>
                            </button>
                            <button class="sidebar-btn" data-tab="shift-rosters" id="shiftRostersTab">
                                <span class="nav-number">5</span><span class="nav-label">Shift Rosters</span>
                            </button>
                            <button class="sidebar-btn" data-tab="holidays" id="holidaysTab">
                                <span class="nav-number">6</span><span class="nav-label">Holidays</span>
                            </button>
                        </div>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="organization-content">
                <!-- Offices Tab -->
        <div class="tab-content active" id="offices">
            <div class="filters-bar">
                <div class="searchable-dropdown-container" id="officeCountryFilterContainer"></div>
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="officeSearch" placeholder="Search offices...">
                </div>
                <label class="toggle-inactive-label">
                    <input type="checkbox" id="showInactiveOffices" onchange="loadOffices()">
                    <span>Show Inactive</span>
                </label>
                <button class="btn btn-primary" onclick="showCreateOfficeModal()" id="createOfficeBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Office
                </button>
            </div>

            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-value" id="totalOffices">0</div>
                    <div class="stat-label">Total Offices</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="headOfficeCount">0</div>
                    <div class="stat-label">Head Office</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="regionalOfficeCount">0</div>
                    <div class="stat-label">Regional</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="branchOfficeCount">0</div>
                    <div class="stat-label">Branch</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="satelliteOfficeCount">0</div>
                    <div class="stat-label">Satellite</div>
                </div>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Office Name</th>
                            <th>Code</th>
                            <th>Type</th>
                            <th>Location</th>
                            <th>Employees</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="officesTable">
                        <tr class="empty-state">
                            <td colspan="7">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                    </svg>
                                    <p>No offices configured</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="officesPagination" class="pagination-container"></div>
            </div>
        </div>

        <!-- Departments Tab -->
        <div class="tab-content" id="departments">
            <div class="filters-bar">
                <div class="searchable-dropdown-container" id="departmentCountryFilterContainer"></div>
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="departmentSearch" placeholder="Search departments...">
                </div>
                <div class="filter-group">
                    <select id="departmentOffice" class="form-select">
                        <option value="">All Offices</option>
                    </select>
                </div>
                <div class="view-toggle">
                    <button class="view-toggle-btn active" id="tableViewBtn" onclick="switchDepartmentView('table')" title="Table View">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="9" x2="21" y2="9"></line>
                            <line x1="3" y1="15" x2="21" y2="15"></line>
                            <line x1="9" y1="3" x2="9" y2="21"></line>
                        </svg>
                    </button>
                    <button class="view-toggle-btn" id="treeViewBtn" onclick="switchDepartmentView('tree')" title="Hierarchy View">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="8" y2="12"></line>
                            <line x1="16" y1="12" x2="19" y2="12"></line>
                            <circle cx="12" cy="5" r="2"></circle>
                            <circle cx="5" cy="12" r="2"></circle>
                            <circle cx="19" cy="12" r="2"></circle>
                            <circle cx="12" cy="19" r="2"></circle>
                        </svg>
                    </button>
                </div>
                <button class="btn btn-primary" onclick="showCreateDepartmentModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Department
                </button>
            </div>

            <!-- Department Hierarchy Tree View -->
            <div class="department-hierarchy" id="departmentHierarchy" style="display: none;">
                <div class="hierarchy-tree" id="hierarchyTree">
                    <!-- Tree structure will be rendered here -->
                </div>
            </div>

            <div class="data-table-container" id="departmentTableContainer">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Department Name</th>
                            <th>Code</th>
                            <th>Office</th>
                            <th>Designations</th>
                            <th>Employees</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="departmentsTable">
                        <tr class="empty-state">
                            <td colspan="7">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                                    </svg>
                                    <p>No departments configured</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="departmentsPagination" class="pagination-container"></div>
            </div>
        </div>

        <!-- Designations Tab -->
        <div class="tab-content" id="designations">
            <div class="filters-bar">
                <div class="searchable-dropdown-container" id="designationCountryFilterContainer"></div>
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="designationSearch" placeholder="Search designations...">
                </div>
                <div class="filter-group">
                    <select id="designationOffice" class="form-select">
                        <option value="">All Offices</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="designationDepartment" class="form-select">
                        <option value="">All Departments</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="showCreateDesignationModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Designation
                </button>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Designation</th>
                            <th>Code</th>
                            <th>Office</th>
                            <th>Department</th>
                            <th>Category</th>
                            <th>Level</th>
                            <th>Roles</th>
                            <th>Employees</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="designationsTable">
                        <tr class="empty-state">
                            <td colspan="10">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <path d="M20 7h-9"></path>
                                        <path d="M14 17H5"></path>
                                        <circle cx="17" cy="17" r="3"></circle>
                                        <circle cx="7" cy="7" r="3"></circle>
                                    </svg>
                                    <p>No designations configured</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="designationsPagination" class="pagination-container"></div>
            </div>
        </div>

        <!-- Shifts Tab -->
        <div class="tab-content" id="shifts">
            <div class="filters-bar">
                <div class="searchable-dropdown-container" id="shiftCountryFilterContainer"></div>
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="shiftSearch" placeholder="Search shifts...">
                </div>
                <div class="filter-group">
                    <select id="shiftOffice" class="form-select">
                        <option value="">All Offices</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="showCreateShiftModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Shift
                </button>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Shift Name</th>
                            <th>Code</th>
                            <th>Office</th>
                            <th>Timing</th>
                            <th>Working Hours</th>
                            <th>Weekend Days</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="shiftsTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    <p>No shifts configured</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="shiftsPagination" class="pagination-container"></div>
            </div>
        </div>

        <!-- Shift Rosters Tab -->
        <div class="tab-content" id="shift-rosters">
            <div class="filters-bar">
                <div class="searchable-dropdown-container" id="rosterCountryFilterContainer"></div>
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="rosterSearch" placeholder="Search employee...">
                </div>
                <div class="filter-group">
                    <select id="rosterOffice" class="form-select">
                        <option value="">All Offices</option>
                    </select>
                    <select id="rosterShift" class="form-select">
                        <option value="">All Shifts</option>
                    </select>
                </div>
                <button class="btn btn-outline" onclick="showBulkRosterModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Bulk Assign
                </button>
                <button class="btn btn-primary" onclick="showCreateRosterModal()" id="createRosterBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Assign Roster
                </button>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Shift</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Weekend Days</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="rostersTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    <p>No shift rosters configured</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="rostersPagination" class="pagination-container"></div>
            </div>
        </div>

        <!-- Holidays Tab -->
        <div class="tab-content" id="holidays">
            <div class="filters-bar">
                <div class="searchable-dropdown-container" id="holidayCountryFilterContainer"></div>
                <div class="filter-group">
                    <div class="searchable-dropdown-container" id="holidayYearPicker"></div>
                    <select id="holidayOffice" class="form-select">
                        <option value="">All Offices</option>
                    </select>
                    <select id="holidayType" class="form-select">
                        <option value="">All Types</option>
                        <option value="public">Public/National</option>
                        <option value="regional">Regional</option>
                        <option value="restricted">Restricted/Optional</option>
                        <option value="company">Company Holiday</option>
                    </select>
                </div>
                <button class="btn btn-outline" onclick="showBulkHolidayModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                    </svg>
                    Bulk Add
                </button>
                <button class="btn btn-primary" onclick="showCreateHolidayModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Holiday
                </button>
            </div>

            <div class="holidays-calendar" id="holidaysCalendar">
                <!-- Calendar will be rendered here -->
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Holiday Name</th>
                            <th>Date</th>
                            <th>Day</th>
                            <th>Type</th>
                            <th>Offices</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="holidaysTable">
                        <tr class="empty-state">
                            <td colspan="6">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    <p>No holidays configured</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="holidaysPagination" class="pagination-container"></div>
            </div>
        </div>
            </main>
        </div>

    <!-- Create/Edit Office Modal -->
    <div id="officeModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="officeModalTitle">Create Office</h5>
                    <button class="close-btn" onclick="closeModal('officeModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body office-modal-compact">
                <form id="officeForm">
                    <input type="hidden" id="officeId" name="id">

                    <!-- Row 1: Name, Code, Type -->
                    <div class="form-row three-col">
                        <div class="form-group">
                            <label for="officeName">Office Name *</label>
                            <input type="text" id="officeName" name="name" class="form-control" required placeholder="Mumbai Headquarters">
                        </div>
                        <div class="form-group">
                            <label for="officeCode">Code *</label>
                            <input type="text" id="officeCode" name="code" class="form-control" required placeholder="MUM-HQ" style="text-transform: uppercase;">
                        </div>
                        <div class="form-group">
                            <label for="officeType">Type *</label>
                            <select id="officeType" name="type" class="form-control" required>
                                <option value="">Select</option>
                                <option value="head">Headquarters</option>
                                <option value="regional">Regional</option>
                                <option value="branch">Branch</option>
                                <option value="satellite">Satellite</option>
                            </select>
                        </div>
                    </div>

                    <!-- Row 2: Timezone, Phone, Email -->
                    <div class="form-row three-col">
                        <div class="form-group">
                            <label for="officeTimezoneSearch">Timezone *</label>
                            <div class="searchable-dropdown" id="timezoneDropdown">
                                <div class="searchable-dropdown-trigger" id="timezoneTrigger" onclick="toggleSearchableDropdown('timezone')">
                                    <span class="dropdown-selection" id="timezoneSelection">Select Timezone</span>
                                    <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                                </div>
                                <div class="searchable-dropdown-menu" id="timezoneMenu">
                                    <div class="dropdown-search-box">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                                        <input type="text" id="timezoneSearch" class="dropdown-search-input" placeholder="Search..." oninput="filterTimezones()">
                                    </div>
                                    <div class="dropdown-options" id="timezoneOptions"></div>
                                </div>
                                <input type="hidden" id="officeTimezone" name="timezone" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="officePhone">Phone</label>
                            <input type="tel" id="officePhone" name="phone" class="form-control" placeholder="+91-22-12345678">
                        </div>
                        <div class="form-group">
                            <label for="officeEmail">Email</label>
                            <input type="email" id="officeEmail" name="email" class="form-control" placeholder="office@company.com">
                        </div>
                    </div>

                    <!-- Row 3: Address (full width) -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="officeAddress">Street Address</label>
                            <input type="text" id="officeAddress" name="address" class="form-control" placeholder="123 Business Park, Main Street">
                        </div>
                    </div>

                    <!-- Row 4: City, State, Country, Postal -->
                    <div class="form-row four-col">
                        <div class="form-group">
                            <label for="officeCity">City *</label>
                            <input type="text" id="officeCity" name="city" class="form-control" required placeholder="Mumbai">
                        </div>
                        <div class="form-group">
                            <label for="officeStateSearch">State</label>
                            <div class="searchable-dropdown" id="stateDropdown">
                                <div class="searchable-dropdown-trigger" id="stateTrigger" onclick="toggleStateDropdown()">
                                    <span class="dropdown-selection placeholder" id="stateSelection">Select State</span>
                                    <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                                </div>
                                <div class="searchable-dropdown-menu" id="stateMenu">
                                    <div class="dropdown-search-box">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                                        <input type="text" id="stateSearch" class="dropdown-search-input" placeholder="Search..." oninput="filterStates()">
                                    </div>
                                    <div class="dropdown-options" id="stateOptions"></div>
                                </div>
                                <input type="hidden" id="officeState" name="state">
                                <input type="hidden" id="officeStateCode" name="state_code">
                                <input type="hidden" id="officeStateId" name="state_id">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="officeCountrySearch">Country *</label>
                            <div class="searchable-dropdown" id="countryDropdown">
                                <div class="searchable-dropdown-trigger" id="countryTrigger" onclick="toggleSearchableDropdown('country')">
                                    <span class="dropdown-selection" id="countrySelection">Select</span>
                                    <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                                </div>
                                <div class="searchable-dropdown-menu" id="countryMenu">
                                    <div class="dropdown-search-box">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                                        <input type="text" id="countrySearch" class="dropdown-search-input" placeholder="Search..." oninput="filterCountries()">
                                    </div>
                                    <div class="dropdown-options" id="countryOptions"></div>
                                </div>
                                <input type="hidden" id="officeCountry" name="country" required>
                                <input type="hidden" id="officeCountryCode" name="country_code">
                                <input type="hidden" id="officeCountryId" name="country_id">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="officePostalCode">Postal</label>
                            <input type="text" id="officePostalCode" name="postal_code" class="form-control" placeholder="400001">
                        </div>
                    </div>

                    <!-- Row 5: Geofence - Lat, Long, Radius -->
                    <div class="form-row three-col geofence-row">
                        <div class="form-group">
                            <label for="officeLatitude">Latitude</label>
                            <input type="number" id="officeLatitude" name="latitude" class="form-control" step="0.00000001" placeholder="19.0760">
                        </div>
                        <div class="form-group">
                            <label for="officeLongitude">Longitude</label>
                            <input type="number" id="officeLongitude" name="longitude" class="form-control" step="0.00000001" placeholder="72.8777">
                        </div>
                        <div class="form-group">
                            <label for="officeGeofenceRadius">Radius (m)</label>
                            <input type="number" id="officeGeofenceRadius" name="geofence_radius_meters" class="form-control" min="50" max="5000" value="100" placeholder="100">
                        </div>
                    </div>

                    <!-- Row 6: All settings toggles inline -->
                    <div class="form-row office-toggles-row">
                        <div class="toggle-inline">
                            <label class="toggle-switch small">
                                <input type="checkbox" id="officeEnableGeofence" name="enable_geofence_attendance">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-inline-label">Geofence</span>
                        </div>
                        <div class="toggle-inline">
                            <label class="toggle-switch small">
                                <input type="checkbox" id="officeIsActive" name="isActive" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-inline-label">Active</span>
                        </div>
                    </div>
                </form>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveOffice()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Save Office
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Department Modal -->
    <div id="departmentModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="departmentModalTitle">Create Department</h5>
                    <button class="close-btn" onclick="closeModal('departmentModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="departmentForm">
                        <input type="hidden" id="departmentId" name="id">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="departmentName">Department Name *</label>
                                    <input type="text" id="departmentName" name="name" class="form-control" required placeholder="e.g., Engineering">
                                </div>
                                <div class="form-group">
                                    <label for="departmentCode">Code *</label>
                                    <input type="text" id="departmentCode" name="code" class="form-control" required placeholder="e.g., ENG">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="deptOffice">Office *</label>
                                    <select id="deptOffice" name="officeId" class="form-control" required>
                                        <option value="">Select Office</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="deptHead">Department Head</label>
                                    <select id="deptHead" name="headId" class="form-control">
                                        <option value="">Select Employee</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="departmentDescription">Description</label>
                                    <textarea id="departmentDescription" name="description" class="form-control" rows="2" placeholder="Brief description"></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="status-toggle-row">
                                        <label>Status</label>
                                        <div class="status-toggle-container">
                                            <span class="status-label inactive">Inactive</span>
                                            <label class="status-toggle">
                                                <input type="checkbox" id="departmentIsActive" name="isActive" checked>
                                                <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                            </label>
                                            <span class="status-label active">Active</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveDepartment()">Save Department</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Designation Modal -->
    <div id="designationModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="designationModalTitle">Create Designation</h5>
                    <button class="close-btn" onclick="closeModal('designationModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="designationForm">
                        <input type="hidden" id="designationId" name="id">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="designationName">Designation Name *</label>
                                    <input type="text" id="designationName" name="name" class="form-control" required placeholder="e.g., Software Engineer">
                                </div>
                                <div class="form-group">
                                    <label for="designationCode">Code *</label>
                                    <input type="text" id="designationCode" name="code" class="form-control" required placeholder="e.g., SE">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Office & Department *</label>
                                    <div class="nested-dropdown" id="officeDeptDropdown">
                                        <div class="nested-dropdown-trigger" id="officeDeptTrigger">
                                            <div class="nested-dropdown-selection">
                                                <span class="selection-text" id="officeDeptSelectionText">Select Office & Department</span>
                                            </div>
                                            <svg class="dropdown-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="nested-dropdown-menu" id="officeDeptMenu">
                                            <div class="dropdown-search-wrapper">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"></circle>
                                                    <path d="m21 21-4.35-4.35"></path>
                                                </svg>
                                                <input type="text" class="dropdown-search" id="officeDeptSearch" placeholder="Search offices or departments...">
                                            </div>
                                            <div class="dropdown-items-container" id="officeDeptItems">
                                                <!-- Items populated by JS -->
                                            </div>
                                        </div>
                                        <!-- Hidden inputs to store selected values -->
                                        <input type="hidden" id="desigOffice" name="officeId" required>
                                        <input type="hidden" id="desigDepartment" name="departmentId" required>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="desigLevel">Level</label>
                                    <input type="number" id="desigLevel" name="level" class="form-control" min="1" max="20" value="1">
                                </div>
                                <div class="form-group">
                                    <label for="desigCategory">Category</label>
                                    <input type="text" id="desigCategory" name="roleCategory" class="form-control" placeholder="e.g., Technical, Management">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Default HRMS Roles</label>
                                    <small class="form-text" style="margin-bottom: 8px;">Select the roles that employees with this designation will automatically receive.</small>
                                    <div class="hrms-roles-grid">
                                        <div class="role-category-group">
                                            <div class="role-category-label">Organizational Roles</div>
                                            <div class="role-toggle-item">
                                                <div class="role-toggle-info">
                                                    <span class="role-name">USER</span>
                                                    <span class="role-desc">Basic self-service access (always assigned)</span>
                                                </div>
                                                <label class="role-toggle disabled">
                                                    <input type="checkbox" name="hrmsRoles" value="HRMS_USER" checked disabled>
                                                    <span class="role-toggle-track"><span class="role-toggle-thumb"></span></span>
                                                </label>
                                            </div>
                                            <div class="role-toggle-item">
                                                <div class="role-toggle-info">
                                                    <span class="role-name">MANAGER</span>
                                                    <span class="role-desc">Approve team leaves & attendance</span>
                                                </div>
                                                <label class="role-toggle">
                                                    <input type="checkbox" name="hrmsRoles" value="HRMS_MANAGER" id="roleHrmsManager">
                                                    <span class="role-toggle-track"><span class="role-toggle-thumb"></span></span>
                                                </label>
                                            </div>
                                            <div class="role-toggle-item">
                                                <div class="role-toggle-info">
                                                    <span class="role-name">ADMIN</span>
                                                    <span class="role-desc">Full administrative access</span>
                                                </div>
                                                <label class="role-toggle">
                                                    <input type="checkbox" name="hrmsRoles" value="HRMS_ADMIN" id="roleHrmsAdmin">
                                                    <span class="role-toggle-track"><span class="role-toggle-thumb"></span></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="role-category-group">
                                            <div class="role-category-label">HR Department Roles</div>
                                            <div class="role-toggle-item">
                                                <div class="role-toggle-info">
                                                    <span class="role-name">HR USER</span>
                                                    <span class="role-desc">Basic HR read access</span>
                                                </div>
                                                <label class="role-toggle">
                                                    <input type="checkbox" name="hrmsRoles" value="HRMS_HR_USER" id="roleHrmsHrUser">
                                                    <span class="role-toggle-track"><span class="role-toggle-thumb"></span></span>
                                                </label>
                                            </div>
                                            <div class="role-toggle-item">
                                                <div class="role-toggle-info">
                                                    <span class="role-name">HR MANAGER</span>
                                                    <span class="role-desc">HR department manager</span>
                                                </div>
                                                <label class="role-toggle">
                                                    <input type="checkbox" name="hrmsRoles" value="HRMS_HR_MANAGER" id="roleHrmsHrManager">
                                                    <span class="role-toggle-track"><span class="role-toggle-thumb"></span></span>
                                                </label>
                                            </div>
                                            <div class="role-toggle-item">
                                                <div class="role-toggle-info">
                                                    <span class="role-name">HR ADMIN</span>
                                                    <span class="role-desc">Full HR operations (employee CRUD, transfers)</span>
                                                </div>
                                                <label class="role-toggle">
                                                    <input type="checkbox" name="hrmsRoles" value="HRMS_HR_ADMIN" id="roleHrmsHrAdmin">
                                                    <span class="role-toggle-track"><span class="role-toggle-thumb"></span></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="designationDescription">Description</label>
                                    <textarea id="designationDescription" name="description" class="form-control" rows="2" placeholder="Job responsibilities"></textarea>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Attendance Exempt</label>
                                    <small class="form-text" style="color: var(--text-secondary); margin-bottom: 8px;">
                                        If enabled, employees are not required to clock in/out for payroll.
                                    </small>
                                    <div class="status-toggle-container">
                                        <span class="status-label inactive">Required</span>
                                        <label class="status-toggle">
                                            <input type="checkbox" id="designationAttendanceExempt" name="isAttendanceExempt">
                                            <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                        </label>
                                        <span class="status-label active">Exempt</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <small class="form-text" style="color: var(--text-secondary); margin-bottom: 8px;">
                                        &nbsp;
                                    </small>
                                    <div class="status-toggle-container">
                                        <span class="status-label inactive">Inactive</span>
                                        <label class="status-toggle">
                                            <input type="checkbox" id="designationIsActive" name="isActive" checked>
                                            <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                        </label>
                                        <span class="status-label active">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveDesignation()">Save Designation</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Shift Modal -->
    <div id="shiftModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="shiftModalTitle">Create Shift</h5>
                    <button class="close-btn" onclick="closeModal('shiftModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="shiftForm">
                        <input type="hidden" id="shiftId" name="id">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="shiftName">Shift Name *</label>
                                    <input type="text" id="shiftName" name="name" class="form-control" required placeholder="e.g., Day Shift">
                                </div>
                                <div class="form-group">
                                    <label for="shiftCode">Code *</label>
                                    <input type="text" id="shiftCode" name="code" class="form-control" required placeholder="e.g., DAY">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="shiftOfficeId">Office *</label>
                                    <select id="shiftOfficeId" name="officeId" class="form-control" required>
                                        <option value="">Select Office</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="shiftStart">Start Time *</label>
                                    <input type="text" id="shiftStart" name="startTime" class="form-control time-picker" required placeholder="09:00 AM">
                                </div>
                                <div class="form-group">
                                    <label for="shiftEnd">End Time *</label>
                                    <input type="text" id="shiftEnd" name="endTime" class="form-control time-picker" required placeholder="06:00 PM">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="breakStart">Break Start</label>
                                    <input type="text" id="breakStart" name="breakStart" class="form-control time-picker" placeholder="01:00 PM">
                                </div>
                                <div class="form-group">
                                    <label for="breakEnd">Break End</label>
                                    <input type="text" id="breakEnd" name="breakEnd" class="form-control time-picker" placeholder="02:00 PM">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="graceMinutes">Grace Period (minutes)</label>
                                    <input type="number" id="graceMinutes" name="graceMinutes" class="form-control" min="0" value="15">
                                </div>
                                <div class="form-group">
                                    <label for="halfDayHours">Half Day Hours</label>
                                    <input type="number" id="halfDayHours" name="halfDayHours" class="form-control" min="1" step="0.5" value="4">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Working Days</label>
                                    <div class="day-toggle-group">
                                        <input type="checkbox" id="shiftDay_mon" name="workingDays" value="monday" checked class="day-toggle-input">
                                        <label for="shiftDay_mon" class="day-toggle-btn">Mon</label>

                                        <input type="checkbox" id="shiftDay_tue" name="workingDays" value="tuesday" checked class="day-toggle-input">
                                        <label for="shiftDay_tue" class="day-toggle-btn">Tue</label>

                                        <input type="checkbox" id="shiftDay_wed" name="workingDays" value="wednesday" checked class="day-toggle-input">
                                        <label for="shiftDay_wed" class="day-toggle-btn">Wed</label>

                                        <input type="checkbox" id="shiftDay_thu" name="workingDays" value="thursday" checked class="day-toggle-input">
                                        <label for="shiftDay_thu" class="day-toggle-btn">Thu</label>

                                        <input type="checkbox" id="shiftDay_fri" name="workingDays" value="friday" checked class="day-toggle-input">
                                        <label for="shiftDay_fri" class="day-toggle-btn">Fri</label>

                                        <input type="checkbox" id="shiftDay_sat" name="workingDays" value="saturday" class="day-toggle-input">
                                        <label for="shiftDay_sat" class="day-toggle-btn">Sat</label>

                                        <input type="checkbox" id="shiftDay_sun" name="workingDays" value="sunday" class="day-toggle-input">
                                        <label for="shiftDay_sun" class="day-toggle-btn">Sun</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row office-toggles-row">
                                <div class="toggle-inline">
                                    <label class="toggle-switch small">
                                        <input type="checkbox" id="shiftEnableGeofence" name="enable_geofence_attendance">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-inline-label">Geofence Attendance</span>
                                </div>
                                <div class="toggle-inline">
                                    <label class="toggle-switch small">
                                        <input type="checkbox" id="shiftIsActive" name="isActive" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-inline-label">Active</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveShift()">Save Shift</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Holiday Modal -->
    <div id="holidayModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="holidayModalTitle">Create Holiday</h5>
                    <button class="close-btn" onclick="closeModal('holidayModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="holidayForm">
                        <input type="hidden" id="holidayId" name="id">
                        <div class="form-section">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="holidayName">Holiday Name *</label>
                                    <input type="text" id="holidayName" name="name" class="form-control" required placeholder="e.g., Republic Day">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="holidayDate">Date *</label>
                                    <input type="date" id="holidayDate" name="date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="holidayTypeSelect">Type *</label>
                                    <select id="holidayTypeSelect" name="type" class="form-control" required>
                                        <option value="public">Public/National Holiday</option>
                                        <option value="regional">Regional Holiday</option>
                                        <option value="restricted">Restricted/Optional Holiday</option>
                                        <option value="company">Company Holiday</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="holidayOffices">Applicable Office</label>
                                    <select id="holidayOffices" name="office_id" class="form-control">
                                        <option value="">All Offices (National Holiday)</option>
                                        <!-- Populated dynamically -->
                                    </select>
                                    <small class="form-text">Select specific office for regional holiday, or leave as "All Offices" for national holidays.</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="holidayDescription">Description</label>
                                    <textarea id="holidayDescription" name="description" class="form-control" rows="2" placeholder="Brief description"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveHoliday()">Save Holiday</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Roster Modal -->
    <div id="rosterModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="rosterModalTitle">Assign Shift Roster</h5>
                    <button class="close-btn" onclick="closeModal('rosterModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="rosterForm">
                        <input type="hidden" id="rosterId" name="id">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="rosterEmployee">Employee *</label>
                                    <select id="rosterEmployee" name="employee_id" class="form-control" required>
                                        <option value="">Select Employee</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="rosterShiftId">Shift *</label>
                                    <select id="rosterShiftId" name="shift_id" class="form-control" required>
                                        <option value="">Select Shift</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="rosterStartDate">Start Date *</label>
                                    <input type="date" id="rosterStartDate" name="start_date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="rosterEndDate">End Date</label>
                                    <input type="date" id="rosterEndDate" name="end_date" class="form-control">
                                    <small class="form-text">Leave empty for ongoing assignment</small>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="rosterType">Roster Type</label>
                                    <select id="rosterType" name="roster_type" class="form-control">
                                        <option value="scheduled">Scheduled</option>
                                        <option value="temporary">Temporary</option>
                                        <option value="swap">Swap</option>
                                        <option value="override">Override</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="rosterNotes">Notes</label>
                                    <input type="text" id="rosterNotes" name="notes" class="form-control" placeholder="Optional notes">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="status-toggle-row">
                                        <label>Status</label>
                                        <div class="status-toggle-container">
                                            <span class="status-label inactive">Inactive</span>
                                            <label class="status-toggle">
                                                <input type="checkbox" id="rosterIsActive" name="is_active" checked>
                                                <span class="status-toggle-track"><span class="status-toggle-thumb"></span></span>
                                            </label>
                                            <span class="status-label active">Active</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveRoster()">Save Roster</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Holiday Modal -->
    <div id="bulkHolidayModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bulk Add Holidays</h5>
                    <button class="close-btn" onclick="closeModal('bulkHolidayModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <div class="bulk-info-bar">
                        <p>Add multiple holidays at once. You can add up to 20 holidays in a single operation.</p>
                    </div>
                    <div class="form-row two-col" style="margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="bulkHolidayYear">Year *</label>
                            <select id="bulkHolidayYear" class="form-control">
                                <!-- Years populated dynamically by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="bulkHolidayOffice">Apply to Office *</label>
                            <select id="bulkHolidayOffice" class="form-control">
                                <option value="">All Offices</option>
                            </select>
                        </div>
                    </div>
                    <div class="bulk-entries-container" id="bulkHolidayEntries">
                        <!-- Dynamic holiday entries will be added here -->
                    </div>
                    <button class="btn btn-outline btn-sm" onclick="addBulkHolidayRow()" style="margin-top: 12px;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Another Holiday
                    </button>
                </div>
                <div class="modal-footer">
                    <span class="bulk-count" id="bulkHolidayCount">0 holidays to add</span>
                    <button type="button" class="btn btn-primary" onclick="saveBulkHolidays()">Add All Holidays</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Roster Modal -->
    <div id="bulkRosterModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bulk Assign Shift Rosters</h5>
                    <button class="close-btn" onclick="closeModal('bulkRosterModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <div class="bulk-info-bar">
                        <p>Assign the same shift to multiple employees at once.</p>
                    </div>
                    <form id="bulkRosterForm">
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="bulkRosterShift">Shift *</label>
                                <select id="bulkRosterShift" class="form-control" required>
                                    <option value="">Select Shift</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="bulkRosterType">Roster Type</label>
                                <select id="bulkRosterType" class="form-control">
                                    <option value="scheduled">Scheduled</option>
                                    <option value="temporary">Temporary</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="bulkRosterStartDate">Start Date *</label>
                                <input type="date" id="bulkRosterStartDate" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="bulkRosterEndDate">End Date</label>
                                <input type="date" id="bulkRosterEndDate" class="form-control">
                                <small class="form-text">Leave empty for ongoing assignment</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Select Employees *</label>
                            <div class="employee-filter-row">
                                <select id="bulkRosterDepartmentFilter" class="form-control" onchange="filterBulkRosterEmployees()">
                                    <option value="">All Departments</option>
                                </select>
                                <button type="button" class="btn btn-outline btn-sm" onclick="selectAllBulkRosterEmployees()">Select All</button>
                                <button type="button" class="btn btn-outline btn-sm" onclick="deselectAllBulkRosterEmployees()">Deselect All</button>
                            </div>
                            <div class="employee-checkbox-grid" id="bulkRosterEmployees">
                                <!-- Employee checkboxes will be populated here -->
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <span class="bulk-count" id="bulkRosterCount">0 employees selected</span>
                    <button type="button" class="btn btn-primary" onclick="saveBulkRosters()">Assign Rosters</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="versionHistoryModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="versionHistoryTitle">Version History</h5>
                    <button class="close-btn" onclick="closeModal('versionHistoryModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="version-info-banner">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>Structure versions track component changes over time. Each version has an effective date for mid-month proration calculations.</span>
                    </div>
                    <div class="data-table-container" style="max-height: 400px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Version</th>
                                    <th>Effective From</th>
                                    <th>Effective To</th>
                                    <th>Components</th>
                                    <th>Change Reason</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="versionHistoryTable">
                                <tr class="empty-state">
                                    <td colspan="6">
                                        <div class="empty-message">
                                            <p>No versions found</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="openArrearsModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Manage Arrears
                    </button>
                    <button type="button" class="btn btn-outline" onclick="openBulkAssignModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Bulk Assign
                    </button>
                    <button type="button" class="btn btn-outline" onclick="previewVersionedSalary()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="9" x2="21" y2="9"></line>
                            <line x1="9" y1="21" x2="9" y2="9"></line>
                        </svg>
                        Preview Calculation
                    </button>
                    <button type="button" class="btn btn-primary" onclick="showCreateVersionModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Create New Version
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Version Modal -->
    <div class="modal" id="createVersionModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createVersionModalTitle">Create New Version</h5>
                    <button class="close-btn" onclick="closeModal('createVersionModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="newVersionForm">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="versionEffectiveDate">Effective From *</label>
                                    <input type="date" id="versionEffectiveDate" name="effectiveFrom" class="form-control" required>
                                    <small class="form-text text-muted">Payroll will use this version for days after this date</small>
                                </div>
                                <div class="form-group">
                                    <label for="versionChangeReason">Change Reason</label>
                                    <input type="text" id="versionChangeReason" name="changeReason" class="form-control" placeholder="e.g., Added Professional Tax">
                                </div>
                            </div>
                        </div>
                        <div class="form-section">
                            <h3>Components</h3>
                            <p class="text-muted">Select components and set their values for this version</p>
                            <div class="version-components-list" id="newVersionComponents">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveNewVersion()">Create Version</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Version Details Modal -->
    <div class="modal" id="versionDetailsModal">
        <div class="modal-dialog modal-dialog-centered modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <span id="versionDetailsTitle">Version Details</span>
                        <span class="version-badge" id="versionBadge">v1</span>
                    </h5>
                    <button class="close-btn" onclick="closeModal('versionDetailsModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Version Info Cards -->
                    <div class="version-detail-cards">
                        <div class="version-detail-card">
                            <div class="version-detail-icon effective-from">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div class="version-detail-content">
                                <span class="version-detail-label">Effective From</span>
                                <span class="version-detail-value" id="versionEffectiveFrom">-</span>
                            </div>
                        </div>
                        <div class="version-detail-card">
                            <div class="version-detail-icon effective-to">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </div>
                            <div class="version-detail-content">
                                <span class="version-detail-label">Effective To</span>
                                <span class="version-detail-value" id="versionEffectiveTo">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Change Reason -->
                    <div class="version-reason-section">
                        <h6 class="section-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                            </svg>
                            Change Reason
                        </h6>
                        <p class="version-reason-text" id="versionChangeReason">-</p>
                    </div>

                    <!-- Components Table -->
                    <div class="version-components-section">
                        <h6 class="section-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                            </svg>
                            Components
                            <span class="component-count" id="versionComponentCount">0</span>
                        </h6>
                        <div class="version-components-table-wrapper">
                            <table class="version-components-table">
                                <thead>
                                    <tr>
                                        <th>Component</th>
                                        <th>Type</th>
                                        <th class="text-right">Value</th>
                                    </tr>
                                </thead>
                                <tbody id="versionComponentsBody">
                                    <tr>
                                        <td colspan="3" class="text-center text-muted">No components</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Arrears Management Modal -->
    <div class="modal" id="arrearsModal">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="arrearsModalTitle">Version Arrears Management</h5>
                    <button class="close-btn" onclick="closeModal('arrearsModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body arrears-modal-body">
                    <div class="arrears-info-alert">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>Arrears are automatically calculated when a version is created with a retrospective effective date. Review and apply them to the next payroll.</span>
                    </div>

                    <div class="arrears-summary" id="arrearsSummary">
                        <div class="arrears-stat">
                            <span class="arrears-stat-label">Total Employees Affected</span>
                            <span class="arrears-stat-value" id="arrearsEmployeeCount">0</span>
                        </div>
                        <div class="arrears-stat">
                            <span class="arrears-stat-label">Total Arrears Amount</span>
                            <span class="arrears-stat-value text-success" id="arrearsTotalAmount">₹0.00</span>
                        </div>
                        <div class="arrears-stat">
                            <span class="arrears-stat-label">Pending Arrears</span>
                            <span class="arrears-stat-value text-warning" id="arrearsPendingCount">0</span>
                        </div>
                    </div>

                    <div class="data-table-container" style="max-height: 400px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllArrears" onchange="toggleAllArrears()"></th>
                                    <th>Employee</th>
                                    <th>Month/Year</th>
                                    <th>Old Gross</th>
                                    <th>New Gross</th>
                                    <th>Arrears</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="arrearsTable">
                                <tr class="empty-state">
                                    <td colspan="8">
                                        <div class="empty-message">
                                            <p>No arrears found</p>
                                            <small class="text-muted">Arrears are created when versions have retrospective effective dates</small>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer arrears-modal-footer">
                    <button type="button" class="btn btn-sm btn-outline" onclick="refreshArrears()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                        Refresh
                    </button>
                    <div class="arrears-action-buttons">
                        <button type="button" class="btn btn-sm btn-danger-outline" onclick="cancelSelectedArrears()" id="cancelArrearsBtn" disabled>
                            Cancel Selected
                        </button>
                        <button type="button" class="btn btn-sm btn-primary" onclick="applySelectedArrears()" id="applyArrearsBtn" disabled>
                            Apply to Payroll
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Salary Calculation Preview Modal -->
    <div class="modal" id="salaryPreviewModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Salary Calculation Preview</h5>
                    <button class="close-btn" onclick="closeModal('salaryPreviewModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body salary-preview-body">
                    <div class="salary-preview-input">
                        <label for="previewCtcInput">Enter CTC / Annual Gross</label>
                        <div class="input-with-currency">
                            <span class="currency-symbol">₹</span>
                            <input type="number" id="previewCtcInput" placeholder="e.g., 1200000" min="0" step="1000" oninput="calculateSalaryPreview()">
                        </div>
                        <small class="text-muted">Enter annual CTC to see monthly salary breakdown</small>
                    </div>

                    <div class="salary-preview-results" id="salaryPreviewResults" style="display: none;">
                        <div class="preview-summary-cards">
                            <div class="preview-card">
                                <span class="preview-card-label">Monthly Gross</span>
                                <span class="preview-card-value" id="previewMonthlyGross">₹0</span>
                            </div>
                            <div class="preview-card earnings">
                                <span class="preview-card-label">Total Earnings</span>
                                <span class="preview-card-value" id="previewTotalEarnings">₹0</span>
                            </div>
                            <div class="preview-card deductions">
                                <span class="preview-card-label">Total Deductions</span>
                                <span class="preview-card-value" id="previewTotalDeductions">₹0</span>
                            </div>
                            <div class="preview-card net">
                                <span class="preview-card-label">Net Pay</span>
                                <span class="preview-card-value" id="previewNetPay">₹0</span>
                            </div>
                        </div>

                        <div class="preview-breakdown">
                            <div class="preview-section">
                                <h4>Earnings</h4>
                                <div class="preview-table" id="previewEarningsTable">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                            <div class="preview-section">
                                <h4>Deductions</h4>
                                <div class="preview-table" id="previewDeductionsTable">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="salary-preview-empty" id="salaryPreviewEmpty">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="9" x2="21" y2="9"></line>
                            <line x1="9" y1="21" x2="9" y2="9"></line>
                        </svg>
                        <p>Enter a CTC amount to preview salary calculation</p>
                        <small>Based on the current salary structure components</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Assignment Modal -->
    <div class="modal" id="bulkAssignModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bulkAssignModalTitle">Bulk Version Assignment</h5>
                    <button class="close-btn" onclick="closeModal('bulkAssignModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body bulk-assign-body">
                    <div class="bulk-assign-info">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <span>Assign a salary structure version to multiple employees at once. Filter by office, department, or designation.</span>
                    </div>

                    <form id="bulkAssignForm">
                        <div class="form-section">
                            <h4 class="section-title">Filter Employees</h4>
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label for="bulkOfficeId">Office</label>
                                    <select id="bulkOfficeId" class="form-control" onchange="previewBulkAssignment()">
                                        <option value="">All Offices</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="bulkDepartmentId">Department</label>
                                    <select id="bulkDepartmentId" class="form-control" onchange="previewBulkAssignment()">
                                        <option value="">All Departments</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="bulkDesignationId">Designation</label>
                                    <select id="bulkDesignationId" class="form-control" onchange="previewBulkAssignment()">
                                        <option value="">All Designations</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4 class="section-title">Assignment Details</h4>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="bulkEffectiveFrom">Effective From *</label>
                                    <input type="date" id="bulkEffectiveFrom" class="form-control" required onchange="previewBulkAssignment()">
                                </div>
                                <div class="form-group">
                                    <label for="bulkReason">Reason</label>
                                    <input type="text" id="bulkReason" class="form-control" placeholder="e.g., FY 2025-26 structure update">
                                </div>
                            </div>
                            <div class="toggle-option">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="bulkCalculateArrears" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Calculate arrears for affected employees</span>
                            </div>
                        </div>

                        <div class="form-section" id="bulkPreviewSection" style="display: none;">
                            <h4 class="section-title">Preview</h4>
                            <div class="bulk-preview-summary" style="display: flex; gap: 24px; margin-bottom: 16px;">
                                <div style="padding: 12px; background: var(--color-info-light); border-radius: 8px; flex: 1;">
                                    <span class="text-muted">Employees Matched</span>
                                    <h4 id="bulkMatchedCount" style="margin: 4px 0;">0</h4>
                                </div>
                                <div style="padding: 12px; background: var(--color-success-light); border-radius: 8px; flex: 1;">
                                    <span class="text-muted">To Be Assigned</span>
                                    <h4 id="bulkToAssignCount" class="text-success" style="margin: 4px 0;">0</h4>
                                </div>
                                <div style="padding: 12px; background: var(--color-warning-light); border-radius: 8px; flex: 1;">
                                    <span class="text-muted">Est. Arrears</span>
                                    <h4 id="bulkEstArrears" class="text-warning-dark" style="margin: 4px 0;">₹0.00</h4>
                                </div>
                            </div>
                            <div class="data-table-container" style="max-height: 200px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Employee</th>
                                            <th>Current Structure</th>
                                            <th>CTC</th>
                                            <th>Est. Arrears</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bulkPreviewTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer bulk-assign-footer">
                    <button type="button" class="btn btn-sm btn-outline" onclick="previewBulkAssignment()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        Preview
                    </button>
                    <button type="button" class="btn btn-sm btn-primary" onclick="executeBulkAssignment()" id="executeBulkBtn" disabled>
                        Execute Assignment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Version Comparison Modal -->
    <div class="modal" id="versionCompareModal">
        <div class="modal-dialog modal-dialog-centered modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="versionCompareTitle">Version Comparison</h5>
                    <button class="close-btn" onclick="closeModal('versionCompareModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Version comparison header -->
                    <div class="version-compare-header">
                        <div class="version-box">
                            <span class="version-label">From</span>
                            <span class="version-number" id="compareFromVersion">v1</span>
                            <span class="version-date" id="compareFromDate">-</span>
                        </div>
                        <div class="version-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                <polyline points="12 5 19 12 12 19"></polyline>
                            </svg>
                        </div>
                        <div class="version-box">
                            <span class="version-label">To</span>
                            <span class="version-number" id="compareToVersion">v2</span>
                            <span class="version-date" id="compareToDate">-</span>
                        </div>
                    </div>

                    <!-- Summary badges -->
                    <div class="version-compare-summary">
                        <span class="compare-badge added" id="addedCount">+ 0 Added</span>
                        <span class="compare-badge removed" id="removedCount">- 0 Removed</span>
                        <span class="compare-badge modified" id="modifiedCount">~ 0 Modified</span>
                        <span class="compare-badge unchanged" id="unchangedCount">= 0 Unchanged</span>
                    </div>

                    <!-- Change details -->
                    <div class="version-compare-details">
                        <div id="addedSection" class="compare-section added">
                            <h6 class="compare-section-title added">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Added Components
                            </h6>
                            <div id="addedList" class="compare-list"></div>
                        </div>

                        <div id="removedSection" class="compare-section removed">
                            <h6 class="compare-section-title removed">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Removed Components
                            </h6>
                            <div id="removedList" class="compare-list"></div>
                        </div>

                        <div id="modifiedSection" class="compare-section modified">
                            <h6 class="compare-section-title modified">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                                Modified Components
                            </h6>
                            <div id="modifiedList" class="compare-list"></div>
                        </div>

                        <div id="unchangedSection" class="compare-section unchanged">
                            <h6 class="compare-section-title unchanged">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                                Unchanged Components
                            </h6>
                            <div id="unchangedList" class="compare-list unchanged-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/roleUtils.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/hrms-signalr.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/office-selection.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/searchable-dropdown.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/table-pagination.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/organization.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>

    <!-- Flatpickr for Date/Time Picker -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>document.write('<script src="../../js/hrms/hrms-datepicker.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</body>
</html>
