<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-payroll.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-attendance.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu"></div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <span class="current">Attendance</span>
                </nav>
                <div class="hrms-header-row">
                    <!-- Hamburger Toggle Button -->
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation menu">
                        <span class="hamburger-icon">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </span>
                        <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <path d="M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h1>Attendance Management</h1>
                </div>
                <div class="active-tab-title" id="activeTabTitle">
                    <span class="tab-indicator"></span>
                    <span id="activeTabName">Daily View</span>
                </div>
            </div>
        </div>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Sidebar + Content Layout -->
        <div class="organization-layout">
            <!-- Collapsible Sidebar Navigation -->
            <aside class="organization-sidebar" id="organizationSidebar">
                <div class="sidebar-header">
                    <h3>Attendance</h3>
                </div>
                <nav class="sidebar-nav">
                    <!-- Tracking Section -->
                    <div class="nav-group" data-group="tracking">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                                Tracking
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn active" data-tab="daily" id="dailyTab">
                                <span class="nav-number">1</span><span class="nav-label">Daily View</span>
                            </button>
                            <button class="sidebar-btn" data-tab="myAttendance" id="myAttendanceTabBtn">
                                <span class="nav-number">2</span><span class="nav-label">My Attendance</span>
                            </button>
                        </div>
                    </div>

                    <!-- Requests Section -->
                    <div class="nav-group" data-group="requests">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="12" y1="18" x2="12" y2="12"></line>
                                    <line x1="9" y1="15" x2="15" y2="15"></line>
                                </svg>
                                Requests
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn" data-tab="regularization" id="regularizationTabBtn">
                                <span class="nav-number">3</span><span class="nav-label">Regularization</span>
                            </button>
                            <button class="sidebar-btn" data-tab="overtime" id="overtimeTabBtn">
                                <span class="nav-number">4</span><span class="nav-label">Overtime</span>
                            </button>
                        </div>
                    </div>

                    <!-- Approvals Section (Admin/Manager Only) -->
                    <div class="nav-group admin-only" data-group="approvals" id="approvalsNavGroup" style="display: none;">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                                Approvals
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn" data-tab="approvals" id="approvalsTabBtn">
                                <span class="nav-number">5</span><span class="nav-label">Pending Approvals</span>
                            </button>
                        </div>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="organization-content">
                <!-- Daily View Tab -->
                <div class="tab-content active" id="daily">
                    <div class="filters-bar">
                        <input type="date" id="dateFilter" class="filter-select" onchange="loadAttendance()">
                    </div>

                    <div class="stats-row">
                        <div class="stat-mini active">
                            <span class="stat-mini-value" id="presentCount">-</span>
                            <span class="stat-mini-label">Present</span>
                        </div>
                        <div class="stat-mini danger">
                            <span class="stat-mini-value" id="absentCount">-</span>
                            <span class="stat-mini-label">Absent</span>
                        </div>
                        <div class="stat-mini warning">
                            <span class="stat-mini-value" id="lateCount">-</span>
                            <span class="stat-mini-label">Late</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-mini-value" id="onLeaveCount">-</span>
                            <span class="stat-mini-label">On Leave</span>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Check In</th>
                                    <th>Check Out</th>
                                    <th>Working Hours</th>
                                    <th>Status</th>
                                    <th>Type</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <tr>
                                    <td colspan="6">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- My Attendance Tab -->
                <div class="tab-content" id="myAttendance">
                    <div class="filters-bar">
                        <select class="filter-select" id="monthFilter" onchange="loadMyAttendance()">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <select class="filter-select" id="yearFilter" onchange="loadMyAttendance()">
                        </select>
                    </div>

                    <div class="stats-row">
                        <div class="stat-mini">
                            <span class="stat-mini-value" id="myWorkingDays">-</span>
                            <span class="stat-mini-label">Working Days</span>
                        </div>
                        <div class="stat-mini active">
                            <span class="stat-mini-value" id="myPresentDays">-</span>
                            <span class="stat-mini-label">Present</span>
                        </div>
                        <div class="stat-mini warning">
                            <span class="stat-mini-value" id="myLateDays">-</span>
                            <span class="stat-mini-label">Late</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-mini-value" id="myTotalHours">-</span>
                            <span class="stat-mini-label">Total Hours</span>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Check In</th>
                                    <th>Check Out</th>
                                    <th>Working Hours</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="myAttendanceTableBody">
                                <tr>
                                    <td colspan="5">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Regularization Tab -->
                <div class="tab-content" id="regularization">
                    <div class="filters-bar">
                        <button class="btn btn-primary" onclick="openRegularizationModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Request Regularization
                        </button>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Requested Check In</th>
                                    <th>Requested Check Out</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="regularizationTableBody">
                                <tr>
                                    <td colspan="6">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Overtime Tab -->
                <div class="tab-content" id="overtime">
                    <div class="filters-bar">
                        <button class="btn btn-primary" onclick="openOvertimeModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Request Overtime
                        </button>
                    </div>

                    <div class="data-table-container">
                        <h4 style="margin-bottom: 16px;">My Overtime Requests</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Planned Start</th>
                                    <th>Planned End</th>
                                    <th>Actual Start</th>
                                    <th>Actual End</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="overtimeTableBody">
                                <tr>
                                    <td colspan="7">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pending Overtime Approvals (Manager/Admin Only) -->
                    <div class="data-table-container admin-only" style="margin-top: 24px;">
                        <h4 style="margin-bottom: 16px;">Pending Overtime Approvals</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Date</th>
                                    <th>Start Time</th>
                                    <th>End Time</th>
                                    <th>Reason</th>
                                    <th>Task/Project</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingOvertimeTableBody">
                                <tr>
                                    <td colspan="7">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Approvals Tab (Admin/Manager Only) -->
                <div class="tab-content" id="approvals">
                    <div class="data-table-container">
                        <h4 style="margin-bottom: 16px;">Pending Regularization Requests</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Date</th>
                                    <th>Requested Check In</th>
                                    <th>Requested Check Out</th>
                                    <th>Reason</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingRegularizationsTableBody">
                                <tr>
                                    <td colspan="6">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Regularization Modal -->
    <div class="modal" id="regularizationModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Request Regularization</h3>
                    <button class="close-btn" onclick="closeModal('regularizationModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="regularizationForm">
                        <div class="form-group">
                            <label>Date <span class="required">*</span></label>
                            <input type="date" id="regDate" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Check In Time <span class="required">*</span></label>
                                <input type="time" id="regCheckIn" required>
                            </div>
                            <div class="form-group">
                                <label>Check Out Time <span class="required">*</span></label>
                                <input type="time" id="regCheckOut" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Reason <span class="required">*</span></label>
                            <textarea id="regReason" required placeholder="Explain why regularization is needed..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="submitRegularization()">Submit Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overtime Modal -->
    <div class="modal" id="overtimeModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Request Overtime</h3>
                    <button class="close-btn" onclick="closeModal('overtimeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="overtimeForm">
                        <div class="form-group">
                            <label>Date <span class="required">*</span></label>
                            <input type="date" id="otDate" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Time <span class="required">*</span></label>
                                <input type="time" id="otStartTime" required>
                            </div>
                            <div class="form-group">
                                <label>End Time <span class="required">*</span></label>
                                <input type="time" id="otEndTime" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Reason <span class="required">*</span></label>
                            <textarea id="otReason" required placeholder="Why is overtime needed?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Project/Task</label>
                            <input type="text" id="otTask" placeholder="What will you work on?">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="submitOvertime()">Submit Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rejection Reason Modal -->
    <div class="modal" id="rejectionModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Reject Regularization</h3>
                    <button class="close-btn" onclick="closeModal('rejectionModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="rejectionForm">
                        <div class="form-group">
                            <label>Reason for Rejection</label>
                            <textarea id="rejectionReason" placeholder="Provide reason for rejecting this request..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" onclick="confirmRejectRegularization()">Reject Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overtime Rejection Modal -->
    <div class="modal" id="overtimeRejectionModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Reject Overtime Request</h3>
                    <button class="close-btn" onclick="closeModal('overtimeRejectionModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="overtimeRejectionForm">
                        <div class="form-group">
                            <label>Reason for Rejection</label>
                            <textarea id="overtimeRejectionReason" placeholder="Provide reason for rejecting this overtime request..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" onclick="confirmRejectOvertime()">Reject Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Complete Overtime Modal -->
    <div class="modal" id="completeOvertimeModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Complete Overtime</h3>
                    <button class="close-btn" onclick="closeModal('completeOvertimeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="completeOvertimeForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Actual Start Time <span class="required">*</span></label>
                                <input type="time" id="actualOtStartTime" required>
                            </div>
                            <div class="form-group">
                                <label>Actual End Time <span class="required">*</span></label>
                                <input type="time" id="actualOtEndTime" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Notes</label>
                            <textarea id="completeOtNotes" placeholder="Any additional notes about the overtime work..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="submitCompleteOvertime()">Mark Complete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/roleUtils.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/attendance.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</body>
</html>
