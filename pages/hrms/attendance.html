<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXVS357DCK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-LXVS357DCK');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-payroll.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-attendance.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/searchable-dropdown.css?v=' + CACHE_VERSION + '">');</script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script>document.write('<link rel="stylesheet" href="../../css/flatpickr-custom.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/brand_logo.png" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu"></div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <span class="current">Attendance</span>
                </nav>
                <div class="hrms-header-row">
                    <!-- Hamburger Toggle Button -->
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation menu">
                        <span class="hamburger-icon">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </span>
                        <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <path d="M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h1>Attendance Management</h1>
                </div>
                <div class="active-tab-title" id="activeTabTitle">
                    <span class="tab-indicator"></span>
                    <span id="activeTabName">Daily View</span>
                </div>
            </div>
        </div>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Sidebar + Content Layout -->
        <div class="organization-layout">
            <!-- Collapsible Sidebar Navigation -->
            <aside class="organization-sidebar gradient-bg-ambient" id="organizationSidebar">
                <div class="sidebar-header">
                    <h3>Attendance</h3>
                </div>
                <nav class="sidebar-nav">
                    <!-- Team Overview Section -->
                    <div class="nav-group" data-group="overview">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                Team Overview
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn active" data-tab="daily" id="dailyTab">
                                <span class="nav-number">1</span><span class="nav-label">Daily Attendance</span>
                            </button>
                        </div>
                    </div>

                    <!-- Approvals Section -->
                    <div class="nav-group" data-group="approvals">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                                Approvals
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn" data-tab="regularization" id="regularizationTabBtn">
                                <span class="nav-number">2</span><span class="nav-label">Regularization Requests</span>
                            </button>
                            <button class="sidebar-btn" data-tab="overtime" id="overtimeTabBtn">
                                <span class="nav-number">3</span><span class="nav-label">Overtime Requests</span>
                            </button>
                        </div>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="organization-content">
                <!-- Daily View Tab -->
                <div class="tab-content active" id="daily">
                    <div class="filters-bar inline-filters">
                        <select id="officeFilter" class="filter-select">
                            <option value="">All Offices</option>
                        </select>
                        <div id="dailyDatePicker" class="date-picker-container"></div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-mini active">
                            <span class="stat-mini-value" id="presentCount">-</span>
                            <span class="stat-mini-label">Present</span>
                        </div>
                        <div class="stat-mini danger">
                            <span class="stat-mini-value" id="absentCount">-</span>
                            <span class="stat-mini-label">Absent</span>
                        </div>
                        <div class="stat-mini warning">
                            <span class="stat-mini-value" id="lateCount">-</span>
                            <span class="stat-mini-label">Late</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-mini-value" id="onLeaveCount">-</span>
                            <span class="stat-mini-label">On Leave</span>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Check In</th>
                                    <th>Check Out</th>
                                    <th>Working Hours</th>
                                    <th>Status</th>
                                    <th>Type</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <tr>
                                    <td colspan="6">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="attendancePagination" class="pagination-container"></div>
                    </div>
                </div>

                <!-- Regularization Requests Tab (Team Pending) -->
                <div class="tab-content" id="regularization">
                    <div class="filters-bar inline-filters">
                        <select id="regOfficeFilter" class="filter-select">
                            <option value="">All Offices</option>
                        </select>
                        <div id="regMonthPicker"></div>
                        <select class="filter-select" id="regStatusFilter">
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="all">All</option>
                        </select>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Date</th>
                                    <th>Requested Check In</th>
                                    <th>Requested Check Out</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="teamRegularizationTableBody">
                                <tr>
                                    <td colspan="7">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="regularizationPagination" class="pagination-container"></div>
                    </div>
                </div>

                <!-- Overtime Requests Tab (Team Pending) -->
                <div class="tab-content" id="overtime">
                    <div class="filters-bar inline-filters">
                        <select id="otOfficeFilter" class="filter-select">
                            <option value="">All Offices</option>
                        </select>
                        <div id="otMonthPicker"></div>
                        <select class="filter-select" id="otStatusFilter">
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                            <option value="all">All</option>
                        </select>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Date</th>
                                    <th>Start Time</th>
                                    <th>End Time</th>
                                    <th>Reason</th>
                                    <th>Task/Project</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="teamOvertimeTableBody">
                                <tr>
                                    <td colspan="8">
                                        <div class="loading-spinner">
                                            <div class="spinner"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="overtimePagination" class="pagination-container"></div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Rejection Reason Modal -->
    <div class="modal" id="rejectionModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Reject Regularization</h3>
                    <button class="close-btn" onclick="closeModal('rejectionModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="rejectionForm">
                        <div class="form-group">
                            <label>Reason for Rejection</label>
                            <textarea id="rejectionReason" placeholder="Provide reason for rejecting this request..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" onclick="confirmRejectRegularization()">Reject Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overtime Rejection Modal -->
    <div class="modal" id="overtimeRejectionModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Reject Overtime Request</h3>
                    <button class="close-btn" onclick="closeModal('overtimeRejectionModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="overtimeRejectionForm">
                        <div class="form-group">
                            <label>Reason for Rejection</label>
                            <textarea id="overtimeRejectionReason" placeholder="Provide reason for rejecting this overtime request..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" onclick="confirmRejectOvertime()">Reject Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Complete Overtime Modal -->
    <div class="modal" id="completeOvertimeModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Complete Overtime</h3>
                    <button class="close-btn" onclick="closeModal('completeOvertimeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="completeOvertimeForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Actual Start Time <span class="required">*</span></label>
                                <input type="time" id="actualOtStartTime" required>
                            </div>
                            <div class="form-group">
                                <label>Actual End Time <span class="required">*</span></label>
                                <input type="time" id="actualOtEndTime" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Notes</label>
                            <textarea id="completeOtNotes" placeholder="Any additional notes about the overtime work..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="submitCompleteOvertime()">Mark Complete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>document.write('<script src="../../js/hrms/hrms-datepicker.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/roleUtils.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/hrms-signalr.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/office-selection.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/searchable-dropdown.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/hrms-monthpicker.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/table-pagination.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/attendance.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</body>
</html>
