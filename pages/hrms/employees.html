<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management - HRMS - HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu"></div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div>
                <div class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span>/</span>
                    <span>Employees</span>
                </div>
                <h1>Employee Management</h1>
                <p>Manage employee profiles and records</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="openCreateEmployeeModal()" id="createEmployeeBtn" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Add Employee
                </button>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-bar">
            <div class="search-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                <input type="text" class="search-input" id="searchInput" placeholder="Search employees..." oninput="filterEmployees()">
            </div>
            <select class="filter-select" id="departmentFilter" onchange="filterEmployees()">
                <option value="">All Departments</option>
            </select>
            <select class="filter-select" id="officeFilter" onchange="filterEmployees()">
                <option value="">All Offices</option>
            </select>
            <select class="filter-select" id="statusFilter" onchange="filterEmployees()">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="on_notice">On Notice</option>
                <option value="terminated">Terminated</option>
            </select>
        </div>

        <!-- Employee Stats -->
        <div class="stats-row">
            <div class="stat-mini">
                <span class="stat-mini-value" id="totalCount">-</span>
                <span class="stat-mini-label">Total</span>
            </div>
            <div class="stat-mini active">
                <span class="stat-mini-value" id="activeCount">-</span>
                <span class="stat-mini-label">Active</span>
            </div>
            <div class="stat-mini warning">
                <span class="stat-mini-value" id="probationCount">-</span>
                <span class="stat-mini-label">On Probation</span>
            </div>
            <div class="stat-mini danger">
                <span class="stat-mini-value" id="exitCount">-</span>
                <span class="stat-mini-label">Exits This Month</span>
            </div>
        </div>

        <!-- Employees Table -->
        <div class="data-table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Department</th>
                        <th>Designation</th>
                        <th>Office</th>
                        <th>Joining Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeesTableBody">
                    <tr>
                        <td colspan="7">
                            <div class="loading-spinner">
                                <div class="spinner"></div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Create/Edit Employee Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="employeeModalTitle">Add Employee</h3>
                    <button class="close-btn" onclick="closeModal('employeeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="employeeForm">
                        <input type="hidden" id="employeeId">

                        <!-- User Selection (for new employees) -->
                        <div class="form-section" id="userSelectionSection">
                            <h4>Select User Account</h4>
                            <div class="form-group">
                                <label>User Account <span class="required">*</span></label>
                                <select id="userSelect" required>
                                    <option value="">Select a user...</option>
                                </select>
                                <small class="form-text">Only users without employee profiles are shown</small>
                            </div>
                        </div>

                        <!-- Personal Information -->
                        <div class="form-section">
                            <h4>Personal Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Employee Code <span class="required">*</span></label>
                                    <input type="text" id="employeeCode" required placeholder="EMP001">
                                </div>
                                <div class="form-group">
                                    <label>First Name <span class="required">*</span></label>
                                    <input type="text" id="firstName" required placeholder="John">
                                </div>
                                <div class="form-group">
                                    <label>Last Name <span class="required">*</span></label>
                                    <input type="text" id="lastName" required placeholder="Doe">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Work Email <span class="required">*</span></label>
                                    <input type="email" id="workEmail" required placeholder="john.doe@company.com">
                                </div>
                                <div class="form-group">
                                    <label>Work Phone</label>
                                    <input type="tel" id="workPhone" placeholder="+91-9876543210">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date of Birth</label>
                                    <input type="date" id="dateOfBirth">
                                </div>
                                <div class="form-group">
                                    <label>Gender</label>
                                    <select id="gender">
                                        <option value="">Select...</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Employment Details -->
                        <div class="form-section">
                            <h4>Employment Details</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Department <span class="required">*</span></label>
                                    <select id="departmentId" required>
                                        <option value="">Select department...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Designation <span class="required">*</span></label>
                                    <select id="designationId" required>
                                        <option value="">Select designation...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Office <span class="required">*</span></label>
                                    <select id="officeId" required>
                                        <option value="">Select office...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Shift</label>
                                    <select id="shiftId">
                                        <option value="">Default shift</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Reporting Manager</label>
                                    <select id="reportingManagerId">
                                        <option value="">None</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Employment Type <span class="required">*</span></label>
                                    <select id="employmentType" required>
                                        <option value="full_time">Full Time</option>
                                        <option value="part_time">Part Time</option>
                                        <option value="contract">Contract</option>
                                        <option value="intern">Intern</option>
                                        <option value="consultant">Consultant</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date of Joining <span class="required">*</span></label>
                                    <input type="date" id="dateOfJoining" required>
                                </div>
                                <div class="form-group">
                                    <label>Probation End Date</label>
                                    <input type="date" id="probationEndDate">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('employeeModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveEmployee()">Save Employee</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Employee Modal -->
    <div class="modal" id="viewEmployeeModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Employee Details</h3>
                    <button class="close-btn" onclick="closeModal('viewEmployeeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" id="viewEmployeeContent">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('viewEmployeeModal')">Close</button>
                    <button class="btn btn-primary" onclick="editFromView()" id="editFromViewBtn">Edit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
    <script>
        let employees = [];
        let departments = [];
        let designations = [];
        let offices = [];
        let shifts = [];
        let availableUsers = [];
        let currentViewEmployee = null;
        let userRole = 'HRMS_USER';

        document.addEventListener('DOMContentLoaded', async () => {
            if (!api.isAuthenticated()) {
                window.location.href = '/index.html';
                return;
            }

            Navigation.init('hrms', '../');

            // Determine user role
            const user = api.getUser();
            if (user && user.roles) {
                if (user.roles.includes('SUPERADMIN') || user.roles.includes('HRMS_ADMIN')) {
                    userRole = 'HRMS_ADMIN';
                    document.getElementById('createEmployeeBtn').style.display = 'flex';
                } else if (user.roles.includes('HRMS_MANAGER')) {
                    userRole = 'HRMS_MANAGER';
                }
            }

            await loadFormData();
            await loadEmployees();
        });

        async function loadFormData() {
            try {
                const [depts, desigs, offs, shiftsData] = await Promise.all([
                    api.hrmsGetAllDepartments(false),
                    api.hrmsGetAllDesignations(false),
                    api.hrmsGetAllOffices(false),
                    api.hrmsGetAllShifts(false)
                ]);

                departments = depts || [];
                designations = desigs || [];
                offices = offs || [];
                shifts = shiftsData || [];

                // Populate filter dropdowns
                populateSelect('departmentFilter', departments, 'department_name', true);
                populateSelect('officeFilter', offices, 'office_name', true);

                // Populate form dropdowns
                populateSelect('departmentId', departments, 'department_name');
                populateSelect('designationId', designations, 'designation_name');
                populateSelect('officeId', offices, 'office_name');
                populateSelect('shiftId', shifts, 'shift_name');

            } catch (error) {
                console.error('Error loading form data:', error);
            }
        }

        function populateSelect(elementId, items, labelField, isFilter = false) {
            const select = document.getElementById(elementId);
            if (!select) return;

            const defaultOption = isFilter ? '<option value="">All</option>' : '<option value="">Select...</option>';
            select.innerHTML = defaultOption + items.map(item =>
                `<option value="${item.id}">${item[labelField]}</option>`
            ).join('');
        }

        async function loadEmployees() {
            const tbody = document.getElementById('employeesTableBody');
            tbody.innerHTML = '<tr><td colspan="7"><div class="loading-spinner"><div class="spinner"></div></div></td></tr>';

            try {
                employees = await api.hrmsGetAllEmployees(false);

                updateStats();
                renderEmployees();

            } catch (error) {
                console.error('Error loading employees:', error);
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><p>Error loading employees</p></td></tr>';
            }
        }

        function updateStats() {
            document.getElementById('totalCount').textContent = employees.length;
            document.getElementById('activeCount').textContent = employees.filter(e => e.employment_status === 'active').length;

            const today = new Date();
            const probationEmployees = employees.filter(e => {
                if (!e.probation_end_date) return false;
                return new Date(e.probation_end_date) > today;
            });
            document.getElementById('probationCount').textContent = probationEmployees.length;

            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            const exitEmployees = employees.filter(e => {
                if (!e.termination_date) return false;
                const termDate = new Date(e.termination_date);
                return termDate >= monthStart && termDate <= today;
            });
            document.getElementById('exitCount').textContent = exitEmployees.length;
        }

        function filterEmployees() {
            renderEmployees();
        }

        function renderEmployees() {
            const tbody = document.getElementById('employeesTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const deptFilter = document.getElementById('departmentFilter').value;
            const officeFilter = document.getElementById('officeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            let filtered = employees.filter(emp => {
                const matchesSearch = !searchTerm ||
                    emp.first_name?.toLowerCase().includes(searchTerm) ||
                    emp.last_name?.toLowerCase().includes(searchTerm) ||
                    emp.employee_code?.toLowerCase().includes(searchTerm) ||
                    emp.work_email?.toLowerCase().includes(searchTerm);

                const matchesDept = !deptFilter || emp.department_id === deptFilter;
                const matchesOffice = !officeFilter || emp.office_id === officeFilter;
                const matchesStatus = !statusFilter || emp.employment_status === statusFilter;

                return matchesSearch && matchesDept && matchesOffice && matchesStatus;
            });

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><p>No employees found</p></td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(emp => {
                const dept = departments.find(d => d.id === emp.department_id);
                const desig = designations.find(d => d.id === emp.designation_id);
                const office = offices.find(o => o.id === emp.office_id);

                return `
                    <tr>
                        <td>
                            <div class="employee-info">
                                <div class="employee-avatar">${getInitials(emp.first_name, emp.last_name)}</div>
                                <div>
                                    <div class="employee-name">${emp.first_name} ${emp.last_name}</div>
                                    <div class="employee-code">${emp.employee_code}</div>
                                </div>
                            </div>
                        </td>
                        <td>${dept?.department_name || '-'}</td>
                        <td>${desig?.designation_name || '-'}</td>
                        <td>${office?.office_name || '-'}</td>
                        <td>${formatDate(emp.date_of_joining)}</td>
                        <td><span class="status-badge ${emp.employment_status}">${capitalizeFirst(emp.employment_status)}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn" onclick="viewEmployee('${emp.id}')" data-tooltip="View">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                </button>
                                ${userRole === 'HRMS_ADMIN' ? `
                                    <button class="action-btn" onclick="editEmployee('${emp.id}')" data-tooltip="Edit">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function openCreateEmployeeModal() {
            document.getElementById('employeeModalTitle').textContent = 'Add Employee';
            document.getElementById('employeeForm').reset();
            document.getElementById('employeeId').value = '';
            document.getElementById('userSelectionSection').style.display = 'block';

            // Load available users
            try {
                availableUsers = await api.hrmsGetAvailableUsers();
                const userSelect = document.getElementById('userSelect');
                userSelect.innerHTML = '<option value="">Select a user...</option>' +
                    availableUsers.map(u => `<option value="${u.id}">${u.email} (${u.firstName} ${u.lastName})</option>`).join('');
            } catch (error) {
                console.error('Error loading available users:', error);
            }

            // Load managers
            const managerSelect = document.getElementById('reportingManagerId');
            managerSelect.innerHTML = '<option value="">None</option>' +
                employees.map(e => `<option value="${e.user_id}">${e.first_name} ${e.last_name}</option>`).join('');

            openModal('employeeModal');
        }

        async function editEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;

            document.getElementById('employeeModalTitle').textContent = 'Edit Employee';
            document.getElementById('employeeId').value = id;
            document.getElementById('userSelectionSection').style.display = 'none';

            // Fill form fields
            document.getElementById('employeeCode').value = emp.employee_code || '';
            document.getElementById('firstName').value = emp.first_name || '';
            document.getElementById('lastName').value = emp.last_name || '';
            document.getElementById('workEmail').value = emp.work_email || '';
            document.getElementById('workPhone').value = emp.work_phone || '';
            document.getElementById('dateOfBirth').value = emp.date_of_birth?.split('T')[0] || '';
            document.getElementById('gender').value = emp.gender || '';
            document.getElementById('departmentId').value = emp.department_id || '';
            document.getElementById('designationId').value = emp.designation_id || '';
            document.getElementById('officeId').value = emp.office_id || '';
            document.getElementById('shiftId').value = emp.shift_id || '';
            document.getElementById('reportingManagerId').value = emp.reporting_manager_id || '';
            document.getElementById('employmentType').value = emp.employment_type || 'full_time';
            document.getElementById('dateOfJoining').value = emp.date_of_joining?.split('T')[0] || '';
            document.getElementById('probationEndDate').value = emp.probation_end_date?.split('T')[0] || '';

            // Load managers
            const managerSelect = document.getElementById('reportingManagerId');
            managerSelect.innerHTML = '<option value="">None</option>' +
                employees.filter(e => e.id !== id).map(e => `<option value="${e.user_id}">${e.first_name} ${e.last_name}</option>`).join('');
            managerSelect.value = emp.reporting_manager_id || '';

            openModal('employeeModal');
        }

        async function saveEmployee() {
            const id = document.getElementById('employeeId').value;
            const isEdit = !!id;

            const data = {
                employee_code: document.getElementById('employeeCode').value,
                first_name: document.getElementById('firstName').value,
                last_name: document.getElementById('lastName').value,
                work_email: document.getElementById('workEmail').value,
                work_phone: document.getElementById('workPhone').value || null,
                date_of_birth: document.getElementById('dateOfBirth').value || null,
                gender: document.getElementById('gender').value || null,
                department_id: document.getElementById('departmentId').value,
                designation_id: document.getElementById('designationId').value,
                office_id: document.getElementById('officeId').value,
                shift_id: document.getElementById('shiftId').value || null,
                reporting_manager_id: document.getElementById('reportingManagerId').value || null,
                employment_type: document.getElementById('employmentType').value,
                date_of_joining: document.getElementById('dateOfJoining').value,
                probation_end_date: document.getElementById('probationEndDate').value || null
            };

            if (!isEdit) {
                data.user_id = document.getElementById('userSelect').value;
                if (!data.user_id) {
                    showToast('Please select a user account', 'error');
                    return;
                }
            }

            try {
                if (isEdit) {
                    await api.hrmsUpdateEmployee(id, data);
                    showToast('Employee updated successfully', 'success');
                } else {
                    await api.hrmsCreateEmployee(data);
                    showToast('Employee created successfully', 'success');
                }

                closeModal('employeeModal');
                await loadEmployees();

            } catch (error) {
                showToast(error.message || 'Error saving employee', 'error');
            }
        }

        async function viewEmployee(id) {
            const content = document.getElementById('viewEmployeeContent');
            content.innerHTML = '<div class="loading-spinner"><div class="spinner"></div></div>';
            openModal('viewEmployeeModal');

            try {
                const emp = await api.hrmsGetEmployeeById(id);
                currentViewEmployee = emp;

                const dept = departments.find(d => d.id === emp.department_id);
                const desig = designations.find(d => d.id === emp.designation_id);
                const office = offices.find(o => o.id === emp.office_id);
                const shift = shifts.find(s => s.id === emp.shift_id);

                content.innerHTML = `
                    <div class="employee-view-header">
                        <div class="employee-avatar-large">${getInitials(emp.first_name, emp.last_name)}</div>
                        <div>
                            <h2>${emp.first_name} ${emp.last_name}</h2>
                            <p>${emp.employee_code} | ${desig?.designation_name || '-'}</p>
                        </div>
                        <span class="status-badge ${emp.employment_status}">${capitalizeFirst(emp.employment_status)}</span>
                    </div>

                    <div class="employee-view-sections">
                        <div class="view-section">
                            <h4>Personal Information</h4>
                            <div class="view-grid">
                                <div class="view-item">
                                    <span class="label">Email</span>
                                    <span class="value">${emp.work_email}</span>
                                </div>
                                <div class="view-item">
                                    <span class="label">Phone</span>
                                    <span class="value">${emp.work_phone || '-'}</span>
                                </div>
                                <div class="view-item">
                                    <span class="label">Date of Birth</span>
                                    <span class="value">${formatDate(emp.date_of_birth) || '-'}</span>
                                </div>
                                <div class="view-item">
                                    <span class="label">Gender</span>
                                    <span class="value">${capitalizeFirst(emp.gender) || '-'}</span>
                                </div>
                            </div>
                        </div>

                        <div class="view-section">
                            <h4>Employment Details</h4>
                            <div class="view-grid">
                                <div class="view-item">
                                    <span class="label">Department</span>
                                    <span class="value">${dept?.department_name || '-'}</span>
                                </div>
                                <div class="view-item">
                                    <span class="label">Designation</span>
                                    <span class="value">${desig?.designation_name || '-'}</span>
                                </div>
                                <div class="view-item">
                                    <span class="label">Office</span>
                                    <span class="value">${office?.office_name || '-'}</span>
                                </div>
                                <div class="view-item">
                                    <span class="label">Shift</span>
                                    <span class="value">${shift?.shift_name || 'Default'}</span>
                                </div>
                                <div class="view-item">
                                    <span class="label">Employment Type</span>
                                    <span class="value">${capitalizeFirst(emp.employment_type?.replace('_', ' '))}</span>
                                </div>
                                <div class="view-item">
                                    <span class="label">Joining Date</span>
                                    <span class="value">${formatDate(emp.date_of_joining)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('editFromViewBtn').style.display = userRole === 'HRMS_ADMIN' ? 'block' : 'none';

            } catch (error) {
                content.innerHTML = '<div class="empty-state"><p>Error loading employee details</p></div>';
            }
        }

        function editFromView() {
            if (currentViewEmployee) {
                closeModal('viewEmployeeModal');
                editEmployee(currentViewEmployee.id);
            }
        }

        // Utility functions
        function getInitials(firstName, lastName) {
            return ((firstName?.[0] || '') + (lastName?.[0] || '')).toUpperCase() || 'U';
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function capitalizeFirst(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function openModal(id) {
            document.getElementById(id).style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${type === 'success' ? '<polyline points="20 6 9 17 4 12"/>' : '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'}
                </svg>
                ${message}
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
