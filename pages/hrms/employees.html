<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management - HRMS - HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu"></div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div>
                <div class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span>/</span>
                    <span>Employees</span>
                </div>
                <h1>Employee Management</h1>
                <p>Manage employee profiles and records</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="openCreateEmployeeModal()" id="createEmployeeBtn" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Add Employee
                </button>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-bar">
            <div class="search-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                <input type="text" class="search-input" id="searchInput" placeholder="Search employees..." oninput="filterEmployees()">
            </div>
            <select class="filter-select" id="departmentFilter" onchange="filterEmployees()">
                <option value="">All Departments</option>
            </select>
            <select class="filter-select" id="officeFilter" onchange="filterEmployees()">
                <option value="">All Offices</option>
            </select>
            <select class="filter-select" id="statusFilter" onchange="filterEmployees()">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="on_notice">On Notice</option>
                <option value="terminated">Terminated</option>
            </select>
        </div>

        <!-- Employee Stats -->
        <div class="stats-row">
            <div class="stat-mini">
                <span class="stat-mini-value" id="totalCount">-</span>
                <span class="stat-mini-label">Total</span>
            </div>
            <div class="stat-mini active">
                <span class="stat-mini-value" id="activeCount">-</span>
                <span class="stat-mini-label">Active</span>
            </div>
            <div class="stat-mini warning">
                <span class="stat-mini-value" id="probationCount">-</span>
                <span class="stat-mini-label">On Probation</span>
            </div>
            <div class="stat-mini danger">
                <span class="stat-mini-value" id="exitCount">-</span>
                <span class="stat-mini-label">Exits This Month</span>
            </div>
        </div>

        <!-- Employees Table -->
        <div class="data-table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Department</th>
                        <th>Designation</th>
                        <th>Office</th>
                        <th>Joining Date</th>
                        <th>CTC</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeesTableBody">
                    <tr>
                        <td colspan="8">
                            <div class="loading-spinner">
                                <div class="spinner"></div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Create/Edit Employee Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content employee-wizard-modal">
                <div class="modal-header">
                    <h3 id="employeeModalTitle">Add Employee</h3>
                    <button class="close-btn" onclick="closeModal('employeeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>

                <!-- Wizard Steps Navigation -->
                <div class="wizard-steps">
                    <div class="wizard-step active" data-step="1" onclick="goToEmployeeStep(1)">
                        <div class="step-number">1</div>
                        <div class="step-label">Personal</div>
                    </div>
                    <div class="wizard-step-connector"></div>
                    <div class="wizard-step" data-step="2" onclick="goToEmployeeStep(2)">
                        <div class="step-number">2</div>
                        <div class="step-label">Employment</div>
                    </div>
                    <div class="wizard-step-connector"></div>
                    <div class="wizard-step" data-step="3" onclick="goToEmployeeStep(3)">
                        <div class="step-number">3</div>
                        <div class="step-label">Banking</div>
                    </div>
                    <div class="wizard-step-connector"></div>
                    <div class="wizard-step" data-step="4" onclick="goToEmployeeStep(4)">
                        <div class="step-number">4</div>
                        <div class="step-label">Documents</div>
                    </div>
                </div>

                <div class="modal-body">
                    <form id="employeeForm">
                        <input type="hidden" id="employeeId">

                        <!-- Step 1: Personal Information -->
                        <div class="wizard-panel active" id="employeeStep1">
                            <!-- User Selection (for new employees) -->
                            <div class="form-section" id="userSelectionSection">
                                <div class="form-group">
                                    <label>User Account <span class="required">*</span></label>
                                    <input type="hidden" id="userSelect" required>
                                    <div class="user-search-dropdown" id="userSearchDropdown">
                                        <div class="user-search-selected" id="userSearchSelected" onclick="toggleUserDropdown()">
                                            <span class="selected-user-text">Select a user...</span>
                                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="user-search-panel" id="userSearchPanel">
                                            <div class="search-box-modern">
                                                <svg class="search-icon" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"/>
                                                    <path d="m21 21-4.35-4.35"/>
                                                </svg>
                                                <input type="text" id="userSearchInput" placeholder="Search by name or email..." oninput="filterUserList()">
                                                <button type="button" class="clear-search-btn" id="clearUserSearchBtn" style="display: none;" onclick="clearUserSearch()">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="user-list-header">
                                                <span id="userCountDisplay">0 users</span>
                                            </div>
                                            <div id="userSearchList" class="users-list-modern">
                                                <p style="text-align: center; color: #999; font-size: 0.75rem; padding: 20px;">Loading users...</p>
                                            </div>
                                        </div>
                                    </div>
                                    <small class="form-text">Only users without employee profiles are shown</small>
                                </div>
                            </div>

                            <!-- User Info Display (read-only from Auth service) -->
                            <div class="form-row user-info-display" id="userInfoDisplay" style="display: none;">
                                <input type="hidden" id="firstName">
                                <input type="hidden" id="lastName">
                                <input type="hidden" id="workEmail">
                                <div class="form-group">
                                    <label>Name</label>
                                    <div class="readonly-field" id="userNameDisplay">-</div>
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <div class="readonly-field" id="userEmailDisplay">-</div>
                                </div>
                            </div>

                            <!-- Photo and Basic Info in two columns -->
                            <div class="wizard-two-col">
                                <div class="wizard-col">
                                    <div class="form-group photo-upload-group-compact">
                                        <label>Photo <span class="required">*</span></label>
                                        <div class="photo-upload-compact">
                                            <div class="photo-preview-sm" id="photoPreview">
                                                <div class="photo-placeholder" id="photoPlaceholder">
                                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                                        <circle cx="12" cy="7" r="4"/>
                                                    </svg>
                                                </div>
                                                <img id="photoImage" src="" alt="Employee Photo" style="display: none;">
                                            </div>
                                            <div class="photo-btns">
                                                <input type="file" id="photo-file" accept=".jpg,.jpeg,.png" hidden onchange="handlePhotoSelect(this)">
                                                <button type="button" class="btn btn-outline btn-xs" onclick="triggerFileUpload('photo')">Upload</button>
                                                <button type="button" class="btn btn-danger btn-xs" id="removePhotoBtn" onclick="removePhoto()" style="display: none;">Remove</button>
                                            </div>
                                        </div>
                                        <input type="hidden" id="photo-doc-id">
                                    </div>
                                </div>
                                <div class="wizard-col">
                                    <div class="form-group">
                                        <label>Employee Code <span class="required">*</span></label>
                                        <input type="text" id="employeeCode" required placeholder="EMP001">
                                    </div>
                                    <div class="form-group">
                                        <label>Work Phone <span class="required">*</span></label>
                                        <input type="tel" id="workPhone" placeholder="+91-9876543210" required>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Date of Birth <span class="required">*</span></label>
                                    <input type="date" id="dateOfBirth" required>
                                </div>
                                <div class="form-group">
                                    <label>Gender</label>
                                    <select id="gender">
                                        <option value="">Select...</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Employment Details -->
                        <div class="wizard-panel" id="employeeStep2">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Office <span class="required">*</span></label>
                                    <select id="officeId" required onchange="updateForOfficeChange()">
                                        <option value="">Select office...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Department <span class="required">*</span></label>
                                    <select id="departmentId" required onchange="onDepartmentChange()">
                                        <option value="">Select office first...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Designation <span class="required">*</span></label>
                                    <select id="designationId" required>
                                        <option value="">Select department first...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Shift</label>
                                    <select id="shiftId">
                                        <option value="">Select office first...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Reporting Manager</label>
                                    <select id="reportingManagerId" onchange="onManagerChange()">
                                        <option value="">None</option>
                                    </select>
                                    <small class="validation-message" id="managerValidationMsg" style="color: #dc3545; display: none;"></small>
                                </div>
                                <div class="form-group">
                                    <label>Employment Type <span class="required">*</span></label>
                                    <select id="employmentType" required>
                                        <option value="full-time">Full Time</option>
                                        <option value="part-time">Part Time</option>
                                        <option value="contract">Contract</option>
                                        <option value="intern">Intern</option>
                                        <option value="temporary">Temporary</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Date of Joining <span class="required">*</span></label>
                                    <input type="date" id="dateOfJoining" required>
                                </div>
                                <div class="form-group">
                                    <label>Probation End Date <span class="required">*</span></label>
                                    <input type="date" id="probationEndDate" required>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Banking Details -->
                        <div class="wizard-panel" id="employeeStep3">
                            <p class="wizard-step-hint">Bank account details for salary disbursement</p>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Account Holder Name <span class="required">*</span></label>
                                    <input type="text" id="accountHolderName" placeholder="Name as per bank account">
                                </div>
                                <div class="form-group">
                                    <label>Bank Name <span class="required">*</span></label>
                                    <input type="text" id="bankName" placeholder="e.g. HDFC Bank">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Account Number <span class="required">*</span></label>
                                    <input type="text" id="accountNumber" placeholder="Bank account number">
                                </div>
                                <div class="form-group">
                                    <label>Confirm Account Number <span class="required">*</span></label>
                                    <input type="text" id="confirmAccountNumber" placeholder="Re-enter account number">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>IFSC Code <span class="required">*</span></label>
                                    <input type="text" id="ifscCode" placeholder="e.g. HDFC0001234" pattern="^[A-Z]{4}0[A-Z0-9]{6}$" style="text-transform: uppercase;">
                                </div>
                                <div class="form-group">
                                    <label>Branch Name</label>
                                    <input type="text" id="branchName" placeholder="Branch name">
                                </div>
                            </div>
                            <input type="hidden" id="bankAccountId">
                        </div>

                        <!-- Step 4: Identity Documents -->
                        <div class="wizard-panel" id="employeeStep4">
                            <p class="wizard-step-hint">Photo, PAN Card (front & back), and Aadhar Card (front & back) are mandatory</p>
                            <div class="document-grid-compact" id="documentUploadGrid">
                                <!-- PAN Card -->
                                <div class="document-item-compact" data-doc-type="pan">
                                    <div class="doc-header-compact">
                                        <span class="doc-label">PAN Card <span class="required">*</span></span>
                                        <span class="doc-status" id="pan-status"></span>
                                    </div>
                                    <div class="doc-row">
                                        <input type="text" id="pan-number" placeholder="ABCDE1234F" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" style="text-transform: uppercase;">
                                    </div>
                                    <div class="doc-row doc-row-uploads">
                                        <!-- PAN Front -->
                                        <div class="doc-upload-item">
                                            <span class="upload-label">Front</span>
                                            <div class="doc-upload-compact">
                                                <input type="file" id="pan_front-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('pan_front', this)">
                                                <button type="button" class="upload-btn-sm" id="pan_front-upload" onclick="triggerFileUpload('pan_front')">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                        <polyline points="17 8 12 3 7 8"/>
                                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                                    </svg>
                                                </button>
                                                <div class="doc-preview-inline" id="pan_front-preview" style="display:none">
                                                    <span class="file-name"></span>
                                                    <button type="button" class="remove-btn-sm" onclick="removeDocument('pan_front')">
                                                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/>
                                                            <line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                            <input type="hidden" id="pan_front-doc-id">
                                        </div>
                                        <!-- PAN Back -->
                                        <div class="doc-upload-item">
                                            <span class="upload-label">Back</span>
                                            <div class="doc-upload-compact">
                                                <input type="file" id="pan_back-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('pan_back', this)">
                                                <button type="button" class="upload-btn-sm" id="pan_back-upload" onclick="triggerFileUpload('pan_back')">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                        <polyline points="17 8 12 3 7 8"/>
                                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                                    </svg>
                                                </button>
                                                <div class="doc-preview-inline" id="pan_back-preview" style="display:none">
                                                    <span class="file-name"></span>
                                                    <button type="button" class="remove-btn-sm" onclick="removeDocument('pan_back')">
                                                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/>
                                                            <line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                            <input type="hidden" id="pan_back-doc-id">
                                        </div>
                                    </div>
                                </div>

                                <!-- Aadhar Card -->
                                <div class="document-item-compact" data-doc-type="aadhar">
                                    <div class="doc-header-compact">
                                        <span class="doc-label">Aadhar Card <span class="required">*</span></span>
                                        <span class="doc-status" id="aadhar-status"></span>
                                    </div>
                                    <div class="doc-row">
                                        <input type="text" id="aadhar-number" placeholder="12 digit number" pattern="[0-9]{12}" maxlength="12">
                                    </div>
                                    <div class="doc-row doc-row-uploads">
                                        <!-- Aadhar Front -->
                                        <div class="doc-upload-item">
                                            <span class="upload-label">Front</span>
                                            <div class="doc-upload-compact">
                                                <input type="file" id="aadhar_front-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('aadhar_front', this)">
                                                <button type="button" class="upload-btn-sm" id="aadhar_front-upload" onclick="triggerFileUpload('aadhar_front')">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                        <polyline points="17 8 12 3 7 8"/>
                                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                                    </svg>
                                                </button>
                                                <div class="doc-preview-inline" id="aadhar_front-preview" style="display:none">
                                                    <span class="file-name"></span>
                                                    <button type="button" class="remove-btn-sm" onclick="removeDocument('aadhar_front')">
                                                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/>
                                                            <line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                            <input type="hidden" id="aadhar_front-doc-id">
                                        </div>
                                        <!-- Aadhar Back -->
                                        <div class="doc-upload-item">
                                            <span class="upload-label">Back</span>
                                            <div class="doc-upload-compact">
                                                <input type="file" id="aadhar_back-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('aadhar_back', this)">
                                                <button type="button" class="upload-btn-sm" id="aadhar_back-upload" onclick="triggerFileUpload('aadhar_back')">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                        <polyline points="17 8 12 3 7 8"/>
                                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                                    </svg>
                                                </button>
                                                <div class="doc-preview-inline" id="aadhar_back-preview" style="display:none">
                                                    <span class="file-name"></span>
                                                    <button type="button" class="remove-btn-sm" onclick="removeDocument('aadhar_back')">
                                                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/>
                                                            <line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                            <input type="hidden" id="aadhar_back-doc-id">
                                        </div>
                                    </div>
                                </div>

                                <!-- Passport (Optional) -->
                                <div class="document-item-compact" data-doc-type="passport">
                                    <div class="doc-header-compact">
                                        <span class="doc-label">Passport <span class="optional-badge">Optional</span></span>
                                        <span class="doc-status" id="passport-status"></span>
                                    </div>
                                    <div class="doc-row">
                                        <input type="text" id="passport-number" placeholder="Passport Number" style="text-transform: uppercase; flex: 1;">
                                        <input type="date" id="passport-expiry" title="Expiry Date" style="flex: 1;">
                                        <div class="doc-upload-compact">
                                            <input type="file" id="passport-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('passport', this)">
                                            <button type="button" class="upload-btn-sm" id="passport-upload" onclick="triggerFileUpload('passport')">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                    <polyline points="17 8 12 3 7 8"/>
                                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                                </svg>
                                            </button>
                                            <div class="doc-preview-inline" id="passport-preview" style="display:none">
                                                <span class="file-name"></span>
                                                <button type="button" class="remove-btn-sm" onclick="removeDocument('passport')">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="hidden" id="passport-doc-id">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Wizard Navigation Footer -->
                <div class="modal-footer wizard-footer">
                    <button class="btn btn-outline" id="empWizardPrevBtn" onclick="prevEmployeeStep()" style="display: none;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        Back
                    </button>
                    <div class="wizard-footer-spacer"></div>
                    <button class="btn btn-primary" id="empWizardNextBtn" onclick="nextEmployeeStep()">
                        Next
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                    <button class="btn btn-primary" id="empWizardSaveBtn" onclick="saveEmployee()" style="display: none;">
                        Save Employee
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Employee Modal -->
    <div class="modal" id="viewEmployeeModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Employee Details</h3>
                    <button class="close-btn" onclick="closeModal('viewEmployeeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" id="viewEmployeeContent">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('viewEmployeeModal')">Close</button>
                    <button class="btn btn-primary" onclick="editFromView()" id="editFromViewBtn">Edit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Salary Modal -->
    <div class="modal" id="salaryModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="salaryModalTitle">Manage Employee Salary</h3>
                    <button class="close-btn" onclick="closeModal('salaryModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Employee Info Header -->
                    <div class="salary-employee-header" id="salaryEmployeeHeader">
                        <div class="employee-info">
                            <div class="employee-avatar" id="salaryEmployeeAvatar">-</div>
                            <div class="employee-details">
                                <h4 id="salaryEmployeeName">-</h4>
                                <p id="salaryEmployeeDesignation">-</p>
                            </div>
                        </div>
                        <div class="salary-status" id="salaryStatusBadge">
                            <span class="badge badge-warning">Not Configured</span>
                        </div>
                    </div>

                    <!-- Current Salary Display (when exists) -->
                    <div class="current-salary-section" id="currentSalarySection" style="display: none;">
                        <h4>Current Salary</h4>
                        <div class="salary-summary-grid">
                            <div class="salary-card">
                                <span class="salary-label">Annual CTC</span>
                                <span class="salary-value" id="currentCTC">-</span>
                            </div>
                            <div class="salary-card">
                                <span class="salary-label">Monthly Gross</span>
                                <span class="salary-value" id="currentMonthlyGross">-</span>
                            </div>
                            <div class="salary-card">
                                <span class="salary-label">Monthly Net</span>
                                <span class="salary-value" id="currentMonthlyNet">-</span>
                            </div>
                        </div>
                        <div class="salary-effective-from">
                            <span>Effective From: </span>
                            <span id="currentEffectiveFrom">-</span>
                        </div>
                    </div>

                    <!-- Salary Form -->
                    <form id="salaryForm">
                        <input type="hidden" id="salaryEmployeeId">
                        <input type="hidden" id="existingSalaryId">

                        <div class="form-section">
                            <h4 id="salaryFormTitle">Configure Salary</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Salary Structure <span class="required">*</span></label>
                                    <select id="salaryStructureId" required onchange="previewSalaryBreakdown()">
                                        <option value="">Select Salary Structure...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Annual CTC <span class="required">*</span></label>
                                    <div class="input-with-prefix">
                                        <span class="input-prefix">₹</span>
                                        <input type="number" id="salaryCTC" required min="0" step="1"
                                               placeholder="e.g. 1200000" onchange="previewSalaryBreakdown()">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Effective From <span class="required">*</span></label>
                                    <input type="date" id="salaryEffectiveFrom" required>
                                </div>
                                <div class="form-group" id="revisionReasonGroup" style="display: none;">
                                    <label>Revision Reason</label>
                                    <select id="salaryRevisionType">
                                        <option value="adjustment">Adjustment</option>
                                        <option value="promotion">Promotion</option>
                                        <option value="annual_increment">Annual Increment</option>
                                        <option value="correction">Correction</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Salary Breakdown Preview -->
                        <div class="form-section" id="salaryBreakdownSection" style="display: none;">
                            <h4>Salary Breakdown Preview</h4>
                            <div class="salary-breakdown-grid" id="salaryBreakdownGrid">
                                <!-- Dynamically populated -->
                            </div>
                            <div class="salary-totals">
                                <div class="salary-total-row">
                                    <span>Monthly Gross</span>
                                    <span id="previewMonthlyGross">₹0</span>
                                </div>
                                <div class="salary-total-row">
                                    <span>Monthly Deductions</span>
                                    <span id="previewMonthlyDeductions">₹0</span>
                                </div>
                                <div class="salary-total-row net">
                                    <span>Monthly Net Pay</span>
                                    <span id="previewMonthlyNet">₹0</span>
                                </div>
                            </div>
                        </div>
                    </form>

                    <!-- Salary History Section -->
                    <div class="form-section" id="salaryHistorySection" style="display: none;">
                        <h4>Salary History</h4>
                        <div class="salary-history-table-wrapper">
                            <table class="salary-history-table">
                                <thead>
                                    <tr>
                                        <th>Period</th>
                                        <th>Annual CTC</th>
                                        <th>Monthly Gross</th>
                                        <th>Monthly Net</th>
                                        <th>Revision Type</th>
                                    </tr>
                                </thead>
                                <tbody id="salaryHistoryTableBody">
                                    <!-- Dynamically populated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('salaryModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveEmployeeSalary()" id="saveSalaryBtn">
                        <span id="saveSalaryBtnText">Save Salary</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfer Employee Modal -->
    <div class="modal" id="transferModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Transfer Employee</h3>
                    <button class="close-btn" onclick="closeModal('transferModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Employee Info Header -->
                    <div class="transfer-employee-header">
                        <div class="employee-info">
                            <div class="employee-avatar" id="transferEmployeeAvatar">-</div>
                            <div class="employee-details">
                                <h4 id="transferEmployeeName">-</h4>
                                <p id="transferEmployeeCode">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- Current Assignment -->
                    <div class="current-assignment-section">
                        <h4>Current Assignment</h4>
                        <div class="assignment-grid">
                            <div class="assignment-item">
                                <span class="assignment-label">Office</span>
                                <span class="assignment-value" id="currentOfficeName">-</span>
                            </div>
                            <div class="assignment-item">
                                <span class="assignment-label">Department</span>
                                <span class="assignment-value" id="currentDepartmentName">-</span>
                            </div>
                            <div class="assignment-item">
                                <span class="assignment-label">Designation</span>
                                <span class="assignment-value" id="currentDesignationName">-</span>
                            </div>
                            <div class="assignment-item">
                                <span class="assignment-label">Manager</span>
                                <span class="assignment-value" id="currentManagerName">-</span>
                            </div>
                        </div>
                    </div>

                    <form id="transferForm">
                        <input type="hidden" id="transferEmployeeId">

                        <!-- Transfer Details -->
                        <div class="form-section">
                            <h4>Transfer Details</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Transfer Type <span class="required">*</span></label>
                                    <select id="transferType" required>
                                        <option value="transfer">Transfer</option>
                                        <option value="promotion">Promotion</option>
                                        <option value="demotion">Demotion</option>
                                        <option value="deputation">Deputation</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Effective Date <span class="required">*</span></label>
                                    <input type="date" id="transferEffectiveDate" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Transfer Reason</label>
                                <textarea id="transferReason" rows="2" placeholder="Optional reason for transfer..."></textarea>
                            </div>
                        </div>

                        <!-- What to Change Section -->
                        <div class="form-section">
                            <h4>Select Changes</h4>
                            <div class="change-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="changeOffice" onchange="toggleTransferSection('officeChangeSection', this)">
                                    <span>Change Office</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="changeDepartment" onchange="toggleTransferSection('departmentChangeSection', this)">
                                    <span>Change Department</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="changeManager" onchange="toggleTransferSection('managerChangeSection', this)">
                                    <span>Change Manager</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="reviseSalary" onchange="toggleTransferSection('salaryRevisionSection', this)">
                                    <span>Revise Salary</span>
                                </label>
                            </div>
                        </div>

                        <!-- Office Change Section -->
                        <div class="form-section conditional-section" id="officeChangeSection" style="display: none;">
                            <h4>New Office</h4>
                            <div class="form-group">
                                <label>Select New Office <span class="required">*</span></label>
                                <select id="newOfficeId">
                                    <option value="">Select new office...</option>
                                </select>
                            </div>
                        </div>

                        <!-- Department Change Section -->
                        <div class="form-section conditional-section" id="departmentChangeSection" style="display: none;">
                            <h4>New Department & Designation</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>New Department <span class="required">*</span></label>
                                    <select id="newDepartmentId" onchange="onNewDepartmentChange()">
                                        <option value="">Select new department...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>New Designation</label>
                                    <select id="newDesignationId">
                                        <option value="">Select department first...</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Manager Change Section -->
                        <div class="form-section conditional-section" id="managerChangeSection" style="display: none;">
                            <h4>New Reporting Manager</h4>
                            <div class="form-group">
                                <label>New Manager</label>
                                <select id="newManagerUserId" onchange="onTransferManagerChange()">
                                    <option value="">No manager (CEO/Top level)</option>
                                </select>
                                <small class="validation-message" id="transferManagerValidationMsg" style="color: #dc3545; display: none;"></small>
                            </div>
                        </div>

                        <!-- Salary Revision Section -->
                        <div class="form-section conditional-section" id="salaryRevisionSection" style="display: none;">
                            <h4>Salary Revision</h4>
                            <div class="form-group">
                                <label>New Annual CTC</label>
                                <div class="input-with-prefix">
                                    <span class="input-prefix">₹</span>
                                    <input type="number" id="newCTC" min="0" step="1" placeholder="Enter new CTC...">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('transferModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="submitTransfer()" id="submitTransferBtn">Submit Transfer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfer History Modal -->
    <div class="modal" id="transferHistoryModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Transfer History</h3>
                    <button class="close-btn" onclick="closeModal('transferHistoryModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" id="transferHistoryContent">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('transferHistoryModal')">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/employees.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</body>
</html>
