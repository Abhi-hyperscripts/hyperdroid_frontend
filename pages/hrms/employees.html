<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-payroll.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <!-- Navigation links rendered by Navigation.init() -->
        </div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <span class="current">Employees</span>
                </nav>
                <div class="hrms-header-row">
                    <!-- Hamburger Toggle Button -->
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation menu">
                        <span class="hamburger-icon">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </span>
                        <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <path d="M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h1>Employee Management</h1>
                </div>
                <div class="active-tab-title" id="activeTabTitle">
                    <span class="tab-indicator"></span>
                    <span id="activeTabName">Employee Directory</span>
                </div>
            </div>
        </div>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Sidebar + Content Layout -->
        <div class="organization-layout">
            <!-- Collapsible Sidebar Navigation -->
            <aside class="organization-sidebar" id="organizationSidebar">
                <div class="sidebar-header">
                    <h3>Employees</h3>
                </div>
                <nav class="sidebar-nav">
                    <!-- Workforce Section -->
                    <div class="nav-group" data-group="workforce">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                Workforce
                            </span>
                            <span class="chevron">â–¼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn active" data-tab="directory" id="directoryTab">
                                <span class="nav-number">1</span><span class="nav-label">Employee Directory</span>
                            </button>
                        </div>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="organization-content">
                <!-- Employee Directory Tab -->
                <div class="tab-content active" id="directory">
                    <!-- Filters -->
                    <div class="filters-bar">
                        <div class="search-box-modern">
                            <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <input type="text" id="searchInput" placeholder="Search employees..." oninput="filterEmployees()">
                        </div>
                        <select class="filter-select" id="departmentFilter" onchange="filterEmployees()">
                            <option value="">All</option>
                        </select>
                        <select class="filter-select" id="officeFilter" onchange="filterEmployees()">
                            <option value="">All</option>
                        </select>
                        <select class="filter-select" id="statusFilter" onchange="filterEmployees()">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="on_notice">On Notice</option>
                            <option value="terminated">Terminated</option>
                        </select>
                        <button class="btn btn-primary" onclick="openCreateEmployeeModal()" id="createEmployeeBtn" style="display: none;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add Employee
                        </button>
                    </div>

                    <!-- Employee Stats -->
                    <div class="stats-row">
                        <div class="stat-mini">
                            <span class="stat-mini-value" id="totalCount">-</span>
                            <span class="stat-mini-label">Total</span>
                        </div>
                        <div class="stat-mini active">
                            <span class="stat-mini-value" id="activeCount">-</span>
                            <span class="stat-mini-label">Active</span>
                        </div>
                        <div class="stat-mini warning">
                            <span class="stat-mini-value" id="probationCount">-</span>
                            <span class="stat-mini-label">On Probation</span>
                        </div>
                        <div class="stat-mini danger">
                            <span class="stat-mini-value" id="exitCount">-</span>
                            <span class="stat-mini-label">Exits This Month</span>
                        </div>
                    </div>

                    <!-- Employees Table -->
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Department</th>
                                <th>Designation</th>
                                <th>Office</th>
                                <th>Joining Date</th>
                                <th>CTC</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="employeesTableBody">
                            <tr>
                                <td colspan="8">
                                    <div class="loading-spinner">
                                        <div class="spinner"></div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <!-- Create/Edit Employee Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content employee-wizard-modal">
                <div class="modal-header">
                    <h3 id="employeeModalTitle">Add Employee</h3>
                    <button class="close-btn" onclick="closeModal('employeeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>

                <!-- Wizard Steps Navigation -->
                <div class="wizard-steps">
                    <div class="wizard-step active" data-step="1" onclick="goToEmployeeStep(1)">
                        <div class="step-number">1</div>
                        <div class="step-label">Personal</div>
                    </div>
                    <div class="wizard-step-connector"></div>
                    <div class="wizard-step" data-step="2" onclick="goToEmployeeStep(2)">
                        <div class="step-number">2</div>
                        <div class="step-label">Employment</div>
                    </div>
                    <div class="wizard-step-connector"></div>
                    <div class="wizard-step" data-step="3" onclick="goToEmployeeStep(3)">
                        <div class="step-number">3</div>
                        <div class="step-label">Banking</div>
                    </div>
                    <div class="wizard-step-connector"></div>
                    <div class="wizard-step" data-step="4" onclick="goToEmployeeStep(4)">
                        <div class="step-number">4</div>
                        <div class="step-label">Documents</div>
                    </div>
                </div>

                <div class="modal-body">
                    <form id="employeeForm">
                        <input type="hidden" id="employeeId">

                        <!-- Step 1: Personal Information -->
                        <div class="wizard-panel active" id="employeeStep1">
                            <!-- User Selection (for new employees) -->
                            <div class="form-section" id="userSelectionSection">
                                <div class="form-group">
                                    <label>User Account <span class="required">*</span></label>
                                    <input type="hidden" id="userSelect" required>
                                    <div class="user-search-dropdown" id="userSearchDropdown">
                                        <div class="user-search-selected" id="userSearchSelected" onclick="toggleUserDropdown()">
                                            <span class="selected-user-text">Select a user...</span>
                                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="user-search-panel" id="userSearchPanel">
                                            <div class="search-box-modern">
                                                <svg class="search-icon" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"/>
                                                    <path d="m21 21-4.35-4.35"/>
                                                </svg>
                                                <input type="text" id="userSearchInput" placeholder="Search by name or email..." oninput="filterUserList()">
                                                <button type="button" class="clear-search-btn" id="clearUserSearchBtn" style="display: none;" onclick="clearUserSearch()">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="user-list-header">
                                                <span id="userCountDisplay">0 users</span>
                                            </div>
                                            <div id="userSearchList" class="users-list-modern">
                                                <p class="text-muted" style="text-align: center; font-size: 0.75rem; padding: 20px;">Loading users...</p>
                                            </div>
                                        </div>
                                    </div>
                                    <small class="form-text">Only users without employee profiles are shown</small>
                                </div>
                            </div>

                            <!-- User Info Display (read-only from Auth service) -->
                            <div class="user-info-display" id="userInfoDisplay" style="display: none;">
                                <input type="hidden" id="firstName">
                                <input type="hidden" id="lastName">
                                <input type="hidden" id="workEmail">
                                <div class="user-info-avatar">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                        <circle cx="12" cy="7" r="4"/>
                                    </svg>
                                </div>
                                <div class="form-group">
                                    <label>Name</label>
                                    <div class="readonly-field" id="userNameDisplay">-</div>
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <div class="readonly-field" id="userEmailDisplay">-</div>
                                </div>
                                <div class="user-info-badge">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                                    </svg>
                                    Selected
                                </div>
                            </div>

                            <!-- Photo and Basic Info in two columns -->
                            <div class="wizard-two-col photo-info-row-large">
                                <div class="wizard-col photo-col-large">
                                    <div class="form-group photo-upload-passport-large">
                                        <label>Photo <span class="required">*</span></label>
                                        <div class="photo-dropzone-passport-large" id="photoDropzone" onclick="triggerFileUpload('photo')">
                                            <input type="file" id="photo-file" accept=".jpg,.jpeg,.png" hidden onchange="handlePhotoSelect(this)">

                                            <!-- Empty State -->
                                            <div class="photo-empty-state" id="photoPlaceholder">
                                                <div class="photo-icon-medium">
                                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                                        <circle cx="12" cy="7" r="4"/>
                                                    </svg>
                                                </div>
                                                <span class="photo-text-medium">Upload Photo</span>
                                                <span class="photo-hint-small">JPG, PNG up to 5MB</span>
                                            </div>

                                            <!-- Image Preview -->
                                            <div class="photo-preview-wrapper" id="photoPreview" style="display: none;">
                                                <img id="photoImage" src="" alt="Employee Photo">
                                                <button type="button" class="photo-remove-btn" onclick="event.stopPropagation(); removePhoto();" title="Remove photo">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                        <input type="hidden" id="photo-doc-id">
                                    </div>
                                </div>
                                <div class="wizard-col info-col-large">
                                    <div class="form-row two-col equal-width">
                                        <div class="form-group">
                                            <label>Employee Code <span class="required">*</span></label>
                                            <input type="text" id="employeeCode" required placeholder="EMP001">
                                        </div>
                                        <div class="form-group">
                                            <label>Work Phone <span class="required">*</span></label>
                                            <input type="tel" id="workPhone" placeholder="+91-9876543210" required>
                                        </div>
                                    </div>
                                    <div class="form-row two-col equal-width">
                                        <div class="form-group">
                                            <label>Date of Birth <span class="required">*</span></label>
                                            <input type="date" id="dateOfBirth" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Gender</label>
                                            <select id="gender">
                                                <option value="">Select...</option>
                                                <option value="male">Male</option>
                                                <option value="female">Female</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Employment Details -->
                        <div class="wizard-panel" id="employeeStep2">
                            <div class="form-row two-col">
                                <!-- Office Searchable Dropdown -->
                                <div class="form-group">
                                    <label>Office <span class="required">*</span></label>
                                    <input type="hidden" id="officeId" required>
                                    <div class="searchable-dropdown" id="officeDropdown" data-field="office">
                                        <div class="searchable-dropdown-trigger" onclick="toggleSearchableDropdown('office')">
                                            <span class="selected-text placeholder">Select office...</span>
                                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="searchable-dropdown-panel">
                                            <div class="searchable-dropdown-search">
                                                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"/>
                                                    <path d="m21 21-4.35-4.35"/>
                                                </svg>
                                                <input type="text" placeholder="Search offices..." oninput="filterSearchableDropdown('office', this.value)">
                                                <button type="button" class="clear-btn" onclick="clearSearchableDropdown('office')">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="searchable-dropdown-header"><span class="item-count">0 offices</span></div>
                                            <div class="searchable-dropdown-list"></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Department Searchable Dropdown -->
                                <div class="form-group">
                                    <label>Department <span class="required">*</span></label>
                                    <input type="hidden" id="departmentId" required>
                                    <div class="searchable-dropdown" id="departmentDropdown" data-field="department">
                                        <div class="searchable-dropdown-trigger disabled" onclick="toggleSearchableDropdown('department')">
                                            <span class="selected-text placeholder">Select office first...</span>
                                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="searchable-dropdown-panel">
                                            <div class="searchable-dropdown-search">
                                                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"/>
                                                    <path d="m21 21-4.35-4.35"/>
                                                </svg>
                                                <input type="text" placeholder="Search departments..." oninput="filterSearchableDropdown('department', this.value)">
                                                <button type="button" class="clear-btn" onclick="clearSearchableDropdown('department')">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="searchable-dropdown-header"><span class="item-count">0 departments</span></div>
                                            <div class="searchable-dropdown-list"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <!-- Designation Searchable Dropdown -->
                                <div class="form-group">
                                    <label>Designation <span class="required">*</span></label>
                                    <input type="hidden" id="designationId" required>
                                    <div class="searchable-dropdown" id="designationDropdown" data-field="designation">
                                        <div class="searchable-dropdown-trigger disabled" onclick="toggleSearchableDropdown('designation')">
                                            <span class="selected-text placeholder">Select department first...</span>
                                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="searchable-dropdown-panel">
                                            <div class="searchable-dropdown-search">
                                                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"/>
                                                    <path d="m21 21-4.35-4.35"/>
                                                </svg>
                                                <input type="text" placeholder="Search designations..." oninput="filterSearchableDropdown('designation', this.value)">
                                                <button type="button" class="clear-btn" onclick="clearSearchableDropdown('designation')">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="searchable-dropdown-header"><span class="item-count">0 designations</span></div>
                                            <div class="searchable-dropdown-list"></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Shift Searchable Dropdown -->
                                <div class="form-group">
                                    <label>Shift</label>
                                    <input type="hidden" id="shiftId">
                                    <div class="searchable-dropdown" id="shiftDropdown" data-field="shift">
                                        <div class="searchable-dropdown-trigger disabled" onclick="toggleSearchableDropdown('shift')">
                                            <span class="selected-text placeholder">Select office first...</span>
                                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="searchable-dropdown-panel">
                                            <div class="searchable-dropdown-search">
                                                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"/>
                                                    <path d="m21 21-4.35-4.35"/>
                                                </svg>
                                                <input type="text" placeholder="Search shifts..." oninput="filterSearchableDropdown('shift', this.value)">
                                                <button type="button" class="clear-btn" onclick="clearSearchableDropdown('shift')">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="searchable-dropdown-header"><span class="item-count">0 shifts</span></div>
                                            <div class="searchable-dropdown-list"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <!-- Reporting Manager Searchable Dropdown -->
                                <div class="form-group">
                                    <label>Reporting Manager</label>
                                    <input type="hidden" id="reportingManagerId">
                                    <div class="searchable-dropdown" id="managerDropdown" data-field="manager">
                                        <div class="searchable-dropdown-trigger" onclick="toggleSearchableDropdown('manager')">
                                            <span class="selected-text placeholder">None (Select manager...)</span>
                                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="searchable-dropdown-panel">
                                            <div class="searchable-dropdown-search">
                                                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"/>
                                                    <path d="m21 21-4.35-4.35"/>
                                                </svg>
                                                <input type="text" placeholder="Search managers..." oninput="filterSearchableDropdown('manager', this.value)">
                                                <button type="button" class="clear-btn" onclick="clearSearchableDropdown('manager')">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="searchable-dropdown-header"><span class="item-count">0 managers</span></div>
                                            <div class="searchable-dropdown-list"></div>
                                        </div>
                                    </div>
                                    <small class="validation-message text-danger" id="managerValidationMsg" style="display: none;"></small>
                                </div>
                                <div class="form-group">
                                    <label>Employment Type <span class="required">*</span></label>
                                    <select id="employmentType" required>
                                        <option value="full-time">Full Time</option>
                                        <option value="part-time">Part Time</option>
                                        <option value="contract">Contract</option>
                                        <option value="intern">Intern</option>
                                        <option value="temporary">Temporary</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Date of Joining <span class="required">*</span></label>
                                    <input type="date" id="dateOfJoining" required>
                                </div>
                                <div class="form-group">
                                    <label>Probation End Date <span class="required">*</span></label>
                                    <input type="date" id="probationEndDate" required>
                                </div>
                            </div>

                            <!-- Geofence Attendance Toggle -->
                            <div class="geofence-toggle-card employee-geofence">
                                <div class="toggle-info">
                                    <div class="toggle-title">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="10" r="3"/>
                                            <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"/>
                                        </svg>
                                        Enable Geofence Attendance
                                    </div>
                                    <p class="toggle-description">When enabled, this employee must be within the assigned office geofence radius to clock in/out. Overrides office-level setting.</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enableGeofenceAttendance" name="enable_geofence_attendance">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Step 3: Banking Details -->
                        <div class="wizard-panel" id="employeeStep3">
                            <p class="wizard-step-hint">Bank account details for salary disbursement</p>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Account Holder Name <span class="required">*</span></label>
                                    <input type="text" id="accountHolderName" placeholder="Name as per bank account">
                                </div>
                                <div class="form-group">
                                    <label>Bank Name <span class="required">*</span></label>
                                    <input type="text" id="bankName" placeholder="e.g. HDFC Bank">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>Account Number <span class="required">*</span></label>
                                    <input type="text" id="accountNumber" placeholder="Bank account number">
                                </div>
                                <div class="form-group">
                                    <label>Confirm Account Number <span class="required">*</span></label>
                                    <input type="text" id="confirmAccountNumber" placeholder="Re-enter account number">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label>IFSC / SWIFT / BIC / IBAN <span class="required">*</span></label>
                                    <input type="text" id="ifscCode" placeholder="Bank routing code" style="text-transform: uppercase;">
                                </div>
                                <div class="form-group">
                                    <label>Branch Name</label>
                                    <input type="text" id="branchName" placeholder="Branch name">
                                </div>
                            </div>
                            <input type="hidden" id="bankAccountId">
                        </div>

                        <!-- Step 4: Identity Documents -->
                        <div class="wizard-panel" id="employeeStep4">
                            <p class="wizard-step-hint">Photo, Tax ID (front & back), and National ID (front & back) are mandatory</p>
                            <div class="document-grid-compact" id="documentUploadGrid">
                                <!-- Tax ID / PAN Card -->
                                <div class="document-item-compact" data-doc-type="pan">
                                    <div class="doc-header-inline">
                                        <div class="doc-label-section">
                                            <span class="doc-label">Tax ID / PAN <span class="required">*</span></span>
                                        </div>
                                        <input type="text" id="pan-number" class="doc-input-inline" placeholder="Enter ID number" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" style="text-transform: uppercase;">
                                    </div>
                                    <div class="doc-uploads-row">
                                        <!-- Front Side -->
                                        <div class="doc-upload-card" id="pan_front-card">
                                            <input type="file" id="pan_front-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('pan_front', this)">
                                            <div class="doc-upload-placeholder" id="pan_front-placeholder" onclick="triggerFileUpload('pan_front')">
                                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                                    <path d="M21 15l-5-5L5 21"/>
                                                </svg>
                                                <span class="upload-text">Front Side</span>
                                                <span class="upload-hint">Click to upload</span>
                                            </div>
                                            <div class="doc-upload-preview" id="pan_front-preview-card" style="display:none">
                                                <img class="doc-thumbnail" id="pan_front-thumb" onclick="openDocumentZoom('pan_front')" alt="Front">
                                                <div class="doc-preview-overlay">
                                                    <span class="preview-label">Front</span>
                                                    <button type="button" class="preview-remove-btn" onclick="removeDocument('pan_front')" title="Remove">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                                <div class="doc-zoom-hint">Click to enlarge</div>
                                            </div>
                                            <input type="hidden" id="pan_front-doc-id">
                                        </div>
                                        <!-- Back Side -->
                                        <div class="doc-upload-card" id="pan_back-card">
                                            <input type="file" id="pan_back-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('pan_back', this)">
                                            <div class="doc-upload-placeholder" id="pan_back-placeholder" onclick="triggerFileUpload('pan_back')">
                                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                                    <path d="M21 15l-5-5L5 21"/>
                                                </svg>
                                                <span class="upload-text">Back Side</span>
                                                <span class="upload-hint">Click to upload</span>
                                            </div>
                                            <div class="doc-upload-preview" id="pan_back-preview-card" style="display:none">
                                                <img class="doc-thumbnail" id="pan_back-thumb" onclick="openDocumentZoom('pan_back')" alt="Back">
                                                <div class="doc-preview-overlay">
                                                    <span class="preview-label">Back</span>
                                                    <button type="button" class="preview-remove-btn" onclick="removeDocument('pan_back')" title="Remove">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                                <div class="doc-zoom-hint">Click to enlarge</div>
                                            </div>
                                            <input type="hidden" id="pan_back-doc-id">
                                        </div>
                                    </div>
                                </div>

                                <!-- National ID / Aadhar / SSN -->
                                <div class="document-item-compact" data-doc-type="aadhar">
                                    <div class="doc-header-inline">
                                        <div class="doc-label-section">
                                            <span class="doc-label">National ID / Aadhar <span class="required">*</span></span>
                                        </div>
                                        <input type="text" id="aadhar-number" class="doc-input-inline" placeholder="Enter ID number" pattern="[0-9]{12}" maxlength="12">
                                    </div>
                                    <div class="doc-uploads-row">
                                        <!-- Front Side -->
                                        <div class="doc-upload-card" id="aadhar_front-card">
                                            <input type="file" id="aadhar_front-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('aadhar_front', this)">
                                            <div class="doc-upload-placeholder" id="aadhar_front-placeholder" onclick="triggerFileUpload('aadhar_front')">
                                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                                    <path d="M21 15l-5-5L5 21"/>
                                                </svg>
                                                <span class="upload-text">Front Side</span>
                                                <span class="upload-hint">Click to upload</span>
                                            </div>
                                            <div class="doc-upload-preview" id="aadhar_front-preview-card" style="display:none">
                                                <img class="doc-thumbnail" id="aadhar_front-thumb" onclick="openDocumentZoom('aadhar_front')" alt="Front">
                                                <div class="doc-preview-overlay">
                                                    <span class="preview-label">Front</span>
                                                    <button type="button" class="preview-remove-btn" onclick="removeDocument('aadhar_front')" title="Remove">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                                <div class="doc-zoom-hint">Click to enlarge</div>
                                            </div>
                                            <input type="hidden" id="aadhar_front-doc-id">
                                        </div>
                                        <!-- Back Side -->
                                        <div class="doc-upload-card" id="aadhar_back-card">
                                            <input type="file" id="aadhar_back-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('aadhar_back', this)">
                                            <div class="doc-upload-placeholder" id="aadhar_back-placeholder" onclick="triggerFileUpload('aadhar_back')">
                                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                                    <path d="M21 15l-5-5L5 21"/>
                                                </svg>
                                                <span class="upload-text">Back Side</span>
                                                <span class="upload-hint">Click to upload</span>
                                            </div>
                                            <div class="doc-upload-preview" id="aadhar_back-preview-card" style="display:none">
                                                <img class="doc-thumbnail" id="aadhar_back-thumb" onclick="openDocumentZoom('aadhar_back')" alt="Back">
                                                <div class="doc-preview-overlay">
                                                    <span class="preview-label">Back</span>
                                                    <button type="button" class="preview-remove-btn" onclick="removeDocument('aadhar_back')" title="Remove">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                                <div class="doc-zoom-hint">Click to enlarge</div>
                                            </div>
                                            <input type="hidden" id="aadhar_back-doc-id">
                                        </div>
                                    </div>
                                </div>

                                <!-- Passport (Optional) -->
                                <div class="document-item-compact" data-doc-type="passport">
                                    <div class="doc-header-inline">
                                        <div class="doc-label-section">
                                            <span class="doc-label">Passport <span class="optional-badge">Optional</span></span>
                                        </div>
                                        <input type="text" id="passport-number" class="doc-input-inline" placeholder="Passport number" style="text-transform: uppercase;">
                                        <input type="date" id="passport-expiry" class="doc-input-inline doc-input-date" title="Expiry Date">
                                    </div>
                                    <div class="doc-uploads-row doc-uploads-single">
                                        <div class="doc-upload-card doc-upload-card-wide" id="passport-card">
                                            <input type="file" id="passport-file" accept=".pdf,.jpg,.jpeg,.png" hidden onchange="handleDocumentSelect('passport', this)">
                                            <div class="doc-upload-placeholder" id="passport-placeholder" onclick="triggerFileUpload('passport')">
                                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                                    <path d="M21 15l-5-5L5 21"/>
                                                </svg>
                                                <span class="upload-text">Passport Photo Page</span>
                                                <span class="upload-hint">Click to upload</span>
                                            </div>
                                            <div class="doc-upload-preview" id="passport-preview-card" style="display:none">
                                                <img class="doc-thumbnail" id="passport-thumb" onclick="openDocumentZoom('passport')" alt="Passport">
                                                <div class="doc-preview-overlay">
                                                    <span class="preview-label">Passport</span>
                                                    <button type="button" class="preview-remove-btn" onclick="removeDocument('passport')" title="Remove">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                                <div class="doc-zoom-hint">Click to enlarge</div>
                                            </div>
                                            <input type="hidden" id="passport-doc-id">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Document Zoom Modal -->
                        <div class="doc-zoom-modal" id="docZoomModal" onclick="closeDocumentZoom(event)">
                            <div class="doc-zoom-content">
                                <img id="docZoomImage" src="" alt="Document Preview">
                                <button class="doc-zoom-close" onclick="closeDocumentZoom(event)">&times;</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Wizard Navigation Footer -->
                <div class="modal-footer wizard-footer">
                    <button class="btn btn-outline" id="empWizardPrevBtn" onclick="prevEmployeeStep()" style="display: none;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        Back
                    </button>
                    <div class="wizard-footer-spacer"></div>
                    <button class="btn btn-primary" id="empWizardNextBtn" onclick="nextEmployeeStep()">
                        Next
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                    <button class="btn btn-primary" id="empWizardSaveBtn" onclick="saveEmployee()" style="display: none;">
                        Save Employee
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Employee Modal -->
    <div class="modal" id="viewEmployeeModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Employee Details</h3>
                    <button class="close-btn" onclick="closeModal('viewEmployeeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" id="viewEmployeeContent">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="editFromView()" id="editFromViewBtn">Edit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Salary Modal -->
    <div class="modal" id="salaryModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="salaryModalTitle">Manage Employee Salary</h3>
                    <button class="close-btn" onclick="closeModal('salaryModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Employee Info Header -->
                    <div class="salary-employee-header" id="salaryEmployeeHeader">
                        <div class="employee-info">
                            <div class="employee-avatar" id="salaryEmployeeAvatar">-</div>
                            <div class="employee-details">
                                <h4 id="salaryEmployeeName">-</h4>
                                <p id="salaryEmployeeDesignation">-</p>
                            </div>
                        </div>
                        <div class="salary-status" id="salaryStatusBadge">
                            <span class="badge badge-warning">Not Configured</span>
                        </div>
                    </div>

                    <!-- Current Salary Display (when exists) -->
                    <div class="current-salary-section" id="currentSalarySection" style="display: none;">
                        <h4>Current Salary</h4>
                        <div class="salary-summary-grid">
                            <div class="salary-card">
                                <span class="salary-label">Annual CTC</span>
                                <span class="salary-value" id="currentCTC">-</span>
                            </div>
                            <div class="salary-card">
                                <span class="salary-label">Monthly Gross</span>
                                <span class="salary-value" id="currentMonthlyGross">-</span>
                            </div>
                            <div class="salary-card">
                                <span class="salary-label">Monthly Net</span>
                                <span class="salary-value" id="currentMonthlyNet">-</span>
                            </div>
                        </div>
                        <div class="salary-effective-from">
                            <span>Effective From: </span>
                            <span id="currentEffectiveFrom">-</span>
                        </div>
                    </div>

                    <!-- Salary Form -->
                    <form id="salaryForm">
                        <input type="hidden" id="salaryEmployeeId">
                        <input type="hidden" id="existingSalaryId">

                        <div class="form-section">
                            <h4 id="salaryFormTitle">Configure Salary</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Salary Structure <span class="required">*</span></label>
                                    <select id="salaryStructureId" required onchange="previewSalaryBreakdown()">
                                        <option value="">Select Salary Structure...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Annual CTC <span class="required">*</span></label>
                                    <div class="input-with-prefix">
                                        <span class="input-prefix">â‚¹</span>
                                        <input type="number" id="salaryCTC" required min="0" step="1"
                                               placeholder="e.g. 1200000" onchange="previewSalaryBreakdown()">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Effective From <span class="required">*</span></label>
                                    <input type="date" id="salaryEffectiveFrom" required>
                                </div>
                                <div class="form-group" id="revisionReasonGroup" style="display: none;">
                                    <label>Revision Reason</label>
                                    <select id="salaryRevisionType">
                                        <option value="adjustment">Adjustment</option>
                                        <option value="promotion">Promotion</option>
                                        <option value="annual_increment">Annual Increment</option>
                                        <option value="correction">Correction</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Salary Breakdown Preview -->
                        <div class="form-section" id="salaryBreakdownSection" style="display: none;">
                            <h4>Salary Breakdown Preview</h4>
                            <div class="salary-breakdown-grid" id="salaryBreakdownGrid">
                                <!-- Dynamically populated -->
                            </div>
                            <div class="salary-totals">
                                <div class="salary-total-row">
                                    <span>Monthly Gross</span>
                                    <span id="previewMonthlyGross">â‚¹0</span>
                                </div>
                                <div class="salary-total-row">
                                    <span>Monthly Deductions</span>
                                    <span id="previewMonthlyDeductions">â‚¹0</span>
                                </div>
                                <div class="salary-total-row net">
                                    <span>Monthly Net Pay</span>
                                    <span id="previewMonthlyNet">â‚¹0</span>
                                </div>
                            </div>
                        </div>
                    </form>

                    <!-- Salary History Section -->
                    <div class="form-section compact" id="salaryHistorySection" style="display: none;">
                        <h4>Salary History</h4>
                        <div class="salary-history-table-wrapper">
                            <table class="salary-history-table compact">
                                <thead>
                                    <tr>
                                        <th style="width: 22%;">Date</th>
                                        <th style="width: 28%;">CTC</th>
                                        <th style="width: 12%;">Change</th>
                                        <th style="width: 18%;">Type</th>
                                        <th style="width: 20%;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="salaryHistoryTableBody">
                                    <!-- Dynamically populated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="saveEmployeeSalary()" id="saveSalaryBtn">
                        <span id="saveSalaryBtnText">Save Salary</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Scheduled Salary Modal -->
    <div class="modal" id="editScheduledSalaryModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Scheduled Salary</h3>
                    <button class="close-btn" onclick="closeModal('editScheduledSalaryModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" style="margin-bottom: 1rem; padding: 0.75rem; border-radius: 6px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <small>This salary entry has not been used in any payroll processing yet, so it can be edited.</small>
                    </div>
                    <form id="editScheduledSalaryForm">
                        <div class="form-group">
                            <label for="editSalaryCTC">Annual CTC *</label>
                            <input type="number" id="editSalaryCTC" class="form-control" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="editSalaryEffectiveFrom">Effective From *</label>
                            <input type="date" id="editSalaryEffectiveFrom" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editSalaryRevisionReason">Revision Reason</label>
                            <input type="text" id="editSalaryRevisionReason" class="form-control" placeholder="e.g., Annual Increment, Correction">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('editScheduledSalaryModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveScheduledSalaryEdit()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfer Employee Modal -->
    <div class="modal" id="transferModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Transfer Employee</h3>
                    <button class="close-btn" onclick="closeModal('transferModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Compact Employee Card with Current Assignment -->
                    <div class="transfer-employee-card">
                        <div class="employee-avatar" id="transferEmployeeAvatar">-</div>
                        <div class="employee-card-content">
                            <div class="employee-card-header">
                                <span class="employee-name" id="transferEmployeeName">-</span>
                                <span class="employee-code" id="transferEmployeeCode">-</span>
                            </div>
                            <div class="assignment-row">
                                <span class="assign-item"><span class="assign-icon">ðŸ“</span><span id="currentOfficeName">-</span></span>
                                <span class="assign-item"><span class="assign-icon">ðŸ¢</span><span id="currentDepartmentName">-</span></span>
                                <span class="assign-item"><span class="assign-icon">ðŸ’¼</span><span id="currentDesignationName">-</span></span>
                                <span class="assign-item"><span class="assign-icon">ðŸ‘¤</span><span id="currentManagerName">-</span></span>
                            </div>
                        </div>
                    </div>

                    <form id="transferForm">
                        <input type="hidden" id="transferEmployeeId">

                        <!-- Transfer Details -->
                        <div class="form-section">
                            <h4>Transfer Details</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Transfer Type <span class="required">*</span></label>
                                    <select id="transferType" required>
                                        <option value="transfer">Transfer</option>
                                        <option value="promotion">Promotion</option>
                                        <option value="demotion">Demotion</option>
                                        <option value="deputation">Deputation</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Effective Date <span class="required">*</span></label>
                                    <input type="date" id="transferEffectiveDate" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Transfer Reason</label>
                                <textarea id="transferReason" rows="2" placeholder="Optional reason for transfer..."></textarea>
                            </div>
                        </div>

                        <!-- What to Change Section -->
                        <div class="form-section">
                            <h4>Select Changes</h4>
                            <div class="transfer-toggle-options">
                                <div class="switch-container">
                                    <label class="switch">
                                        <input type="checkbox" id="changeOffice" onchange="toggleTransferSection('officeChangeSection', this)">
                                        <span class="slider round"></span>
                                    </label>
                                    <span class="switch-label">Change Office</span>
                                </div>
                                <div class="switch-container">
                                    <label class="switch">
                                        <input type="checkbox" id="changeDepartment" onchange="toggleTransferSection('departmentChangeSection', this)">
                                        <span class="slider round"></span>
                                    </label>
                                    <span class="switch-label">Change Department</span>
                                </div>
                                <div class="switch-container">
                                    <label class="switch">
                                        <input type="checkbox" id="changeManager" onchange="toggleTransferSection('managerChangeSection', this)">
                                        <span class="slider round"></span>
                                    </label>
                                    <span class="switch-label">Change Manager</span>
                                </div>
                                <div class="switch-container">
                                    <label class="switch">
                                        <input type="checkbox" id="reviseSalary" onchange="toggleTransferSection('salaryRevisionSection', this)">
                                        <span class="slider round"></span>
                                    </label>
                                    <span class="switch-label">Revise Salary</span>
                                </div>
                            </div>
                        </div>

                        <!-- Office Change Section -->
                        <div class="form-section conditional-section" id="officeChangeSection" style="display: none;">
                            <h4>New Office</h4>
                            <div class="form-group">
                                <label>Select New Office <span class="required">*</span></label>
                                <select id="newOfficeId">
                                    <option value="">Select new office...</option>
                                </select>
                            </div>
                        </div>

                        <!-- Department Change Section -->
                        <div class="form-section conditional-section" id="departmentChangeSection" style="display: none;">
                            <h4>New Department & Designation</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>New Department <span class="required">*</span></label>
                                    <select id="newDepartmentId" onchange="onNewDepartmentChange()">
                                        <option value="">Select new department...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>New Designation</label>
                                    <select id="newDesignationId">
                                        <option value="">Select department first...</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Manager Change Section -->
                        <div class="form-section conditional-section" id="managerChangeSection" style="display: none;">
                            <h4>New Reporting Manager</h4>
                            <div class="form-group">
                                <label>New Manager</label>
                                <select id="newManagerUserId" onchange="onTransferManagerChange()">
                                    <option value="">No manager (CEO/Top level)</option>
                                </select>
                                <small class="validation-message text-danger" id="transferManagerValidationMsg" style="display: none;"></small>
                            </div>
                        </div>

                        <!-- Salary Revision Section -->
                        <div class="form-section conditional-section" id="salaryRevisionSection" style="display: none;">
                            <h4>Salary Revision</h4>
                            <div class="form-group">
                                <label>New Annual CTC</label>
                                <div class="input-with-prefix">
                                    <span class="input-prefix">â‚¹</span>
                                    <input type="number" id="newCTC" min="0" step="1" placeholder="Enter new CTC...">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="submitTransfer()" id="submitTransferBtn">Submit Transfer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reassign Manager Modal (Compact with Searchable Dropdown) -->
    <div class="modal" id="reassignManagerModal">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content modal-compact">
                <div class="modal-header compact-header">
                    <div class="header-with-employee">
                        <div class="employee-badge" id="reassignEmployeeAvatar">--</div>
                        <div>
                            <h4 id="reassignEmployeeName">Employee Name</h4>
                            <span class="employee-meta" id="reassignEmployeeCode">EMP000</span>
                        </div>
                    </div>
                    <button class="close-btn" onclick="closeModal('reassignManagerModal')">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body compact-body">
                    <input type="hidden" id="reassignEmployeeId">

                    <!-- Manager History Section -->
                    <div class="manager-history-section">
                        <span class="section-label">Reporting History <span class="manager-history-count" id="managerHistoryCount" style="display: none;">0</span></span>
                        <div class="manager-history-list" id="managerHistoryList">
                            <div class="no-history-message">Loading...</div>
                        </div>
                    </div>

                    <!-- Searchable Manager Dropdown -->
                    <div class="form-group compact-group">
                        <label>New Manager</label>
                        <div class="searchable-dropdown" id="managerDropdownContainer">
                            <div class="dropdown-input-wrapper">
                                <input type="text" class="dropdown-search" id="managerSearchInput"
                                       placeholder="Search managers..." autocomplete="off">
                                <input type="hidden" id="newReportingManagerId">
                                <svg class="dropdown-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </div>
                            <div class="dropdown-list" id="managerDropdownList">
                                <div class="dropdown-item no-manager" data-value="">
                                    <span class="item-avatar">â€”</span>
                                    <span>No manager (Top level)</span>
                                </div>
                                <!-- Virtual scrolling container -->
                                <div class="virtual-scroll-container" id="managerVirtualList"></div>
                            </div>
                        </div>
                        <small class="validation-message text-danger" id="reassignManagerValidationMsg" style="display: none;"></small>
                    </div>

                    <!-- Effective Date & Reason in one row -->
                    <div class="form-row compact-row">
                        <div class="form-group compact-group flex-1">
                            <label>Effective Date</label>
                            <input type="date" id="reassignEffectiveDate" class="form-control form-control-sm" required>
                        </div>
                        <div class="form-group compact-group flex-2">
                            <label>Reason <span class="optional">(optional)</span></label>
                            <input type="text" id="reassignReason" class="form-control form-control-sm" placeholder="e.g., Restructuring">
                        </div>
                    </div>
                </div>
                <div class="modal-footer compact-footer">
                    <button class="btn btn-sm btn-secondary" onclick="closeModal('reassignManagerModal')">Cancel</button>
                    <button class="btn btn-sm btn-primary" onclick="submitReassignManager()" id="submitReassignBtn">Reassign</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transfer History Modal -->
    <div class="modal" id="transferHistoryModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Transfer History</h3>
                    <button class="close-btn" onclick="closeModal('transferHistoryModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" id="transferHistoryContent">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Terminate Employee Modal -->
    <div class="modal" id="terminateModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header modal-header-danger">
                    <h5 class="modal-title">Terminate Employee</h5>
                    <button class="close-btn" onclick="closeModal('terminateModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="terminate-warning">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <div>
                            <strong>Warning: This action cannot be undone.</strong>
                            <p>Terminating an employee will deactivate their account and end their employment record.</p>
                        </div>
                    </div>
                    <div class="terminate-employee-info" id="terminateEmployeeInfo">
                        <!-- Employee info will be populated -->
                    </div>
                    <form id="terminateForm">
                        <input type="hidden" id="terminateEmployeeId">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="lastWorkingDate">Last Working Date *</label>
                                    <input type="date" id="lastWorkingDate" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="terminationReason">Termination Reason *</label>
                                    <select id="terminationReason" class="form-control" required>
                                        <option value="">Select Reason</option>
                                        <option value="resignation">Resignation</option>
                                        <option value="termination">Termination</option>
                                        <option value="retirement">Retirement</option>
                                        <option value="contract_end">Contract End</option>
                                        <option value="layoff">Layoff</option>
                                        <option value="mutual_separation">Mutual Separation</option>
                                        <option value="absconding">Absconding</option>
                                        <option value="death">Death</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="exitInterviewDate">Exit Interview Date</label>
                                    <input type="date" id="exitInterviewDate" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="settlementDate">Full & Final Settlement Date</label>
                                    <input type="date" id="settlementDate" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="exitNotes">Exit Notes</label>
                                <textarea id="exitNotes" class="form-control" rows="3" placeholder="Enter any additional notes about the termination..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="confirmTermination" required>
                                    <span>I confirm that I want to terminate this employee and understand this action cannot be undone.</span>
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="confirmTerminateEmployee()">Terminate Employee</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/roleUtils.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/employees.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</body>
</html>
