<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cookie Consent & Analytics -->
    <script src="/js/cookie-consent.js" defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <title>My Profile - HRMS</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-ess.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/brand_logo.png" alt="Ragenaizer Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <!-- Navigation links rendered by Navigation.init() -->
        </div>
    </nav>

    <div class="ess-container">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">
                <span id="avatarInitials">--</span>
            </div>
            <div class="profile-info">
                <h1 id="employeeName">Loading...</h1>
                <p class="employee-code" id="employeeCode">--</p>
                <div class="profile-meta">
                    <div class="profile-meta-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        <span id="designation">--</span>
                    </div>
                    <div class="profile-meta-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                        <span id="department">--</span>
                    </div>
                    <div class="profile-meta-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        <span id="office">--</span>
                    </div>
                    <div class="profile-meta-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <span id="joiningDate">Joined: --</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Tabs -->
        <div class="profile-tabs">
            <button class="profile-tab active" data-tab="personal" onclick="showTab('personal')">Personal Info</button>
            <button class="profile-tab" data-tab="employment" onclick="showTab('employment')">Employment</button>
            <button class="profile-tab" data-tab="bank" onclick="showTab('bank')">Bank Accounts</button>
            <button class="profile-tab" data-tab="statutory" onclick="showTab('statutory')">Statutory Info</button>
            <button class="profile-tab" data-tab="documents" onclick="showTab('documents')">Documents</button>
            <button class="profile-tab" data-tab="requests" onclick="showTab('requests')">Update Requests</button>
            <button class="profile-tab" data-tab="nfc" onclick="showTab('nfc')">NFC Cards</button>
        </div>

        <!-- Personal Info Tab -->
        <div class="profile-section tab-content" id="tab-personal">
            <div class="profile-section-header">
                <h3 class="profile-section-title">Personal Information</h3>
                <button class="btn-request-update" onclick="openUpdateRequestModal('personal_info')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Request Update
                </button>
            </div>
            <div class="profile-fields">
                <div class="profile-field">
                    <span class="profile-field-label">First Name</span>
                    <span class="profile-field-value" id="firstName">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Last Name</span>
                    <span class="profile-field-value" id="lastName">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Date of Birth</span>
                    <span class="profile-field-value" id="dateOfBirth">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Gender</span>
                    <span class="profile-field-value" id="gender">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Personal Email</span>
                    <span class="profile-field-value" id="personalEmail">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Personal Phone</span>
                    <span class="profile-field-value" id="personalPhone">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Emergency Contact Name</span>
                    <span class="profile-field-value" id="emergencyContactName">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Emergency Contact Phone</span>
                    <span class="profile-field-value" id="emergencyContactPhone">--</span>
                </div>
            </div>

            <h4 class="profile-subsection-title">Address</h4>
            <div class="profile-fields">
                <div class="profile-field full-width">
                    <span class="profile-field-label">Permanent Address</span>
                    <span class="profile-field-value" id="permanentAddress">--</span>
                </div>
                <div class="profile-field full-width">
                    <span class="profile-field-label">Current Address</span>
                    <span class="profile-field-value" id="currentAddress">--</span>
                </div>
            </div>
        </div>

        <!-- Employment Tab -->
        <div class="profile-section tab-content hidden" id="tab-employment">
            <h3 class="profile-section-title">Employment Details</h3>
            <div class="profile-fields">
                <div class="profile-field">
                    <span class="profile-field-label">Employee Code</span>
                    <span class="profile-field-value" id="empCode">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Work Email</span>
                    <span class="profile-field-value" id="workEmail">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Work Phone</span>
                    <span class="profile-field-value" id="workPhone">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Department</span>
                    <span class="profile-field-value" id="empDepartment">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Designation</span>
                    <span class="profile-field-value" id="empDesignation">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Office Location</span>
                    <span class="profile-field-value" id="empOffice">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Shift</span>
                    <span class="profile-field-value" id="empShift">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Reporting Manager</span>
                    <span class="profile-field-value" id="reportingManager">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Date of Joining</span>
                    <span class="profile-field-value" id="empJoiningDate">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Employment Type</span>
                    <span class="profile-field-value" id="employmentType">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Employment Status</span>
                    <span class="profile-field-value" id="employmentStatus">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Probation End Date</span>
                    <span class="profile-field-value" id="probationEndDate">--</span>
                </div>
            </div>
        </div>

        <!-- Bank Accounts Tab -->
        <div class="profile-section tab-content hidden" id="tab-bank">
            <div class="profile-section-header">
                <h3 class="profile-section-title">Bank Accounts</h3>
                <button class="btn-request-update" onclick="openUpdateRequestModal('bank_account')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Request Update
                </button>
            </div>
            <div id="bankAccountsList" class="bank-accounts-list">
                <div class="ess-loading">
                    <div class="spinner"></div>
                    <span>Loading bank accounts...</span>
                </div>
            </div>
        </div>

        <!-- Statutory Info Tab -->
        <div class="profile-section tab-content hidden" id="tab-statutory">
            <div class="profile-section-header">
                <h3 class="profile-section-title">Statutory Information</h3>
                <button class="btn-request-update" onclick="openUpdateRequestModal('statutory_info')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Request Update
                </button>
            </div>
            <div class="profile-fields">
                <div class="profile-field">
                    <span class="profile-field-label">PAN Number</span>
                    <span class="profile-field-value" id="panNumber">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">Aadhaar Number</span>
                    <span class="profile-field-value" id="aadharNumber">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">PF Number</span>
                    <span class="profile-field-value" id="pfNumber">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">UAN</span>
                    <span class="profile-field-value" id="uanNumber">--</span>
                </div>
                <div class="profile-field">
                    <span class="profile-field-label">ESI Number</span>
                    <span class="profile-field-value" id="esiNumber">--</span>
                </div>
            </div>
        </div>

        <!-- Documents Tab -->
        <div class="profile-section tab-content hidden" id="tab-documents">
            <h3 class="profile-section-title">Documents</h3>
            <div id="documentsList" class="documents-list">
                <div class="ess-loading">
                    <div class="spinner"></div>
                    <span>Loading documents...</span>
                </div>
            </div>
        </div>

        <!-- Update Requests Tab -->
        <div class="profile-section tab-content hidden" id="tab-requests">
            <h3 class="profile-section-title">Profile Update Requests</h3>
            <div id="updateRequestsList" class="update-requests-list">
                <div class="ess-loading">
                    <div class="spinner"></div>
                    <span>Loading requests...</span>
                </div>
            </div>
        </div>

        <!-- NFC Cards Tab -->
        <div class="profile-section tab-content hidden" id="tab-nfc">
            <h3 class="profile-section-title">NFC Access Cards</h3>
            <p class="section-description">Your assigned NFC cards for attendance tracking and building access.</p>

            <!-- Cards List -->
            <div id="myNfcCardsList" class="my-nfc-cards-list">
                <div class="ess-loading" id="nfcCardsLoading">
                    <div class="spinner"></div>
                    <span>Loading cards...</span>
                </div>
                <div class="ess-empty-state" id="nfcCardsEmpty" style="display: none;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="2" y="5" width="20" height="14" rx="2"/>
                        <line x1="2" y1="10" x2="22" y2="10"/>
                    </svg>
                    <p>No NFC cards assigned</p>
                    <small>Contact HR if you need an access card issued</small>
                </div>
            </div>

            <!-- Public Profile Section -->
            <div class="profile-subsection" id="publicProfileSection">
                <h4 class="profile-subsection-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Public Profile
                </h4>
                <p class="subsection-description">When enabled, your basic info (name, photo, designation) can be displayed when tapping your NFC card on public kiosks.</p>

                <div class="profile-toggle-row">
                    <label class="toggle-switch">
                        <input type="checkbox" id="myPublicProfileEnabled" onchange="toggleMyPublicProfile()">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Enable Public Profile</span>
                    </label>
                </div>

                <div class="public-profile-url-section" id="myPublicProfileUrlSection" style="display: none;">
                    <div class="profile-field">
                        <span class="profile-field-label">Your Public Profile URL</span>
                        <div class="profile-url-display">
                            <span id="myPublicProfileUrl">-</span>
                            <button class="btn-copy" onclick="copyPublicProfileUrl()" title="Copy URL">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Back to Self-Service -->
        <div class="ess-back-link">
            <a href="self-service.html" class="back-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"/>
                    <polyline points="12 19 5 12 12 5"/>
                </svg>
                Back to Self-Service
            </a>
        </div>
    </div>

    <!-- Update Request Modal -->
    <div class="modal-overlay" id="updateRequestModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Request Profile Update</h3>
                <button class="modal-close" onclick="closeUpdateRequestModal()">&times;</button>
            </div>
            <form id="updateRequestForm" onsubmit="submitUpdateRequest(event)">
                <input type="hidden" id="requestType" value="">

                <div class="form-group">
                    <label for="fieldName">Field to Update</label>
                    <select id="fieldName" required>
                        <option value="">Select field...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="currentValue">Current Value</label>
                    <input type="text" id="currentValue" readonly>
                </div>

                <div class="form-group">
                    <label for="requestedValue">Requested Value</label>
                    <input type="text" id="requestedValue" required placeholder="Enter new value">
                </div>

                <div class="form-group">
                    <label for="reason">Reason for Update</label>
                    <textarea id="reason" rows="3" required placeholder="Please provide a reason for this update request"></textarea>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/hrms-signalr.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/my-profile.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</body>
</html>
