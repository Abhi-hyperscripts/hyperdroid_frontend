<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Management - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <!-- Navigation links rendered by Navigation.init() -->
        </div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <span class="current">Leave Management</span>
                </nav>
                <h1>Leave Management</h1>
            </div>
            <div class="header-actions" id="adminActions" style="display: none;">
                <button class="btn btn-primary" onclick="showCreateLeaveTypeModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Leave Type
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="hrms-tabs">
            <button class="tab-btn active" data-tab="my-leave">My Leave</button>
            <button class="tab-btn" data-tab="leave-requests" id="leaveRequestsTab">Leave Requests</button>
            <button class="tab-btn" data-tab="leave-balance">Leave Balance</button>
            <button class="tab-btn" data-tab="leave-types" id="leaveTypesTab">Leave Types</button>
        </div>

        <!-- My Leave Tab -->
        <div class="tab-content active" id="my-leave">
            <div class="filters-bar">
                <div class="filter-group">
                    <select id="myLeaveYear" class="form-select">
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                    </select>
                    <select id="myLeaveStatus" class="form-select">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="showApplyLeaveModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Apply Leave
                </button>
            </div>

            <!-- My Leave Balance Summary -->
            <div class="stats-row" id="myBalanceStats">
                <div class="stat-card">
                    <div class="stat-value" id="annualBalance">0</div>
                    <div class="stat-label">Annual Leave</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sickBalance">0</div>
                    <div class="stat-label">Sick Leave</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="casualBalance">0</div>
                    <div class="stat-label">Casual Leave</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingCount">0</div>
                    <div class="stat-label">Pending Requests</div>
                </div>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Leave Type</th>
                            <th>From Date</th>
                            <th>To Date</th>
                            <th>Days</th>
                            <th>Reason</th>
                            <th>Status</th>
                            <th>Applied On</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="myLeaveTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    <p>No leave requests found</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Leave Requests Tab (For Managers/Admins) -->
        <div class="tab-content" id="leave-requests">
            <div class="filters-bar">
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="requestSearch" placeholder="Search employee...">
                </div>
                <div class="filter-group">
                    <select id="requestStatus" class="form-select">
                        <option value="pending">Pending</option>
                        <option value="">All Status</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <select id="requestDepartment" class="form-select">
                        <option value="">All Departments</option>
                    </select>
                </div>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Leave Type</th>
                            <th>From Date</th>
                            <th>To Date</th>
                            <th>Days</th>
                            <th>Reason</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leaveRequestsTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                    <p>No pending leave requests</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Leave Balance Tab -->
        <div class="tab-content" id="leave-balance">
            <div class="filters-bar">
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="balanceSearch" placeholder="Search employee...">
                </div>
                <div class="filter-group">
                    <select id="balanceYear" class="form-select">
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                    </select>
                    <select id="balanceDepartment" class="form-select">
                        <option value="">All Departments</option>
                    </select>
                </div>
                <button class="btn btn-outline" id="allocateBtn" onclick="showAllocateLeaveModal()" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Allocate Leave
                </button>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Department</th>
                            <th>Annual Leave</th>
                            <th>Sick Leave</th>
                            <th>Casual Leave</th>
                            <th>Comp Off</th>
                            <th>LOP</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leaveBalanceTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                    <p>No leave balance data found</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Leave Types Tab (Admin Only) -->
        <div class="tab-content" id="leave-types">
            <div class="filters-bar">
                <div class="search-box-modern">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="leaveTypeSearch" placeholder="Search leave types...">
                </div>
            </div>

            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Leave Type</th>
                            <th>Code</th>
                            <th>Default Days</th>
                            <th>Carry Forward</th>
                            <th>Max Carry</th>
                            <th>Paid</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leaveTypesTable">
                        <tr class="empty-state">
                            <td colspan="8">
                                <div class="empty-message">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    <p>No leave types configured</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Apply Leave Modal -->
    <div class="modal" id="applyLeaveModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Apply for Leave</h5>
                    <button class="close-btn" onclick="closeModal('applyLeaveModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                <form id="applyLeaveForm">
                    <div class="form-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="leaveType">Leave Type *</label>
                                <select id="leaveType" name="leaveType" class="form-control" required>
                                    <option value="">Select Leave Type</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="fromDate">From Date *</label>
                                <input type="date" id="fromDate" name="fromDate" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="toDate">To Date *</label>
                                <input type="date" id="toDate" name="toDate" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="halfDay">Half Day</label>
                                <select id="halfDay" name="halfDay" class="form-control">
                                    <option value="">No</option>
                                    <option value="first">First Half</option>
                                    <option value="second">Second Half</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="leaveDays">Total Days</label>
                                <input type="text" id="leaveDays" class="form-control" readonly value="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="leaveReason">Reason *</label>
                                <textarea id="leaveReason" name="reason" class="form-control" rows="3" required placeholder="Enter reason for leave..."></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="emergencyContact">Emergency Contact (Optional)</label>
                                <input type="text" id="emergencyContact" name="emergencyContact" class="form-control" placeholder="Phone number during leave">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('applyLeaveModal')">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitLeaveApplication()">Submit Application</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Leave Type Modal -->
    <div class="modal" id="leaveTypeModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="leaveTypeModalTitle">Create Leave Type</h5>
                    <button class="close-btn" onclick="closeModal('leaveTypeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                <form id="leaveTypeForm">
                    <input type="hidden" id="leaveTypeId" name="id">
                    <div class="form-section">
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="typeName">Leave Type Name *</label>
                                <input type="text" id="typeName" name="name" class="form-control" required placeholder="e.g., Annual Leave">
                            </div>
                            <div class="form-group">
                                <label for="typeCode">Code *</label>
                                <input type="text" id="typeCode" name="code" class="form-control" required placeholder="e.g., AL">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="typeDescription">Description</label>
                                <textarea id="typeDescription" name="description" class="form-control" rows="2" placeholder="Brief description of leave type"></textarea>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="defaultDays">Default Days per Year *</label>
                                <input type="number" id="defaultDays" name="defaultDays" class="form-control" required min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label for="maxDaysPerRequest">Max Days per Request</label>
                                <input type="number" id="maxDaysPerRequest" name="maxDaysPerRequest" class="form-control" min="0" value="0">
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="carryForward">Allow Carry Forward</label>
                                <select id="carryForward" name="carryForward" class="form-control">
                                    <option value="false">No</option>
                                    <option value="true">Yes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="maxCarryForward">Max Carry Forward Days</label>
                                <input type="number" id="maxCarryForward" name="maxCarryForward" class="form-control" min="0" value="0">
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="isPaid">Paid Leave</label>
                                <select id="isPaid" name="isPaid" class="form-control">
                                    <option value="true">Yes</option>
                                    <option value="false">No (LOP)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="requiresApproval">Requires Approval</label>
                                <select id="requiresApproval" name="requiresApproval" class="form-control">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="allowHalfDay">Allow Half Day</label>
                                <select id="allowHalfDay" name="allowHalfDay" class="form-control">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="typeIsActive">Status</label>
                                <select id="typeIsActive" name="isActive" class="form-control">
                                    <option value="true">Active</option>
                                    <option value="false">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('leaveTypeModal')">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveLeaveType()">Save Leave Type</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Allocate Leave Modal -->
    <div class="modal" id="allocateLeaveModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Allocate Leave Balance</h5>
                    <button class="close-btn" onclick="closeModal('allocateLeaveModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                <form id="allocateLeaveForm">
                    <div class="form-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="allocEmployee">Employee *</label>
                                <select id="allocEmployee" name="employeeId" class="form-control" required>
                                    <option value="">Select Employee</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="allocLeaveType">Leave Type *</label>
                                <select id="allocLeaveType" name="leaveTypeId" class="form-control" required>
                                    <option value="">Select Leave Type</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="allocYear">Year *</label>
                                <select id="allocYear" name="year" class="form-control" required>
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="allocDays">Days to Allocate *</label>
                                <input type="number" id="allocDays" name="days" class="form-control" required min="0" step="0.5">
                            </div>
                            <div class="form-group">
                                <label for="allocCarryForward">Carry Forward Days</label>
                                <input type="number" id="allocCarryForward" name="carryForward" class="form-control" min="0" step="0.5" value="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="allocNotes">Notes</label>
                                <textarea id="allocNotes" name="notes" class="form-control" rows="2" placeholder="Optional notes about this allocation"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('allocateLeaveModal')">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveLeaveAllocation()">Allocate Leave</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Approve/Reject Leave Modal -->
    <div class="modal" id="leaveActionModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="leaveActionTitle">Approve Leave</h5>
                    <button class="close-btn" onclick="closeModal('leaveActionModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="leaveRequestId">
                    <input type="hidden" id="leaveAction">
                    <div class="leave-request-summary" id="leaveRequestSummary">
                        <!-- Filled dynamically -->
                    </div>
                    <div class="form-group">
                        <label for="actionComments">Comments</label>
                        <textarea id="actionComments" class="form-control" rows="3" placeholder="Optional comments..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('leaveActionModal')">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmActionBtn" onclick="confirmLeaveAction()">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Leave Details Modal -->
    <div class="modal" id="viewLeaveModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Leave Request Details</h5>
                    <button class="close-btn" onclick="closeModal('viewLeaveModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="leave-details" id="leaveDetails">
                        <!-- Filled dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeModal('viewLeaveModal')">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/leave.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</body>
</html>
