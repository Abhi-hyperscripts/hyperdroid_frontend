<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Management - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-payroll.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/searchable-dropdown.css?v=' + CACHE_VERSION + '">');</script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script>document.write('<link rel="stylesheet" href="../../css/flatpickr-custom.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/brand_logo.png" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu"></div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <span class="current">Leave Management</span>
                </nav>
                <div class="hrms-header-row">
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation menu">
                        <span class="hamburger-icon">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </span>
                        <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <path d="M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h1>Leave Management</h1>
                </div>
                <div class="active-tab-title" id="activeTabTitle">
                    <span class="tab-indicator"></span>
                    <span id="activeTabName">Leave Requests</span>
                </div>
            </div>
        </div>

        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <div class="organization-layout">
            <aside class="organization-sidebar gradient-bg-ambient" id="organizationSidebar">
                <div class="sidebar-header">
                    <h3>Leave</h3>
                </div>
                <nav class="sidebar-nav">
                    <!-- Team Approvals Section -->
                    <div class="nav-group" data-group="approvals">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                                Team Approvals
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn active" data-tab="leave-requests" id="leaveRequestsTabBtn">
                                <span class="nav-number">1</span><span class="nav-label">Leave Requests</span>
                            </button>
                            <button class="sidebar-btn" data-tab="leave-balance" id="leaveBalanceTabBtn">
                                <span class="nav-number">2</span><span class="nav-label">Leave Balances</span>
                            </button>
                            <button class="sidebar-btn" data-tab="team-calendar" id="teamCalendarTabBtn">
                                <span class="nav-number">3</span><span class="nav-label">Team Calendar</span>
                            </button>
                        </div>
                    </div>

                    <!-- Configuration Section (HR Admin Only) -->
                    <div class="nav-group admin-only" data-group="configuration" id="configNavGroup" style="display: none;">
                        <div class="nav-group-header">
                            <span class="nav-group-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                </svg>
                                Configuration
                            </span>
                            <span class="chevron">▼</span>
                        </div>
                        <div class="nav-group-items">
                            <button class="sidebar-btn" data-tab="leave-types" id="leaveTypesTabBtn">
                                <span class="nav-number">4</span><span class="nav-label">Leave Types</span>
                            </button>
                        </div>
                    </div>
                </nav>
            </aside>

            <main class="organization-content">
                <!-- Leave Requests Tab (For Managers/Admins) - Default Active -->
                <div class="tab-content active" id="leave-requests">
                    <div class="filters-bar">
                        <div class="search-box-modern">
                            <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <input type="text" id="requestSearch" placeholder="Search employee...">
                        </div>
                        <div class="filter-group">
                            <select id="requestOffice" class="form-select">
                                <option value="">All Offices</option>
                            </select>
                            <select id="requestStatus" class="form-select">
                                <option value="pending">Pending</option>
                                <option value="">All Status</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <select id="requestDepartment" class="form-select">
                                <option value="">All Departments</option>
                            </select>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Leave Type</th>
                                    <th>From Date</th>
                                    <th>To Date</th>
                                    <th>Days</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="leaveRequestsTable">
                                <tr class="empty-state">
                                    <td colspan="8">
                                        <div class="empty-message">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                <polyline points="14 2 14 8 20 8"></polyline>
                                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                            </svg>
                                            <p>No pending leave requests</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="leaveRequestsPagination" class="pagination-container"></div>
                    </div>
                </div>

                <!-- Leave Balances Tab -->
                <div class="tab-content" id="leave-balance">
                    <div class="filters-bar">
                        <div class="search-box-modern">
                            <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <input type="text" id="balanceSearch" placeholder="Search employee...">
                        </div>
                        <div class="filter-group">
                            <select id="balanceOffice" class="form-select">
                                <option value="">All Offices</option>
                            </select>
                            <select id="balanceYear" class="form-select">
                                <!-- Years populated dynamically by JS -->
                            </select>
                            <select id="balanceDepartment" class="form-select">
                                <option value="">All Departments</option>
                            </select>
                        </div>
                        <button class="btn btn-outline" id="allocateBtn" onclick="showAllocateLeaveModal()" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Allocate Leave
                        </button>
                        <button class="btn btn-primary" onclick="showEncashLeaveModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                            Encash Leave
                        </button>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Department</th>
                                    <th>Annual Leave</th>
                                    <th>Sick Leave</th>
                                    <th>Casual Leave</th>
                                    <th>Comp Off</th>
                                    <th>LOP</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="leaveBalanceTable">
                                <tr class="empty-state">
                                    <td colspan="8">
                                        <div class="empty-message">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="9" cy="7" r="4"></circle>
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                            </svg>
                                            <p>No leave balance data found</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="leaveBalancePagination" class="pagination-container"></div>
                    </div>
                </div>

                <!-- Team Calendar Tab -->
                <div class="tab-content" id="team-calendar">
                    <div class="filters-bar">
                        <div class="filter-group">
                            <select id="calendarOffice" class="form-select">
                                <option value="">All Offices</option>
                            </select>
                            <input type="month" id="calendarMonth" class="form-control">
                            <select id="calendarDepartment" class="form-select">
                                <option value="">All Departments</option>
                            </select>
                        </div>
                        <button class="btn btn-outline" onclick="loadTeamCalendar()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>

                    <div class="calendar-container">
                        <div class="calendar-header" id="calendarHeader"></div>
                        <div class="calendar-grid" id="calendarGrid"></div>
                    </div>

                    <div class="calendar-legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: var(--color-success-light);"></span>
                            <span>Approved Leave</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: var(--color-warning-light);"></span>
                            <span>Pending Leave</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: var(--color-danger-light);"></span>
                            <span>Rejected</span>
                        </div>
                    </div>
                </div>

                <!-- Leave Types Tab (Admin Only) -->
                <div class="tab-content" id="leave-types">
                    <div class="filters-bar">
                        <div class="filter-group">
                            <div id="leaveTypeCountryFilterContainer"></div>
                        </div>
                        <div class="search-box-modern">
                            <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <input type="text" id="leaveTypeSearch" placeholder="Search leave types...">
                        </div>
                        <button class="btn btn-primary" onclick="showCreateLeaveTypeModal()" id="addLeaveTypeBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Leave Type
                        </button>
                    </div>

                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Leave Type</th>
                                    <th>Code</th>
                                    <th>Country</th>
                                    <th>Default Days</th>
                                    <th>Carry Forward</th>
                                    <th>Max Carry</th>
                                    <th>Paid</th>
                                    <th>Prorated</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="leaveTypesTable">
                                <tr class="empty-state">
                                    <td colspan="10">
                                        <div class="empty-message">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                                <line x1="3" y1="10" x2="21" y2="10"></line>
                                            </svg>
                                            <p>No leave types configured</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="leaveTypesPagination" class="pagination-container"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create/Edit Leave Type Modal -->
    <div class="modal" id="leaveTypeModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="leaveTypeModalTitle">Create Leave Type</h5>
                    <button class="close-btn" onclick="closeModal('leaveTypeModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="leaveTypeForm">
                        <input type="hidden" id="leaveTypeId" name="id">
                        <div class="form-section">
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="typeName">Leave Type Name *</label>
                                    <input type="text" id="typeName" name="name" class="form-control" required placeholder="e.g., Annual Leave">
                                </div>
                                <div class="form-group">
                                    <label for="typeCode">Code *</label>
                                    <input type="text" id="typeCode" name="code" class="form-control" required placeholder="e.g., AL">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="typeCountry">Country *</label>
                                    <div id="typeCountryContainer"></div>
                                    <small class="form-text text-muted">Leave types apply only to employees in offices of the selected country.</small>
                                </div>
                                <div class="form-group">
                                    <label for="typeDescription">Description</label>
                                    <textarea id="typeDescription" name="description" class="form-control" rows="2" placeholder="Brief description of leave type"></textarea>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="defaultDays">Default Days per Year *</label>
                                    <input type="number" id="defaultDays" name="defaultDays" class="form-control" required min="0" value="0">
                                </div>
                                <div class="form-group">
                                    <label for="maxDaysPerRequest">Max Days per Request</label>
                                    <input type="number" id="maxDaysPerRequest" name="maxDaysPerRequest" class="form-control" min="0" value="0">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="carryForward">Allow Carry Forward</label>
                                    <select id="carryForward" name="carryForward" class="form-control">
                                        <option value="false">No</option>
                                        <option value="true">Yes</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="maxCarryForward">Max Carry Forward Days</label>
                                    <input type="number" id="maxCarryForward" name="maxCarryForward" class="form-control" min="0" value="0">
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="isPaid">Paid Leave</label>
                                    <select id="isPaid" name="isPaid" class="form-control">
                                        <option value="true">Yes</option>
                                        <option value="false">No (LOP)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="requiresApproval">Requires Approval</label>
                                    <select id="requiresApproval" name="requiresApproval" class="form-control">
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="allowHalfDay">Allow Half Day</label>
                                    <select id="allowHalfDay" name="allowHalfDay" class="form-control">
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="prorateOnJoining">Prorate on Joining</label>
                                    <select id="prorateOnJoining" name="prorateOnJoining" class="form-control">
                                        <option value="false">No</option>
                                        <option value="true">Yes</option>
                                    </select>
                                    <small class="form-text text-muted">If Yes, mid-year joiners get prorated leaves based on weeks remaining</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="typeIsActive">Status</label>
                                    <select id="typeIsActive" name="isActive" class="form-control">
                                        <option value="true">Active</option>
                                        <option value="false">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveLeaveType()">Save Leave Type</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Allocate Leave Modal -->
    <div class="modal" id="allocateLeaveModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Allocate Leave Balance</h5>
                    <button class="close-btn" onclick="closeModal('allocateLeaveModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="allocateLeaveForm">
                        <div class="form-section">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Employee <span class="required">*</span></label>
                                    <input type="hidden" id="allocEmployee" name="employeeId" required>
                                    <div class="employee-search-dropdown" id="employeeSearchDropdown">
                                        <div class="employee-search-selected" id="employeeSearchSelected" onclick="toggleEmployeeDropdown()">
                                            <span class="selected-employee-text">Select an employee...</span>
                                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </div>
                                        <div class="employee-search-panel" id="employeeSearchPanel">
                                            <div class="search-box-modern">
                                                <svg class="search-icon" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="11" cy="11" r="8"/>
                                                    <path d="m21 21-4.35-4.35"/>
                                                </svg>
                                                <input type="text" id="employeeSearchInput" placeholder="Search by name or email..." oninput="filterEmployeeList()">
                                                <button type="button" class="clear-search-btn" id="clearEmployeeSearchBtn" style="display: none;" onclick="clearEmployeeSearch()">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="employee-list-header">
                                                <span id="employeeCountDisplay">0 employees</span>
                                            </div>
                                            <div id="employeeSearchList" class="employees-list-modern">
                                                <p class="text-muted" style="text-align: center; font-size: 0.75rem; padding: 20px;">Loading employees...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="allocLeaveType">Leave Type *</label>
                                    <select id="allocLeaveType" name="leaveTypeId" class="form-control" required>
                                        <option value="">Select Leave Type</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="allocYear">Year *</label>
                                    <select id="allocYear" name="year" class="form-control" required>
                                        <!-- Years populated dynamically by JS -->
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="allocDays">Days to Allocate *</label>
                                    <input type="number" id="allocDays" name="days" class="form-control" required min="0" step="0.5">
                                </div>
                                <div class="form-group">
                                    <label for="allocCarryForward">Carry Forward Days</label>
                                    <input type="number" id="allocCarryForward" name="carryForward" class="form-control" min="0" step="0.5" value="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="allocNotes">Notes</label>
                                    <textarea id="allocNotes" name="notes" class="form-control" rows="2" placeholder="Optional notes about this allocation"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveLeaveAllocation()">Allocate Leave</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Approve/Reject Leave Modal -->
    <div class="modal" id="leaveActionModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="leaveActionTitle">Approve Leave</h5>
                    <button class="close-btn" onclick="closeModal('leaveActionModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="leaveRequestId">
                    <input type="hidden" id="leaveAction">
                    <div class="leave-request-summary" id="leaveRequestSummary"></div>
                    <div class="form-group">
                        <label for="actionComments">Comments</label>
                        <textarea id="actionComments" class="form-control" rows="3" placeholder="Optional comments..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="confirmActionBtn" onclick="confirmLeaveAction()">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Leave Details Modal -->
    <div class="modal" id="viewLeaveModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Leave Request Details</h5>
                    <button class="close-btn" onclick="closeModal('viewLeaveModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="leave-details" id="leaveDetails"></div>
                </div>
                <div class="modal-footer" id="leaveDetailsFooter" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Leave Calculation Breakdown Modal -->
    <div class="modal" id="leaveCalculationModal">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Leave Calculation Breakdown</h5>
                    <button class="close-btn" onclick="closeModal('leaveCalculationModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="calculation-summary">
                        <div class="calc-stat">
                            <span class="calc-value" id="calcTotalDays">0</span>
                            <span class="calc-label">Total Days</span>
                        </div>
                        <div class="calc-stat working">
                            <span class="calc-value" id="calcWorkingDays">0</span>
                            <span class="calc-label">Working Days</span>
                        </div>
                        <div class="calc-stat weekend">
                            <span class="calc-value" id="calcWeekendDays">0</span>
                            <span class="calc-label">Weekend Days</span>
                        </div>
                        <div class="calc-stat holiday">
                            <span class="calc-value" id="calcHolidayDays">0</span>
                            <span class="calc-label">Holiday Days</span>
                        </div>
                    </div>
                    <div id="multiLocationIndicator" class="multi-location-alert" style="display:none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <span>This leave spans multiple offices with different weekend policies</span>
                    </div>
                    <div class="calculation-calendar" id="calculationCalendar"></div>
                    <div class="calculation-legend">
                        <span class="legend-item"><span class="dot working"></span> Working Day (Counted)</span>
                        <span class="legend-item"><span class="dot weekend"></span> Weekend (Not Counted)</span>
                        <span class="legend-item"><span class="dot holiday"></span> Holiday (Not Counted)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Employee Balance Modal -->
    <div class="modal" id="viewEmployeeBalanceModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Employee Leave Balance</h5>
                    <button class="close-btn" onclick="closeModal('viewEmployeeBalanceModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="employeeBalanceDetails"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Encash Leave Modal -->
    <div class="modal" id="encashLeaveModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Encash Leave</h5>
                    <button class="close-btn" onclick="closeModal('encashLeaveModal')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="encashLeaveForm">
                        <div class="encash-balance-info" id="encashBalanceInfo"></div>
                        <div class="form-section">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="encashLeaveType">Leave Type *</label>
                                    <select id="encashLeaveType" name="leaveTypeId" class="form-control" required onchange="updateEncashPreview()">
                                        <option value="">Select Leave Type</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row two-col">
                                <div class="form-group">
                                    <label for="encashDays">Days to Encash *</label>
                                    <input type="number" id="encashDays" name="days" class="form-control" required min="0.5" step="0.5" oninput="updateEncashPreview()">
                                    <small class="form-text text-muted" id="encashAvailableDays">Available: 0 days</small>
                                </div>
                                <div class="form-group">
                                    <label>Estimated Amount</label>
                                    <div class="encash-amount-preview" id="encashAmountPreview">--</div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="encashReason">Reason</label>
                                    <textarea id="encashReason" name="reason" class="form-control" rows="2" placeholder="Reason for encashment (optional)"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="submitLeaveEncashment()">Submit Encashment</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>document.write('<script src="../../js/hrms/hrms-datepicker.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/roleUtils.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/hrms-signalr.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/office-selection.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/searchable-dropdown.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/table-pagination.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/hrms/leave.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</body>
</html>
