<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cookie Consent & Analytics -->
    <script src="/js/cookie-consent.js" defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Employee Import - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <!-- SheetJS for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/brand_logo.png" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <!-- Navigation links rendered by Navigation.init() -->
        </div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <a href="employees.html">Employees</a>
                    <span class="separator">/</span>
                    <span class="current">Bulk Import</span>
                </nav>
                <div class="hrms-header-row">
                    <h1>Bulk Employee Import</h1>
                </div>
                <p class="bulk-import-subtitle">
                    Import multiple employees from Excel. Creates user accounts and employee profiles in one operation.
                </p>
            </div>
        </div>

        <!-- Main Content -->
        <main class="bulk-import-main">

            <!-- Step Indicator - Redesigned -->
            <div class="bulk-import-stepper" id="importSteps">
                <div class="stepper-track"></div>
                <div class="stepper-step active" data-step="1">
                    <div class="stepper-step-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </div>
                    <div class="stepper-step-label">Upload</div>
                </div>
                <div class="stepper-step" data-step="2">
                    <div class="stepper-step-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                    </div>
                    <div class="stepper-step-label">Validate</div>
                </div>
                <div class="stepper-step" data-step="3">
                    <div class="stepper-step-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
                        </svg>
                    </div>
                    <div class="stepper-step-label">Import</div>
                </div>
                <div class="stepper-step" data-step="4">
                    <div class="stepper-step-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                    </div>
                    <div class="stepper-step-label">Results</div>
                </div>
            </div>

            <!-- Step 1: Upload -->
            <div class="bulk-import-section" id="uploadSection">
                <div class="bulk-import-card">
                    <div class="bulk-import-card-header">
                        <h3>Upload Excel File</h3>
                        <p>Download the template, fill in employee data, then upload the completed file.</p>
                    </div>

                    <div class="bulk-import-template-section">
                        <div class="template-info">
                            <div class="template-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                </svg>
                            </div>
                            <div class="template-text">
                                <span class="template-label">Excel Template</span>
                                <span class="template-hint">Contains all required columns with sample data</span>
                            </div>
                        </div>
                        <button class="btn-template-download" onclick="downloadTemplate()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Download Template
                        </button>
                    </div>

                    <div class="bulk-import-dropzone" id="dropZone" onclick="document.getElementById('fileInput').click()">
                        <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleFileSelect(event)">
                        <div class="dropzone-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                        </div>
                        <div class="dropzone-text">
                            <span class="dropzone-title">Drag & drop your Excel file here</span>
                            <span class="dropzone-subtitle">or click to browse</span>
                        </div>
                        <div class="dropzone-hint">
                            <span>Supports</span>
                            <span class="file-type">.xlsx</span>
                            <span class="file-type">.xls</span>
                            <span class="file-type">.csv</span>
                            <span class="separator">|</span>
                            <span>Max 100 employees</span>
                        </div>
                    </div>

                    <div class="bulk-import-selected-file" id="selectedFile" style="display: none;">
                        <div class="selected-file-info">
                            <div class="selected-file-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                </svg>
                            </div>
                            <span class="selected-file-name" id="fileName"></span>
                        </div>
                        <button class="btn-remove-file" onclick="clearFile()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                            Remove
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Preview & Validate -->
            <div class="bulk-import-section" id="previewSection" style="display: none;">
                <div class="bulk-import-card bulk-import-card-full">
                    <div class="bulk-import-card-header">
                        <div class="header-left">
                            <h3>Preview & Validate</h3>
                            <p>Review data and fix any errors before importing.</p>
                        </div>
                        <div class="preview-stats-bar">
                            <div class="stat-item stat-total">
                                <span class="stat-value" id="totalRows">0</span>
                                <span class="stat-label">Total Rows</span>
                            </div>
                            <div class="stat-item stat-valid">
                                <span class="stat-value" id="validRows">0</span>
                                <span class="stat-label">Valid</span>
                            </div>
                            <div class="stat-item stat-error">
                                <span class="stat-value" id="invalidRows">0</span>
                                <span class="stat-label">Errors</span>
                            </div>
                        </div>
                    </div>

                    <!-- Global Errors -->
                    <div class="bulk-import-global-errors" id="globalErrors" style="display: none;">
                        <div class="global-error-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                        </div>
                        <div class="global-error-content">
                            <strong>Critical Errors Found</strong>
                            <ul id="globalErrorList"></ul>
                        </div>
                    </div>

                    <!-- Preview Table with Horizontal Scroll -->
                    <div class="bulk-import-table-wrapper">
                        <div class="bulk-import-table-scroll">
                            <table class="bulk-import-table" id="previewTable">
                                <thead>
                                    <tr>
                                        <th class="col-row">#</th>
                                        <th class="col-status">Status</th>
                                        <th class="col-email">Email</th>
                                        <th class="col-name">First Name</th>
                                        <th class="col-name">Last Name</th>
                                        <th class="col-code">Employee Code</th>
                                        <th class="col-office">Office</th>
                                        <th class="col-dept">Department</th>
                                        <th class="col-designation">Designation</th>
                                        <th class="col-shift">Shift</th>
                                        <th class="col-ctc">Annual CTC</th>
                                        <th class="col-date">Joining Date</th>
                                        <th class="col-date">Birth Date</th>
                                        <th class="col-phone">Work Phone</th>
                                        <th class="col-messages">Messages</th>
                                    </tr>
                                </thead>
                                <tbody id="previewTableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="bulk-import-actions">
                        <button class="btn-secondary" onclick="goToStep(1)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back to Upload
                        </button>
                        <button class="btn-primary" id="startImportBtn" onclick="startImport()" disabled>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12l7 7 7-7"/>
                            </svg>
                            Start Import
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Import Progress -->
            <div class="bulk-import-section" id="progressSection" style="display: none;">
                <div class="bulk-import-card">
                    <div class="bulk-import-card-header">
                        <h3>Import in Progress</h3>
                        <p>Creating user accounts and employee profiles...</p>
                    </div>

                    <!-- Phase 1: User Creation -->
                    <div class="import-phase" id="phase1">
                        <div class="phase-header">
                            <div class="phase-info">
                                <span class="phase-badge">Phase 1</span>
                                <span class="phase-title">Creating User Accounts</span>
                            </div>
                            <span class="phase-status" id="phase1Status">Waiting...</span>
                        </div>
                        <div class="phase-progress">
                            <div class="phase-progress-bar" id="phase1Progress" style="width: 0%;"></div>
                        </div>
                        <div class="phase-details" id="phase1Details">
                            <span class="detail-success"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg> 0 created</span>
                            <span class="detail-failed"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg> 0 failed</span>
                        </div>
                    </div>

                    <!-- Phase 2: Employee Creation -->
                    <div class="import-phase phase-pending" id="phase2">
                        <div class="phase-header">
                            <div class="phase-info">
                                <span class="phase-badge">Phase 2</span>
                                <span class="phase-title">Creating Employee Profiles</span>
                            </div>
                            <span class="phase-status" id="phase2Status">Waiting...</span>
                        </div>
                        <div class="phase-progress">
                            <div class="phase-progress-bar" id="phase2Progress" style="width: 0%;"></div>
                        </div>
                        <div class="phase-details" id="phase2Details">
                            <span class="detail-success"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg> 0 created</span>
                            <span class="detail-failed"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg> 0 failed</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Results -->
            <div class="bulk-import-section" id="resultsSection" style="display: none;">
                <div class="bulk-import-card bulk-import-card-full">
                    <div class="bulk-import-card-header">
                        <div class="header-left">
                            <h3>Import Complete</h3>
                            <p>Review the results below.</p>
                        </div>
                        <div class="result-summary" id="resultSummary">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Results Table -->
                    <div class="bulk-import-table-wrapper">
                        <div class="bulk-import-table-scroll">
                            <table class="bulk-import-table" id="resultsTable">
                                <thead>
                                    <tr>
                                        <th class="col-row">#</th>
                                        <th class="col-status">Status</th>
                                        <th class="col-email">Email</th>
                                        <th class="col-name">Name</th>
                                        <th class="col-code">Employee Code</th>
                                        <th class="col-check">User Created</th>
                                        <th class="col-check">Profile Created</th>
                                        <th class="col-password">Generated Password</th>
                                        <th class="col-messages">Errors</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="bulk-import-actions">
                        <button class="btn-secondary" onclick="exportResults()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Export Results
                        </button>
                        <button class="btn-secondary" onclick="startOver()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                            </svg>
                            Import More
                        </button>
                        <a href="employees.html" class="btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                            </svg>
                            View Employees
                        </a>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script>document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/hrms/bulk-import.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</body>
</html>
