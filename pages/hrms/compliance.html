<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statutory Compliance - HRMS | HyperDroid</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-payroll.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/hrms-compliance.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperDroid Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu"></div>
    </nav>

    <div class="hrms-container">
        <div class="hrms-header">
            <div class="header-content">
                <nav class="breadcrumb-nav">
                    <a href="dashboard.html">HRMS</a>
                    <span class="separator">/</span>
                    <span class="current">Statutory Compliance</span>
                </nav>
                <div class="hrms-header-row">
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle navigation menu">
                        <span class="hamburger-icon">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </span>
                        <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <path d="M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h1>Statutory Compliance</h1>
                </div>
                <div class="active-tab-title" id="activeTabTitle">
                    <span class="tab-indicator"></span>
                    <span id="activeTabName">Company Registration</span>
                </div>
            </div>
        </div>

        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <div class="organization-layout">
            <aside class="organization-sidebar" id="organizationSidebar">
                <div class="sidebar-header">
                    <h3>Compliance</h3>
                </div>
                <nav class="sidebar-nav">
                    <button class="sidebar-btn active" data-tab="company-info" id="companyInfoBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 21h18"></path>
                            <path d="M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16"></path>
                            <path d="M9 9h1"></path>
                            <path d="M9 13h1"></path>
                            <path d="M14 9h1"></path>
                            <path d="M14 13h1"></path>
                        </svg>
                        <span class="nav-label">Company Registration</span>
                    </button>
                    <button class="sidebar-btn" data-tab="country-configs" id="countryConfigsBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="2" y1="12" x2="22" y2="12"></line>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        </svg>
                        <span class="nav-label">Country Configs</span>
                    </button>
                </nav>
            </aside>

            <main class="organization-content">
                <!-- Country Configurations Tab -->
                <div class="tab-content" id="country-configs">
                    <div class="country-configs-section">
                        <div class="configs-header">
                            <div class="configs-header-left">
                                <h2>Country Configurations</h2>
                                <p class="configs-subtitle">Upload statutory compliance rules for each country your organization operates in. The JSON configuration defines PF, ESI, PT, income tax slabs, and other statutory rules.</p>
                            </div>
                            <div class="configs-header-actions">
                                <button type="button" class="btn btn-outline" onclick="refreshCountryConfigs()" title="Refresh configurations">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M23 4v6h-6"></path>
                                        <path d="M1 20v-6h6"></path>
                                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                                    </svg>
                                    Refresh
                                </button>
                                <button type="button" class="btn btn-primary" onclick="openConfigUploadModal()" id="uploadConfigBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                    Upload Config
                                </button>
                            </div>
                        </div>

                        <!-- Country Config Cards -->
                        <div class="country-configs-grid" id="countryConfigsGrid">
                            <!-- Will be populated by JavaScript -->
                            <div class="configs-empty-state" id="configsEmptyState">
                                <div class="empty-icon">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                </div>
                                <h3>No Configurations Yet</h3>
                                <p>Upload your first country statutory configuration to get started. This will automatically create country and state records.</p>
                                <button type="button" class="btn btn-primary" onclick="openConfigUploadModal()">
                                    Upload Configuration
                                </button>
                            </div>
                        </div>

                        <!-- Info Box -->
                        <div class="info-box" style="margin-top: 24px;">
                            <div class="info-box-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <h4>How Country Configuration Works</h4>
                                <ul>
                                    <li><strong>Upload JSON:</strong> Upload a country-specific statutory rules JSON file (e.g., India config with PF, ESI, PT rates)</li>
                                    <li><strong>Auto-Creates Records:</strong> Countries and states are automatically created from the config</li>
                                    <li><strong>Payroll Uses Config:</strong> Salary processing engine reads these rules for statutory deduction calculations</li>
                                    <li><strong>Version Control:</strong> Each upload creates a new version; you can view history and download previous configs</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Company Info Tab (Default) -->
                <div class="tab-content active" id="company-info">
                    <div class="compliance-section">
                        <div class="section-header">
                            <div class="section-title-group">
                                <h2>Company Registration Details</h2>
                                <p class="section-subtitle">Configure your company's statutory registration information required for compliance filings.</p>
                            </div>
                        </div>

                        <form id="companyInfoForm" onsubmit="handleCompanyInfoSubmit(event)">
                            <div class="form-sections">
                                <!-- Country Info (Read-only from config) -->
                                <div class="form-section" id="countryInfoSection">
                                    <h3>Country</h3>
                                    <div id="countryInfoDisplay" class="country-info-display">
                                        <p class="text-muted">No country configuration uploaded yet. Please upload a country config first.</p>
                                    </div>
                                </div>

                                <!-- Basic Company Info -->
                                <div class="form-section">
                                    <h3>Basic Information</h3>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="companyName">Company Name *</label>
                                            <input type="text" id="companyName" name="companyName" class="form-control" placeholder="Enter company name" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="companyPan">Company PAN</label>
                                            <input type="text" id="companyPan" name="companyPan" class="form-control" placeholder="e.g., AAACT1234C">
                                        </div>
                                        <div class="form-group">
                                            <label for="companyTan">TAN Number</label>
                                            <input type="text" id="companyTan" name="companyTan" class="form-control" placeholder="e.g., BLRT12345F">
                                        </div>
                                        <div class="form-group">
                                            <label for="companyGstin">Tax Registration Number</label>
                                            <input type="text" id="companyGstin" name="companyGstin" class="form-control" placeholder="GST/VAT/Tax ID">
                                        </div>
                                    </div>
                                </div>

                                <!-- Statutory Registrations -->
                                <div class="form-section">
                                    <h3>Statutory Registrations</h3>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="pfEstablishmentId">Social Security / PF Establishment ID</label>
                                            <input type="text" id="pfEstablishmentId" name="pfEstablishmentId" class="form-control" placeholder="Provident Fund establishment code">
                                        </div>
                                        <div class="form-group">
                                            <label for="esiEmployerCode">Insurance / ESI Employer Code</label>
                                            <input type="text" id="esiEmployerCode" name="esiEmployerCode" class="form-control" placeholder="Insurance employer code">
                                        </div>
                                        <div class="form-group">
                                            <label for="ptRegistration">Professional Tax Registration</label>
                                            <input type="text" id="ptRegistration" name="ptRegistration" class="form-control" placeholder="PT registration number">
                                        </div>
                                    </div>
                                </div>

                                <!-- Bank Details -->
                                <div class="form-section">
                                    <h3>Bank Details (for statutory payments)</h3>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="bankName">Bank Name</label>
                                            <input type="text" id="bankName" name="bankName" class="form-control" placeholder="e.g., State Bank of India">
                                        </div>
                                        <div class="form-group">
                                            <label for="bankAccount">Account Number</label>
                                            <input type="text" id="bankAccount" name="bankAccount" class="form-control" placeholder="Bank account number">
                                        </div>
                                        <div class="form-group">
                                            <label for="bankIfsc">Bank Code (IFSC/SWIFT)</label>
                                            <input type="text" id="bankIfsc" name="bankIfsc" class="form-control" placeholder="e.g., SBIN0001234">
                                        </div>
                                    </div>
                                </div>

                                <!-- Authorized Signatory -->
                                <div class="form-section">
                                    <h3>Authorized Signatory</h3>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="signatoryName">Name</label>
                                            <input type="text" id="signatoryName" name="signatoryName" class="form-control" placeholder="Full name">
                                        </div>
                                        <div class="form-group">
                                            <label for="signatoryDesignation">Designation</label>
                                            <input type="text" id="signatoryDesignation" name="signatoryDesignation" class="form-control" placeholder="e.g., HR Manager">
                                        </div>
                                        <div class="form-group">
                                            <label for="signatoryPan">PAN/Tax ID</label>
                                            <input type="text" id="signatoryPan" name="signatoryPan" class="form-control" placeholder="Signatory's tax ID">
                                        </div>
                                    </div>
                                </div>

                                <!-- Registered Address -->
                                <div class="form-section">
                                    <h3>Registered Address</h3>
                                    <div class="form-group full-width">
                                        <label for="registeredAddress">Address</label>
                                        <textarea id="registeredAddress" name="registeredAddress" class="form-control" rows="3" placeholder="Complete registered address"></textarea>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg" id="saveCompanyInfoBtn">
                                <span class="btn-text">Save Company Information</span>
                                <span class="btn-spinner" style="display: none;">
                                    <svg class="spinner" width="20" height="20" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" opacity="0.25"/>
                                        <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round"/>
                                    </svg>
                                </span>
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Config Upload Modal -->
                <div class="modal" id="configUploadModal">
                    <div class="modal-content modal-lg">
                        <div class="modal-header">
                            <h2>Upload Statutory Configuration</h2>
                            <button type="button" class="modal-close" onclick="closeConfigUploadModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <!-- Upload Zone -->
                            <div class="upload-zone" id="configUploadZone">
                                <input type="file" id="configFileInput" accept=".json" style="display: none;" onchange="handleConfigFileSelect(event)">
                                <div class="upload-zone-content" onclick="document.getElementById('configFileInput').click()">
                                    <div class="upload-icon">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="17 8 12 3 7 8"></polyline>
                                            <line x1="12" y1="3" x2="12" y2="15"></line>
                                        </svg>
                                    </div>
                                    <p class="upload-text">Drop your JSON configuration file here or <span class="upload-link">browse</span></p>
                                    <p class="upload-hint">Supports country-specific statutory configs (India, USA, UAE, etc.)</p>
                                </div>
                            </div>

                            <!-- File Selected State -->
                            <div class="selected-file-info" id="selectedFileInfo" style="display: none;">
                                <div class="file-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                </div>
                                <div class="file-details">
                                    <span class="file-name" id="selectedFileName">-</span>
                                    <span class="file-size" id="selectedFileSize">-</span>
                                </div>
                                <button type="button" class="btn-icon-sm" onclick="clearSelectedFile()" title="Remove file">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>

                            <!-- Validation Status -->
                            <div class="validation-status" id="validationStatus" style="display: none;">
                                <div class="validation-header">
                                    <span class="validation-icon" id="validationIcon"></span>
                                    <span class="validation-title" id="validationTitle">Validating...</span>
                                </div>
                                <div class="validation-details" id="validationDetails"></div>
                            </div>

                            <!-- Validation Errors -->
                            <div class="validation-errors" id="validationErrors" style="display: none;">
                                <div class="errors-header">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="15" y1="9" x2="9" y2="15"></line>
                                        <line x1="9" y1="9" x2="15" y2="15"></line>
                                    </svg>
                                    <span>Validation Errors</span>
                                </div>
                                <div class="errors-list" id="errorsList"></div>
                            </div>

                            <!-- Config Preview -->
                            <div class="config-preview" id="configPreview" style="display: none;">
                                <div class="preview-header">
                                    <h3>Configuration Preview</h3>
                                </div>
                                <div class="preview-content" id="configPreviewContent"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeConfigUploadModal()">Cancel</button>
                            <button type="button" class="btn btn-primary" id="uploadConfirmBtn" onclick="confirmConfigUpload()" disabled>
                                Upload Configuration
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Config View Modal -->
                <div class="modal" id="configViewModal">
                    <div class="modal-content modal-xl">
                        <div class="modal-header">
                            <div class="modal-title-row">
                                <h2 id="configViewTitle">Configuration Details</h2>
                                <span class="config-version-badge" id="configVersionBadge"></span>
                            </div>
                            <button type="button" class="modal-close" onclick="closeConfigViewModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="config-tabs" id="configTabs">
                                <!-- Tabs will be generated dynamically based on config sections -->
                            </div>
                            <div class="config-content" id="configContent">
                                <!-- Config data will be rendered here -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeConfigViewModal()">Close</button>
                            <button type="button" class="btn btn-outline" onclick="downloadCurrentConfig()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Download JSON
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Loading...</p>
                </div>

                <!-- Toast Notification -->
                <div class="toast-container" id="toastContainer"></div>
            </main>
        </div>
    </div>

    <!-- Scripts -->
    <script>document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/hrms/roleUtils.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/hrms/hrms-signalr.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/hrms/compliance.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</body>
</html>
