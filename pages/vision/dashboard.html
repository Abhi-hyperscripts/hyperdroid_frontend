<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - HyperVision</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script>window.CACHE_VERSION = Date.now();</script>
    <script>document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
    <script>document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperVision Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <!-- Navigation links rendered by Navigation.init() -->
        </div>
    </nav>

    <div class="dashboard-content">
        <!-- Unified Dashboard Header -->
        <div class="dashboard-header">
            <div class="dashboard-title">
                <h2>My Projects</h2>
                <p class="dashboard-subtitle">Manage your projects and meetings</p>
            </div>
            <button onclick="showCreateProjectModal()" class="btn btn-primary">
                + Create Project
            </button>
        </div>

        <!-- Meetings I'm Hosting (from other users' projects) -->
        <div id="meetingsImHostingSection" class="hosted-meetings-section" style="display: none;">
            <h3 class="section-subtitle">Meetings I'm Hosting</h3>
            <div class="meetings-list" id="meetingsImHostingList">
                <!-- Meetings will be loaded here -->
            </div>
        </div>

        <!-- All Projects Container -->
        <div class="projects-accordion" id="allProjects">
            <!-- Projects will be loaded here -->
        </div>
    </div>

    <!-- Create Project Modal -->
    <div id="createProjectModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Project</h5>
                    <button class="close-btn" onclick="closeModal('createProjectModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="createProjectForm">
                        <div class="form-group">
                            <label for="projectName">Project Name</label>
                            <input type="text" id="projectName" required>
                        </div>
                        <div class="form-group">
                            <label for="projectDescription">Description</label>
                            <textarea id="projectDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Create Project</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Meeting Modal -->
    <div id="createMeetingModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Meeting</h5>
                    <button class="close-btn" onclick="closeModal('createMeetingModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="createMeetingForm">
                        <input type="hidden" id="currentProjectId">

                        <!-- Meeting Type Toggle Buttons -->
                        <div class="form-group meeting-type-group">
                            <label>Meeting Type</label>
                            <div class="meeting-type-segmented" id="meetingTypeToggle">
                                <button type="button" class="segment-btn active" data-type="regular" onclick="selectMeetingType('regular')">Open</button>
                                <button type="button" class="segment-btn" data-type="hosted" onclick="selectMeetingType('hosted')">Hosted</button>
                                <button type="button" class="segment-btn" data-type="participant-controlled" onclick="selectMeetingType('participant-controlled')">Private</button>
                            </div>
                            <small id="meetingTypeHelp" class="form-help">Anyone can join directly without approval</small>
                        </div>

                        <!-- Host Selection (for hosted and private meetings) -->
                        <div id="hostSelectionGroup" class="form-group" style="display: none;">
                            <label>Host <span id="hostRequiredMark" style="color: red;">*</span></label>
                            <div class="searchable-dropdown" id="createHostDropdown">
                                <input type="hidden" id="meetingHost" value="">
                                <div class="dropdown-selected" id="createHostSelected" onclick="toggleCreateHostDropdown()">
                                    <span class="selected-text">Select Host</span>
                                    <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"/>
                                    </svg>
                                </div>
                                <div class="dropdown-menu" id="createHostMenu">
                                    <div class="dropdown-search">
                                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="11" cy="11" r="8"/>
                                            <path d="m21 21-4.35-4.35"/>
                                        </svg>
                                        <input type="text" id="createHostSearch" placeholder="Search users..." oninput="filterCreateHostOptions()">
                                    </div>
                                    <div class="dropdown-options" id="createHostOptions">
                                        <!-- Options populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                            <small id="hostHelp">Required for hosted meetings</small>
                        </div>

                        <!-- Participants Selection (for private meetings only) -->
                        <div id="participantsSelectionGroup" class="form-group" style="display: none;">
                            <label>Allowed Participants</label>
                            <div class="searchable-dropdown multi-select" id="createParticipantsDropdown">
                                <div class="dropdown-selected" id="createParticipantsSelected" onclick="toggleCreateParticipantsDropdown()">
                                    <span class="selected-text"><span id="selectedParticipantsCount">0</span> participants selected</span>
                                    <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"/>
                                    </svg>
                                </div>
                                <div class="dropdown-menu" id="createParticipantsMenu">
                                    <div class="dropdown-search">
                                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="11" cy="11" r="8"/>
                                            <path d="m21 21-4.35-4.35"/>
                                        </svg>
                                        <input type="text" id="createParticipantsSearch" placeholder="Search users..." oninput="filterCreateParticipantsOptions()">
                                    </div>
                                    <div class="dropdown-options multi-select-options" id="createParticipantsOptions">
                                        <!-- Options populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                            <small>Only selected users can join this meeting</small>
                        </div>

                        <div class="form-group">
                            <label for="meetingName">Meeting Name</label>
                            <input type="text" id="meetingName" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label>Start Time</label>
                                <div class="datetime-picker">
                                    <div class="custom-date-picker" id="startDatePicker">
                                        <input type="text" id="startDate" class="date-input" readonly placeholder="Select date" onclick="toggleDatePicker('start')">
                                        <div class="date-dropdown" id="startDateDropdown">
                                            <div class="date-header">
                                                <button type="button" class="date-nav-btn" onclick="navigateMonth('start', -1)">‹</button>
                                                <span class="date-month-year" id="startMonthYear"></span>
                                                <button type="button" class="date-nav-btn" onclick="navigateMonth('start', 1)">›</button>
                                            </div>
                                            <div class="date-weekdays">
                                                <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
                                            </div>
                                            <div class="date-days" id="startDateDays"></div>
                                            <div class="date-footer">
                                                <button type="button" class="date-btn" onclick="clearDate('start')">Clear</button>
                                                <button type="button" class="date-btn" onclick="selectToday('start')">Today</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="custom-time-picker" id="startTimePicker">
                                        <input type="text" id="startTime" class="time-input" readonly placeholder="00:00" onclick="toggleTimePicker('start')">
                                        <div class="time-dropdown" id="startTimeDropdown">
                                            <div class="time-columns">
                                                <div class="time-column" id="startHourColumn"></div>
                                                <div class="time-column" id="startMinuteColumn"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group half">
                                <label>End Time</label>
                                <div class="datetime-picker">
                                    <div class="custom-date-picker" id="endDatePicker">
                                        <input type="text" id="endDate" class="date-input" readonly placeholder="Select date" onclick="toggleDatePicker('end')">
                                        <div class="date-dropdown" id="endDateDropdown">
                                            <div class="date-header">
                                                <button type="button" class="date-nav-btn" onclick="navigateMonth('end', -1)">‹</button>
                                                <span class="date-month-year" id="endMonthYear"></span>
                                                <button type="button" class="date-nav-btn" onclick="navigateMonth('end', 1)">›</button>
                                            </div>
                                            <div class="date-weekdays">
                                                <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
                                            </div>
                                            <div class="date-days" id="endDateDays"></div>
                                            <div class="date-footer">
                                                <button type="button" class="date-btn" onclick="clearDate('end')">Clear</button>
                                                <button type="button" class="date-btn" onclick="selectToday('end')">Today</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="custom-time-picker" id="endTimePicker">
                                        <input type="text" id="endTime" class="time-input" readonly placeholder="00:00" onclick="toggleTimePicker('end')">
                                        <div class="time-dropdown" id="endTimeDropdown">
                                            <div class="time-columns">
                                                <div class="time-column" id="endHourColumn"></div>
                                                <div class="time-column" id="endMinuteColumn"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea id="notes" rows="2"></textarea>
                        </div>

                        <div class="form-toggles">
                            <label class="toggle-switch" id="allowGuestsToggleGroup">
                                <input type="checkbox" id="allowGuests">
                                <span class="toggle-switch-track">
                                    <span class="toggle-switch-thumb"></span>
                                </span>
                                <span class="toggle-switch-label">Allow guest access</span>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoRecording">
                                <span class="toggle-switch-track">
                                    <span class="toggle-switch-thumb"></span>
                                </span>
                                <span class="toggle-switch-label">Auto-recording</span>
                            </label>
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-full">Create Meeting</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Allowed Participants Modal -->
    <div id="manageParticipantsModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Manage Participants</h5>
                    <button class="close-btn" onclick="closeModal('manageParticipantsModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <div class="participants-modal-body">
                <div class="user-selection-panel">
                    <div class="search-box-modern">
                        <svg class="search-icon" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="userSearchBox" placeholder="Search by name or email...">
                        <button class="clear-search-btn" id="clearSearchBtn" style="display: none;" onclick="clearSearch()">
                            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </div>

                    <div class="user-list-header">
                        <span id="userCountDisplay">0 users</span>
                        <div class="filter-toggles">
                            <button class="filter-btn active" onclick="filterUsers('all')">All</button>
                            <button class="filter-btn" onclick="filterUsers('selected')">Selected</button>
                            <button class="filter-btn" onclick="filterUsers('unselected')">Not Selected</button>
                        </div>
                    </div>

                    <div id="registeredUsersList" class="users-list-modern">
                        <p class="text-muted" style="text-align: center; font-size: 0.75rem; padding: 20px;">Loading users...</p>
                    </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recording Player Modal -->
    <div id="recordingPlayerModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Meeting Recording</h5>
                    <button class="close-btn" onclick="closeRecordingPlayer()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <div id="recordingPlayerContainer" style="margin-top: 20px;">
                        <!-- Video player will be inserted here -->
                    </div>
                    <div id="recordingsListContainer" style="margin-top: 20px; max-height: 200px; overflow-y: auto;">
                        <!-- List of recordings will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Meeting Settings Modal -->
    <div id="meetingSettingsModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Meeting Settings <span class="meeting-type-display" id="settingsMeetingTypeDisplay"><span class="badge badge-type">Open</span></span></h5>
                    <button class="close-btn" onclick="closeModal('meetingSettingsModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="settingsMeetingId">
                    <input type="hidden" id="settingsMeetingType">

                    <div id="settingsInProgressWarning" class="settings-warning" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        <span>Settings locked while meeting is in progress</span>
                    </div>

                    <!-- Host Selection -->
                    <div id="hostSettingGroup" class="form-group settings-row">
                        <label>Meeting Host</label>
                        <div class="searchable-dropdown" id="settingsHostDropdown">
                            <input type="hidden" id="settingsHost" value="">
                            <div class="dropdown-selected" id="settingsHostSelected" onclick="toggleHostDropdown()">
                                <span class="selected-text">No host (open meeting)</span>
                                <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </div>
                            <div class="dropdown-menu" id="settingsHostMenu">
                                <div class="dropdown-search">
                                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="m21 21-4.35-4.35"/>
                                    </svg>
                                    <input type="text" id="settingsHostSearch" placeholder="Search users..." oninput="filterHostOptions()">
                                </div>
                                <div class="dropdown-options" id="settingsHostOptions">
                                    <!-- Options will be populated dynamically with virtual scrolling -->
                                </div>
                            </div>
                        </div>
                        <small id="hostSettingHelp">The host must start the meeting before others can join</small>
                    </div>

                    <!-- Participants Section (for Private meetings) -->
                    <div id="settingsParticipantsGroup" class="form-group settings-row" style="display: none;">
                        <label>Allowed Participants</label>
                        <div class="searchable-dropdown multi-select" id="settingsParticipantsDropdown">
                            <div class="dropdown-selected" id="settingsParticipantsSelected" onclick="toggleSettingsParticipantsDropdown()">
                                <span class="selected-text"><span id="settingsParticipantsCount">0</span> participants allowed</span>
                                <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </div>
                            <div class="dropdown-menu" id="settingsParticipantsMenu">
                                <div class="dropdown-search">
                                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="m21 21-4.35-4.35"/>
                                    </svg>
                                    <input type="text" id="settingsParticipantsSearch" placeholder="Search users..." oninput="filterSettingsParticipantsOptions()">
                                </div>
                                <div class="dropdown-options multi-select-options" id="settingsParticipantsOptions">
                                    <!-- Options populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        <small>Only selected users can join this meeting</small>
                    </div>

                    <!-- Allow Guests Toggle -->
                    <div id="allowGuestsSettingGroup" class="form-group settings-row">
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingsAllowGuests">
                            <span class="toggle-switch-track">
                                <span class="toggle-switch-thumb"></span>
                            </span>
                            <span class="toggle-switch-label">Allow guest access</span>
                        </label>
                        <small>When enabled, anyone with the guest link can join without signing in</small>
                    </div>

                    <!-- Auto Recording Toggle -->
                    <div class="form-group settings-row">
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingsAutoRecording">
                            <span class="toggle-switch-track">
                                <span class="toggle-switch-thumb"></span>
                            </span>
                            <span class="toggle-switch-label">Auto-recording</span>
                        </label>
                        <small>Automatically record the meeting when it starts</small>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <button type="button" class="btn btn-primary btn-full" onclick="saveMeetingSettings()">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <script src="../../js/config.js"></script>
    <script>document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');</script>
    <script>
        // Initialize navigation
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof Navigation !== 'undefined') {
                Navigation.init('vision', '../');
            }
        });
    </script>
    <script>document.write('<script src="../../js/vision/dashboard.js?v=' + CACHE_VERSION + '"><\/script>');</script>
</body>
</html>
