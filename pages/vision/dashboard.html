<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - HyperVision</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script>window.CACHE_VERSION = Date.now();</script>
    <script>document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');</script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/logo-svg.svg" alt="HyperVision Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <a href="../home.html" class="nav-link">Home</a>
            <a href="dashboard.html" class="nav-link active">Meetings</a>
            <a href="../drive/drive.html" class="nav-link">Drive</a>
            <div class="user-avatar-container">
                <div class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">AB</div>
                <div class="user-dropdown-menu" id="userDropdownMenu">
                    <div class="user-dropdown-header">
                        <span id="userDropdownName">User Name</span>
                    </div>
                    <!-- Mobile Navigation Links -->
                    <div class="mobile-nav-links">
                        <a href="../home.html" class="mobile-nav-link">Home</a>
                        <a href="dashboard.html" class="mobile-nav-link active">Meetings</a>
                        <a href="../drive/drive.html" class="mobile-nav-link">Drive</a>
                    </div>
                    <div class="user-dropdown-divider"></div>
                    <button class="user-dropdown-item" onclick="api.logout()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-content">
        <!-- Unified Dashboard Header -->
        <div class="dashboard-header">
            <div class="dashboard-title">
                <h2>My Projects</h2>
                <p class="dashboard-subtitle">Manage your projects and meetings</p>
            </div>
            <button onclick="showCreateProjectModal()" class="btn btn-primary">
                + Create Project
            </button>
        </div>

        <!-- Meetings I'm Hosting (from other users' projects) -->
        <div id="meetingsImHostingSection" class="hosted-meetings-section" style="display: none;">
            <h3 class="section-subtitle">Meetings I'm Hosting</h3>
            <div class="meetings-list" id="meetingsImHostingList">
                <!-- Meetings will be loaded here -->
            </div>
        </div>

        <!-- All Projects Container -->
        <div class="projects-accordion" id="allProjects">
            <!-- Projects will be loaded here -->
        </div>
    </div>

    <!-- Create Project Modal -->
    <div id="createProjectModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Project</h5>
                    <button class="close-btn" onclick="closeModal('createProjectModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="createProjectForm">
                        <div class="form-group">
                            <label for="projectName">Project Name</label>
                            <input type="text" id="projectName" required>
                        </div>
                        <div class="form-group">
                            <label for="projectDescription">Description</label>
                            <textarea id="projectDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Create Project</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Meeting Modal -->
    <div id="createMeetingModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Meeting</h5>
                    <button class="close-btn" onclick="closeModal('createMeetingModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="createMeetingForm">
                        <input type="hidden" id="currentProjectId">

                        <!-- Meeting Type Toggle Buttons -->
                        <div class="form-group">
                            <label>Meeting Type</label>
                            <div class="meeting-type-toggle" id="meetingTypeToggle">
                                <button type="button" class="type-btn active" data-type="regular" onclick="selectMeetingType('regular')">
                                    <span class="type-icon">üåê</span>
                                    <span class="type-name">Open</span>
                                </button>
                                <button type="button" class="type-btn" data-type="hosted" onclick="selectMeetingType('hosted')">
                                    <span class="type-icon">üéØ</span>
                                    <span class="type-name">Hosted</span>
                                </button>
                                <button type="button" class="type-btn" data-type="participant-controlled" onclick="selectMeetingType('participant-controlled')">
                                    <span class="type-icon">üîí</span>
                                    <span class="type-name">Private</span>
                                </button>
                            </div>
                            <small id="meetingTypeHelp" class="form-help">Anyone can join directly without approval</small>
                        </div>

                        <div class="form-group">
                            <label for="meetingName">Meeting Name</label>
                            <input type="text" id="meetingName" required>
                        </div>

                        <!-- Host Selection (for hosted and private meetings) -->
                        <div id="hostSelectionGroup" class="form-group" style="display: none;">
                            <label for="meetingHost">Host <span id="hostRequiredMark" style="color: red;">*</span></label>
                            <select id="meetingHost">
                                <option value="">Select Host</option>
                            </select>
                            <small id="hostHelp">Required for hosted meetings</small>
                        </div>

                        <!-- Participants Selection (for private meetings only) -->
                        <div id="participantsSelectionGroup" class="form-group" style="display: none;">
                            <label>Allowed Participants</label>
                            <div class="participants-inline-panel">
                                <div class="search-box-inline">
                                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="m21 21-4.35-4.35"/>
                                    </svg>
                                    <input type="text" id="createMeetingUserSearch" placeholder="Search users...">
                                </div>
                                <div id="createMeetingUsersList" class="users-list-inline">
                                    <p class="loading-text">Loading users...</p>
                                </div>
                                <div class="selected-count">
                                    <span id="selectedParticipantsCount">0</span> participants selected
                                </div>
                            </div>
                            <small>Only selected users can join this meeting</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label for="startTime">Start Time</label>
                                <input type="datetime-local" id="startTime">
                            </div>
                            <div class="form-group half">
                                <label for="endTime">End Time</label>
                                <input type="datetime-local" id="endTime">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea id="notes" rows="2"></textarea>
                        </div>

                        <div class="form-toggles">
                            <label class="toggle-switch" id="allowGuestsToggleGroup">
                                <input type="checkbox" id="allowGuests">
                                <span class="toggle-switch-track">
                                    <span class="toggle-switch-thumb"></span>
                                </span>
                                <span class="toggle-switch-label">Allow guest access</span>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoRecording">
                                <span class="toggle-switch-track">
                                    <span class="toggle-switch-thumb"></span>
                                </span>
                                <span class="toggle-switch-label">Auto-recording</span>
                            </label>
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-full">Create Meeting</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Allowed Participants Modal -->
    <div id="manageParticipantsModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Manage Participants</h5>
                    <button class="close-btn" onclick="closeModal('manageParticipantsModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="participants-modal-body">
                <div class="user-selection-panel">
                    <div class="search-box-modern">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="userSearchBox" placeholder="Search by name or email...">
                        <button class="clear-search-btn" id="clearSearchBtn" style="display: none;" onclick="clearSearch()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </div>

                    <div class="user-list-header">
                        <span id="userCountDisplay">0 users</span>
                        <div class="filter-toggles">
                            <button class="filter-btn active" onclick="filterUsers('all')">All</button>
                            <button class="filter-btn" onclick="filterUsers('selected')">Selected</button>
                            <button class="filter-btn" onclick="filterUsers('unselected')">Not Selected</button>
                        </div>
                    </div>

                    <div id="registeredUsersList" class="users-list-modern">
                        <p style="text-align: center; color: #999; font-size: 0.75rem; padding: 20px;">Loading users...</p>
                    </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recording Player Modal -->
    <div id="recordingPlayerModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Meeting Recording</h5>
                    <button class="close-btn" onclick="closeRecordingPlayer()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="recordingPlayerContainer" style="margin-top: 20px;">
                        <!-- Video player will be inserted here -->
                    </div>
                    <div id="recordingsListContainer" style="margin-top: 20px; max-height: 200px; overflow-y: auto;">
                        <!-- List of recordings will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Meeting Settings Modal -->
    <div id="meetingSettingsModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Meeting Settings</h5>
                    <button class="close-btn" onclick="closeModal('meetingSettingsModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="settingsMeetingId">
                    <input type="hidden" id="settingsMeetingType">

                    <!-- Meeting Type Display (read-only) -->
                    <div class="form-group settings-row">
                        <label>Meeting Type</label>
                        <div class="meeting-type-display" id="settingsMeetingTypeDisplay">
                            <span class="type-badge type-regular">Open</span>
                        </div>
                    </div>

                    <div id="settingsInProgressWarning" class="settings-warning" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        <span>Settings locked while meeting is in progress</span>
                    </div>

                    <!-- Host Selection -->
                    <div id="hostSettingGroup" class="form-group settings-row">
                        <label for="settingsHost">Meeting Host</label>
                        <select id="settingsHost">
                            <option value="">No host (open meeting)</option>
                        </select>
                        <small id="hostSettingHelp">The host must start the meeting before others can join</small>
                    </div>

                    <!-- Participants Section (for Private meetings) -->
                    <div id="settingsParticipantsGroup" class="form-group settings-row" style="display: none;">
                        <label>Allowed Participants</label>
                        <div class="participants-inline-panel">
                            <div class="search-box-inline">
                                <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                <input type="text" id="settingsUserSearch" placeholder="Search users...">
                            </div>
                            <div id="settingsUsersList" class="users-list-inline">
                                <p class="loading-text">Loading users...</p>
                            </div>
                            <div class="selected-count">
                                <span id="settingsParticipantsCount">0</span> participants allowed
                            </div>
                        </div>
                        <small>Only selected users can join this meeting</small>
                    </div>

                    <!-- Allow Guests Toggle -->
                    <div id="allowGuestsSettingGroup" class="form-group settings-row">
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingsAllowGuests">
                            <span class="toggle-switch-track">
                                <span class="toggle-switch-thumb"></span>
                            </span>
                            <span class="toggle-switch-label">Allow guest access</span>
                        </label>
                        <small>When enabled, anyone with the guest link can join without signing in</small>
                    </div>

                    <!-- Auto Recording Toggle -->
                    <div class="form-group settings-row">
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingsAutoRecording">
                            <span class="toggle-switch-track">
                                <span class="toggle-switch-thumb"></span>
                            </span>
                            <span class="toggle-switch-label">Auto-recording</span>
                        </label>
                        <small>Automatically record the meeting when it starts</small>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <button type="button" class="btn btn-primary btn-full" onclick="saveMeetingSettings()">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
    <script src="../../js/config.js"></script>
    <script src="../../js/api.js?v=2025112816"></script>
    <script src="../../js/vision/dashboard.js?v=2025112841"></script>
</body>
</html>
