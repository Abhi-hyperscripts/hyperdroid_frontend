<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cookie Consent & Analytics -->
    <script src="/js/cookie-consent.js" defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <title>Drive - Ragenaizer</title>
    <script>window.CACHE_VERSION = Date.now();</script>
    <script src="/js/sw-update.js"></script>
    <script src="/js/pwa-install-prompt.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script>
        document.write('<link rel="stylesheet" href="../../css/theme.css?v=' + CACHE_VERSION + '">');
        document.write('<link rel="stylesheet" href="../../css/styles.css?v=' + CACHE_VERSION + '">');
        document.write('<link rel="stylesheet" href="../../css/drive.css?v=' + CACHE_VERSION + '">');
        document.write('<link rel="stylesheet" href="../../css/glassmorphic-modal.css?v=' + CACHE_VERSION + '">');
        document.write('<script src="../../js/theme.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="../home.html">
                <img src="../../assets/brand_logo.png" alt="Ragenaizer Logo" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu">
            <!-- Navigation links rendered by Navigation.init() -->
        </div>
    </nav>

    <div class="drive-content">
        <!-- Drive Header -->
        <div class="drive-header">
            <div class="drive-breadcrumb" id="breadcrumb">
                <span class="breadcrumb-item" onclick="navigateToFolder(null)">My Drive</span>
            </div>
            <div class="drive-actions">
                <button class="btn btn-primary" onclick="showUploadModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    Upload
                </button>
                <button class="btn btn-secondary" onclick="showCreateFolderModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        <line x1="12" y1="11" x2="12" y2="17"/>
                        <line x1="9" y1="14" x2="15" y2="14"/>
                    </svg>
                    New Folder
                </button>
            </div>
        </div>

        <!-- Storage Info -->
        <div class="storage-info" id="storageInfo">
            <div class="storage-text">
                <span id="usedStorage">0 bytes</span> used
            </div>
        </div>

        <!-- Upload Notice (shown at root level) -->
        <div class="upload-notice" id="uploadNotice">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <p>Create a folder first to upload files. Files cannot be uploaded directly to the root.</p>
        </div>

        <!-- Drive Contents -->
        <div class="drive-grid" id="driveContents">
            <!-- Folders and files will be loaded here -->
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
            </svg>
            <p>This folder is empty</p>
            <p class="text-muted">Upload files or create folders to get started</p>
        </div>

        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>
    </div>

    <!-- Create Folder Modal -->
    <div id="createFolderModal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Folder</h5>
                    <button class="close-btn" onclick="closeModal('createFolderModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="createFolderForm" onsubmit="handleCreateFolder(event)">
                        <div class="form-group">
                            <label for="folderName">Folder Name</label>
                            <input type="text" id="folderName" required>
                        </div>
                        <div class="form-group">
                            <label for="folderDescription">Description (optional)</label>
                            <textarea id="folderDescription" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Create Folder</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Files</h5>
                    <button class="close-btn" onclick="closeUploadModal()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <div class="upload-dropzone" id="uploadDropzone" onclick="document.getElementById('fileInput').click()">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <p>Click to select files or drag and drop</p>
                        <p class="text-muted">Maximum file size: 5GB</p>
                        <input type="file" id="fileInput" multiple style="display: none;" onchange="handleFileSelect(event)">
                    </div>
                    <div class="upload-queue" id="uploadQueue" style="display: none;">
                        <h6>Upload Queue</h6>
                        <div id="uploadQueueList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Share</h5>
                    <button class="close-btn" onclick="closeModal('shareModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <!-- Existing Share Link View -->
                    <div id="shareExistingLink" class="share-existing-section" style="display: none;">
                        <div class="share-success-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8.59 13.51l2.83 2.83 4.24-4.24"/>
                                <circle cx="12" cy="12" r="10"/>
                            </svg>
                        </div>
                        <p class="share-success-text">Link created successfully</p>

                        <div class="share-url-box">
                            <input type="text" id="existingShareUrl" class="share-url-input" readonly>
                        </div>

                        <div class="share-actions">
                            <button class="btn-copy-link" onclick="copyShareLink()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                                Copy Link
                            </button>
                        </div>

                        <button class="btn-revoke" onclick="revokeCurrentShare()">Revoke Link</button>
                    </div>

                    <!-- Create Share Form -->
                    <form id="shareForm" onsubmit="handleCreateShare(event)">
                        <input type="hidden" id="shareItemId">
                        <input type="hidden" id="shareItemType">
                        <div class="form-group">
                            <label for="shareAccessType">Access Type</label>
                            <select id="shareAccessType">
                                <option value="view">View only</option>
                                <option value="download" selected>Download</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="shareExpiry">Expires After</label>
                            <select id="shareExpiry">
                                <option value="0">Never</option>
                                <option value="1">1 hour</option>
                                <option value="24">1 day</option>
                                <option value="168">1 week</option>
                                <option value="720">30 days</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sharePassword">Password (optional)</label>
                            <input type="password" id="sharePassword" placeholder="Leave empty for no password">
                        </div>
                        <div class="form-group">
                            <label for="shareMaxDownloads">Max Downloads (0 = unlimited)</label>
                            <input type="number" id="shareMaxDownloads" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Create Share Link</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Folder Modal -->
    <div id="editFolderModal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Folder</h5>
                    <button class="close-btn" onclick="closeModal('editFolderModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="editFolderForm" onsubmit="handleUpdateFolder(event)">
                        <input type="hidden" id="editFolderId">
                        <div class="form-group">
                            <label for="editFolderName">Folder Name</label>
                            <input type="text" id="editFolderName" required>
                        </div>
                        <div class="form-group">
                            <label for="editFolderDescription">Description</label>
                            <textarea id="editFolderDescription" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Rename File Modal -->
    <div id="renameFileModal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Rename File</h5>
                    <button class="close-btn" onclick="closeModal('renameFileModal')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
                <div class="modal-body">
                    <form id="renameFileForm" onsubmit="handleRenameFile(event)">
                        <input type="hidden" id="renameFileId">
                        <div class="form-group">
                            <label for="renameFileName">File Name</label>
                            <input type="text" id="renameFileName" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Rename</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu" style="display: none;">
        <div class="context-menu-item" onclick="contextMenuAction('download')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Download
        </div>
        <div class="context-menu-item" onclick="contextMenuAction('share')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
            </svg>
            Share
        </div>
        <div class="context-menu-item" onclick="contextMenuAction('rename')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Rename
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item danger" onclick="contextMenuAction('delete')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
            Delete
        </div>
    </div>

    <!-- SignalR for real-time updates -->
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>

    <script>
        document.write('<script src="../../js/config.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/api.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/navigation.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/toast.js?v=' + CACHE_VERSION + '"><\/script>');
        document.write('<script src="../../js/drive/drive.js?v=' + CACHE_VERSION + '"><\/script>');
    </script>
    <script>
        // Initialize navigation
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof Navigation !== 'undefined') {
                Navigation.init('drive', '../');
            }
        });
    </script>
</body>
</html>
