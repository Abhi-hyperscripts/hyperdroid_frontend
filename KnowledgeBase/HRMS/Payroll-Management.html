<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRMS Payroll Management Guide | HyperDroid Knowledge Base</title>
    <!-- Import master theme for brand colors -->
    <link rel="stylesheet" href="../../css/theme.css">
    <style>
        :root {
            /*
             * Map documentation variables to theme.css semantic variables.
             * These automatically adapt to light/dark mode via theme.css.
             */
            --primary-color: var(--brand-primary);
            --primary-dark: var(--brand-primary-dark);
            --primary-light: var(--brand-primary-light);
            --secondary-color: var(--color-success);
            --warning-color: var(--color-warning);
            --danger-color: var(--color-danger);
            --text-color: var(--text-primary);
            --text-muted-color: var(--text-secondary);
            --bg-color: var(--bg-body);
            --card-bg: var(--bg-card);
            --code-bg: var(--bg-card-hover);
            --header-bg: var(--gradient-header);
            --table-hover: var(--bg-card-hover);
            --shadow-color: var(--shadow-xs);
            --shadow-strong: var(--shadow-sm);
            --border-color: var(--border-color);

            /* Documentation-specific colors */
            --tip-bg: var(--color-success-light);
            --tip-border: var(--color-success);
            --warning-bg: var(--color-warning-light);
            --warning-border: var(--color-warning);
            --important-bg: var(--color-info-light);
            --important-border: var(--brand-primary);
            --badge-required-bg: var(--color-danger-light);
            --badge-required-color: var(--color-danger-text);
            --badge-optional-bg: var(--color-info-light);
            --badge-optional-color: var(--color-info-text);
            --footer-bg: var(--brand-primary-dark, var(--bg-tooltip));
            --footer-text: var(--text-inverse);
            --footer-link: var(--brand-primary-light, #93c5fd);
            --header-text: var(--text-inverse);
            --nav-hover-text: var(--text-inverse);
        }

        /* Dark mode overrides */
        [data-theme="dark"] {
            --tip-bg: var(--success-alpha-10);
            --warning-bg: var(--warning-alpha-10);
            --important-bg: var(--info-alpha-10, rgba(59, 130, 246, 0.15));
            --badge-required-bg: var(--danger-alpha-10);
            --badge-required-color: var(--color-danger-text);
            --badge-optional-bg: var(--info-alpha-10, rgba(59, 130, 246, 0.15));
            --badge-optional-color: var(--brand-primary-light);
        }

        @media (prefers-color-scheme: dark) {
            :root:not([data-theme="light"]) {
                --tip-bg: var(--success-alpha-10);
                --warning-bg: var(--warning-alpha-10);
                --important-bg: var(--info-alpha-10, rgba(59, 130, 246, 0.15));
                --badge-required-bg: var(--danger-alpha-10);
                --badge-required-color: var(--color-danger-text);
                --badge-optional-bg: var(--info-alpha-10, rgba(59, 130, 246, 0.15));
                --badge-optional-color: var(--brand-primary-light);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-color);
            background-color: var(--bg-color);
        }

        /* Header */
        header {
            position: sticky;
            top: 0;
            background: var(--header-bg);
            color: var(--header-text);
            padding: 28px 20px;
            text-align: center;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        header h1 {
            font-size: 1.4rem;
            margin-bottom: 6px;
            font-weight: 500;
        }

        header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 260px;
            height: 100vh;
            background: var(--card-bg);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            position: sticky;
            top: 0;
            padding: 16px 16px 16px 16px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 8px;
            background: var(--card-bg);
            z-index: 10;
        }

        .sidebar-header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .sidebar-header h2 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
        }

        .sidebar-header p {
            font-size: 0.7rem;
            color: var(--text-muted-color);
            margin-top: 4px;
        }

        .sidebar-header .theme-toggle {
            background: transparent;
            border: none;
            padding: 6px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-header .theme-toggle:hover {
            background: var(--table-hover);
        }

        .sidebar-header .theme-toggle .icon {
            font-size: 1.1rem;
        }

        .nav-group {
            margin-bottom: 8px;
        }

        .nav-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
            transition: color 0.2s;
        }

        .nav-group-header:hover {
            color: var(--primary-color);
        }

        .nav-group-header .chevron {
            transition: transform 0.2s;
            font-size: 0.6rem;
        }

        .nav-group.collapsed .chevron {
            transform: rotate(-90deg);
        }

        .nav-group.collapsed .nav-group-items {
            display: none;
        }

        .nav-group-items {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-group-items li {
            margin: 0;
        }

        .nav-group-items a {
            display: block;
            padding: 6px 16px 6px 24px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 0.78rem;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .nav-group-items a:hover {
            background: var(--table-hover);
            color: var(--primary-color);
            border-left-color: var(--primary-light);
        }

        .nav-group-items a.active {
            background: var(--primary-light);
            color: var(--primary-dark);
            border-left-color: var(--primary-color);
            font-weight: 500;
        }

        .nav-group-items .section-num {
            display: inline-block;
            width: 22px;
            font-size: 0.7rem;
            color: var(--text-muted-color);
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 1001;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 2px 8px var(--shadow-strong);
        }

        .menu-toggle:hover {
            background: var(--primary-dark);
        }

        .hamburger-line {
            display: block;
            width: 20px;
            height: 2px;
            background: white;
            border-radius: 1px;
            transition: all 0.3s ease;
        }

        .hamburger-line + .hamburger-line {
            margin-top: 5px;
        }

        .menu-toggle.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .menu-toggle.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }

        .menu-toggle.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        /* Sidebar overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            backdrop-filter: blur(2px);
        }

        .sidebar-overlay.active {
            display: block;
        }

        /* Main Content - adjusted for sidebar */
        main {
            margin-left: 260px;
            padding: 24px 48px 40px 32px;
            max-width: none;
        }

        /* Responsive Design */
        @media (max-width: 900px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-overlay.active {
                display: block;
            }

            .menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            main {
                margin-left: 0;
                padding: 70px 16px 70px;
            }

            header {
                padding-left: 60px;
            }

            .sidebar-header h2 {
                font-size: 1rem;
            }

            .sidebar-header {
                padding-left: 56px;
            }

            footer {
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 8px;
                padding: 16px 20px;
                font-size: 0.85rem;
                font-weight: 500;
                background: var(--footer-bg) !important;
            }

            footer p {
                width: 100%;
                text-align: center;
                line-height: 1.4;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            /* Mobile table scrolling */
            section {
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 500px;
            }
        }

        /* Sections */
        section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 12px var(--shadow-color);
            overflow-x: auto;
        }

        section h2 {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        section h2 .section-number {
            background: var(--primary-color);
            color: var(--card-bg);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }

        section h3 {
            font-size: 0.95rem;
            font-weight: 500;
            margin: 18px 0 10px;
            color: var(--brand-primary);
        }

        section h4 {
            font-size: 0.85rem;
            font-weight: 500;
            margin: 14px 0 8px;
            color: var(--text-color);
        }

        /* Screenshots */
        .screenshot-container {
            margin: 16px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px var(--shadow-strong);
        }

        .screenshot-container img {
            width: 100%;
            display: block;
        }

        .screenshot-caption {
            background: var(--code-bg);
            padding: 10px 12px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
        }

        /* Info Boxes */
        .info-box {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 0.8rem;
        }

        .info-box.tip {
            background: var(--tip-bg);
            border-left: 3px solid var(--tip-border);
        }

        .info-box.warning {
            background: var(--warning-bg);
            border-left: 3px solid var(--warning-border);
        }

        .info-box.important {
            background: var(--important-bg);
            border-left: 3px solid var(--important-border);
        }

        .info-box .icon {
            font-size: 1rem;
            flex-shrink: 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 0.85rem;
        }

        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--code-bg);
            font-weight: 500;
            font-size: 0.8rem;
        }

        tr:hover {
            background: var(--table-hover);
        }

        /* Lists */
        ul, ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        li {
            margin-bottom: 6px;
        }

        /* Code */
        code {
            background: var(--code-bg);
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Menlo', 'Monaco', monospace;
            font-size: 0.85em;
        }

        pre {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            color: var(--text-color);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 400;
        }

        .badge-required {
            background: var(--badge-required-bg);
            color: var(--badge-required-color);
        }

        .badge-optional {
            background: var(--badge-optional-bg);
            color: var(--badge-optional-color);
        }

        .badge-admin {
            background: var(--warning-bg);
            color: var(--warning-color);
        }

        /* Step indicators */
        .steps {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }

        .steps li {
            counter-increment: step-counter;
            padding-left: 40px;
            position: relative;
            margin-bottom: 14px;
        }

        .steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 24px;
            height: 24px;
            background: var(--primary-color);
            color: var(--card-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.75rem;
        }

        /* Feature Cards */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 14px;
            margin: 14px 0;
        }

        .feature-card {
            background: var(--code-bg);
            padding: 14px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .feature-card h4 {
            margin-top: 0;
            margin-bottom: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .feature-card p {
            font-size: 0.75rem;
            margin: 0;
            color: var(--text-secondary);
        }

        /* Lighter strong text */
        .info-box strong,
        .feature-card strong,
        td strong {
            font-weight: 500;
        }

        /* Responsive */
        @media (max-width: 768px) {
            section {
                padding: 14px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scroll margin for direct URL access */
        section[id] {
            scroll-margin-top: 120px;
        }

        /* Back to top */
        .back-to-top {
            position: fixed;
            bottom: 40px;
            right: 20px;
            width: 36px;
            height: 36px;
            background: var(--primary-color);
            color: var(--card-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: 0 2px 10px var(--shadow-strong);
            transition: transform 0.2s;
            font-size: 0.9rem;
            z-index: 60;
        }

        .back-to-top:hover {
            transform: translateY(-2px);
        }

        /* Footer */
        footer {
            position: fixed;
            bottom: 0;
            left: 260px;
            right: 0;
            background: var(--footer-bg);
            color: var(--footer-text);
            text-align: center;
            padding: 6px 16px;
            font-size: 0.7rem;
            z-index: 50;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
        }

        footer p {
            margin: 0;
        }

        footer a {
            color: var(--footer-link);
            text-decoration: underline;
        }

        footer a:hover {
            color: white;
        }

        /* Workflow diagram */
        .workflow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin: 16px 0;
            padding: 16px;
            background: var(--code-bg);
            border-radius: 8px;
        }

        .workflow-step {
            background: var(--primary-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .workflow-arrow {
            color: var(--text-muted-color);
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>HRMS Payroll Management Guide</h1>
        <p>Complete guide to salary components, structures, payroll processing, loans, and arrears</p>
    </header>

    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" id="menuToggle" aria-label="Toggle navigation menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
    </button>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-header-top">
                <h2>Payroll Management</h2>
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <span class="icon" id="themeIcon">&#127769;</span>
                </button>
            </div>
            <p>HyperDroid HRMS Guide</p>
        </div>

        <!-- Getting Started -->
        <nav class="nav-group">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                Getting Started
                <span class="chevron">&#9660;</span>
            </div>
            <ul class="nav-group-items">
                <li><a href="#overview"><span class="section-num">1</span> Overview</a></li>
                <li><a href="#workflow"><span class="section-num">2</span> Payroll Workflow</a></li>
            </ul>
        </nav>

        <!-- Configuration -->
        <nav class="nav-group">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                Configuration
                <span class="chevron">&#9660;</span>
            </div>
            <ul class="nav-group-items">
                <li><a href="#salary-components"><span class="section-num">3</span> Salary Components</a></li>
                <li><a href="#salary-structures"><span class="section-num">4</span> Salary Structures</a></li>
                <li><a href="#location-taxes"><span class="section-num">5</span> Location Taxes</a></li>
            </ul>
        </nav>

        <!-- Payroll Processing -->
        <nav class="nav-group">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                Payroll Processing
                <span class="chevron">&#9660;</span>
            </div>
            <ul class="nav-group-items">
                <li><a href="#payroll-drafts"><span class="section-num">6</span> Payroll Drafts</a></li>
                <li><a href="#finalized-runs"><span class="section-num">7</span> Finalized Runs</a></li>
            </ul>
        </nav>

        <!-- Loans & Adjustments -->
        <nav class="nav-group">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                Loans & Adjustments
                <span class="chevron">&#9660;</span>
            </div>
            <ul class="nav-group-items">
                <li><a href="#loans"><span class="section-num">8</span> Loans & Advances</a></li>
                <li><a href="#arrears"><span class="section-num">9</span> Arrears Management</a></li>
            </ul>
        </nav>

        <!-- Reference -->
        <nav class="nav-group">
            <div class="nav-group-header" onclick="toggleNavGroup(this)">
                Reference
                <span class="chevron">&#9660;</span>
            </div>
            <ul class="nav-group-items">
                <li><a href="#checklist"><span class="section-num">&#10003;</span> Setup Checklist</a></li>
            </ul>
        </nav>
    </aside>

    <main>
        <!-- Section 1: Overview -->
        <section id="overview">
            <h2><span class="section-number">1</span> Overview</h2>
            <p>The Payroll Management module handles everything related to employee compensation - from defining salary components to processing monthly payroll and managing loans.</p>

            <div class="screenshot-container">
                <img src="images/payroll/01-salary-components-overview.png" alt="Payroll Management Overview">
                <div class="screenshot-caption">Payroll Management page showing Salary Components tab with earnings and deductions</div>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Salary Components</h4>
                    <p>Define earnings (Basic, HRA, Allowances) and deductions (PF, Tax, ESI) that make up employee salaries.</p>
                </div>
                <div class="feature-card">
                    <h4>Salary Structures</h4>
                    <p>Create salary structures by combining components. Assign structures to employees with CTC-based calculation.</p>
                </div>
                <div class="feature-card">
                    <h4>Location Taxes</h4>
                    <p>Configure office-specific taxes like Professional Tax with fixed, percentage, or slab-based rules.</p>
                </div>
                <div class="feature-card">
                    <h4>Payroll Drafts</h4>
                    <p>Create monthly payroll drafts, process payslips, review, and finalize before payment.</p>
                </div>
                <div class="feature-card">
                    <h4>Finalized Runs</h4>
                    <p>Approve finalized payroll runs, mark as paid, and export bank files for salary disbursement.</p>
                </div>
                <div class="feature-card">
                    <h4>Loans & Advances</h4>
                    <p>Manage employee loans with EMI deductions, interest calculations, and repayment tracking.</p>
                </div>
                <div class="feature-card">
                    <h4>Arrears Management</h4>
                    <p>Handle salary arrears from backdated structure changes with automatic calculation.</p>
                </div>
            </div>

            <div class="info-box important">
                <span class="icon">&#8505;&#65039;</span>
                <div>
                    <strong>Prerequisites:</strong> Before setting up payroll, ensure you have completed Organization Setup (Offices, Departments, Designations) and created Employees. Payroll requires employees with assigned salary structures.
                </div>
            </div>
        </section>

        <!-- Section 2: Payroll Workflow -->
        <section id="workflow">
            <h2><span class="section-number">2</span> Payroll Workflow</h2>
            <p>Understanding the complete payroll workflow is essential for successful monthly processing.</p>

            <h3>Monthly Payroll Process</h3>
            <div class="workflow-diagram">
                <span class="workflow-step">Create Draft</span>
                <span class="workflow-arrow">&#8594;</span>
                <span class="workflow-step">Process</span>
                <span class="workflow-arrow">&#8594;</span>
                <span class="workflow-step">Review</span>
                <span class="workflow-arrow">&#8594;</span>
                <span class="workflow-step">Finalize</span>
                <span class="workflow-arrow">&#8594;</span>
                <span class="workflow-step">Approve</span>
                <span class="workflow-arrow">&#8594;</span>
                <span class="workflow-step">Pay</span>
            </div>

            <h4>Workflow Steps Explained</h4>
            <table>
                <thead>
                    <tr>
                        <th>Step</th>
                        <th>Description</th>
                        <th>Who</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>1. Create Draft</strong></td>
                        <td>Create a new payroll draft for a specific month/year and office</td>
                        <td>HR Admin</td>
                    </tr>
                    <tr>
                        <td><strong>2. Process</strong></td>
                        <td>Calculate payslips for all employees based on attendance, leaves, and deductions</td>
                        <td>System</td>
                    </tr>
                    <tr>
                        <td><strong>3. Review</strong></td>
                        <td>Review individual payslips, make adjustments if needed, verify totals</td>
                        <td>HR Admin</td>
                    </tr>
                    <tr>
                        <td><strong>4. Finalize</strong></td>
                        <td>Lock the draft and create a finalized payroll run (cannot be undone)</td>
                        <td>HR Admin</td>
                    </tr>
                    <tr>
                        <td><strong>5. Approve</strong></td>
                        <td>Management approval of the payroll run before payment</td>
                        <td>Manager/Admin</td>
                    </tr>
                    <tr>
                        <td><strong>6. Pay</strong></td>
                        <td>Mark as paid with payment reference, generate bank files</td>
                        <td>HR Admin</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box tip">
                <span class="icon">&#128161;</span>
                <div>
                    <strong>Best Practice:</strong> Complete attendance regularization and leave approvals before processing payroll. This ensures accurate working days calculations.
                </div>
            </div>
        </section>

        <!-- Section 3: Salary Components -->
        <section id="salary-components">
            <h2><span class="section-number">3</span> Salary Components</h2>
            <p>Salary components are the building blocks of employee salaries. They are divided into <strong>Earnings</strong> (money added) and <strong>Deductions</strong> (money subtracted).</p>

            <h3>Understanding Component Types</h3>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Examples</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Earning</strong></td>
                        <td>Adds to gross salary</td>
                        <td>Basic Pay, HRA, Special Allowance, Bonus</td>
                    </tr>
                    <tr>
                        <td><strong>Deduction</strong></td>
                        <td>Subtracts from gross salary</td>
                        <td>PF, Professional Tax, TDS, ESI</td>
                    </tr>
                </tbody>
            </table>

            <h3>Calculation Types</h3>
            <table>
                <thead>
                    <tr>
                        <th>Calculation</th>
                        <th>Description</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Fixed</strong></td>
                        <td>Same amount every month</td>
                        <td>Professional Tax = &#8377;200/month</td>
                    </tr>
                    <tr>
                        <td><strong>Percentage of CTC</strong></td>
                        <td>Calculated as % of annual CTC</td>
                        <td>Basic = 50% of CTC</td>
                    </tr>
                    <tr>
                        <td><strong>Percentage of Basic</strong></td>
                        <td>Calculated as % of Basic salary</td>
                        <td>HRA = 40% of Basic, PF = 12% of Basic</td>
                    </tr>
                </tbody>
            </table>

            <h3>Step-by-Step: Creating Salary Components</h3>

            <h4>Step 1: View the Salary Components Tab</h4>
            <p>Navigate to HRMS &#8594; Payroll &#8594; Salary Components tab to see existing components:</p>

            <div class="screenshot-container">
                <img src="images/payroll/01-salary-components-overview.png" alt="Salary Components Overview">
                <div class="screenshot-caption">Salary Components tab showing Earnings and Deductions tables with existing components</div>
            </div>

            <h4>Step 2: Click Add Salary Component</h4>
            <p>Click the <strong>"Add Salary Component"</strong> button to open the creation modal:</p>

            <div class="screenshot-container">
                <img src="images/payroll/02-component-modal-empty.png" alt="Empty Component Modal">
                <div class="screenshot-caption">Empty Add Salary Component modal ready for data entry</div>
            </div>

            <h4>Step 3: Configure an Earning Component (Basic Pay)</h4>
            <p>For Basic Pay, use <strong>Percentage of CTC</strong> calculation:</p>

            <div class="screenshot-container">
                <img src="images/payroll/04-basic-pay-edit-with-basic-toggle.png" alt="Basic Pay Configuration">
                <div class="screenshot-caption">Configuring Basic Pay as 50% of CTC with "Is Basic Salary" toggle enabled</div>
            </div>

            <div class="info-box important">
                <span class="icon">&#8505;&#65039;</span>
                <div>
                    <strong>Is Basic Salary:</strong> Enable this toggle for your Basic Pay component. This marks it as the base for percentage-of-basic calculations (like HRA and PF).
                </div>
            </div>

            <h4>Step 4: Create HRA as Percentage of Basic</h4>
            <p>For HRA, use <strong>Percentage of Basic</strong> calculation:</p>

            <div class="screenshot-container">
                <img src="images/payroll/06-component-modal-hra-percentage.png" alt="HRA Configuration">
                <div class="screenshot-caption">Configuring HRA as 40% of Basic salary</div>
            </div>

            <h4>Step 5: View All Components</h4>
            <p>After creating all required components, your list should look like this:</p>

            <div class="screenshot-container">
                <img src="images/payroll/08-all-components-complete.png" alt="All Components Complete">
                <div class="screenshot-caption">Complete list of salary components with 5 Earnings and 4 Deductions</div>
            </div>

            <h3>Field Descriptions</h3>
            <table>
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Component Name</strong></td>
                        <td><span class="badge badge-required">Required</span></td>
                        <td>Display name (e.g., "Basic Pay", "House Rent Allowance")</td>
                    </tr>
                    <tr>
                        <td><strong>Component Code</strong></td>
                        <td><span class="badge badge-required">Required</span></td>
                        <td>Unique code (e.g., "BASIC", "HRA", "PF")</td>
                    </tr>
                    <tr>
                        <td><strong>Component Type</strong></td>
                        <td><span class="badge badge-required">Required</span></td>
                        <td>Earning or Deduction</td>
                    </tr>
                    <tr>
                        <td><strong>Calculation Type</strong></td>
                        <td><span class="badge badge-required">Required</span></td>
                        <td>Fixed, Percentage of CTC, or Percentage of Basic</td>
                    </tr>
                    <tr>
                        <td><strong>Default Value/Percentage</strong></td>
                        <td><span class="badge badge-optional">Optional</span></td>
                        <td>Default fixed amount or percentage for this component</td>
                    </tr>
                    <tr>
                        <td><strong>Is Basic Salary</strong></td>
                        <td><span class="badge badge-optional">Optional</span></td>
                        <td>Enable only for Basic Pay - marks it as base for % of basic calculations</td>
                    </tr>
                    <tr>
                        <td><strong>Is Taxable</strong></td>
                        <td><span class="badge badge-optional">Optional</span></td>
                        <td>Whether this component is subject to income tax</td>
                    </tr>
                    <tr>
                        <td><strong>Is Statutory</strong></td>
                        <td><span class="badge badge-optional">Optional</span></td>
                        <td>Whether this is a government-mandated component (PF, ESI)</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box tip">
                <span class="icon">&#128161;</span>
                <div>
                    <strong>Recommended Components:</strong><br>
                    <strong>Earnings:</strong> Basic Pay (50% CTC), HRA (40% Basic), Special Allowance (remainder), Conveyance<br>
                    <strong>Deductions:</strong> PF Employee (12% Basic), Professional Tax (Fixed), ESI (if applicable)
                </div>
            </div>
        </section>

        <!-- Section 4: Salary Structures -->
        <section id="salary-structures">
            <h2><span class="section-number">4</span> Salary Structures</h2>
            <p>Salary structures combine multiple components into a template that can be assigned to employees. Each structure calculates salaries based on the employee's CTC (Cost to Company).</p>

            <h3>Step-by-Step: Creating a Salary Structure</h3>

            <h4>Step 1: View the Salary Structures Tab</h4>
            <p>Navigate to Salary Structures tab. Initially it will be empty:</p>

            <div class="screenshot-container">
                <img src="images/payroll/09-salary-structures-empty.png" alt="Empty Salary Structures">
                <div class="screenshot-caption">Empty Salary Structures tab before any structures are created</div>
            </div>

            <h4>Step 2: Click Create Salary Structure</h4>
            <div class="screenshot-container">
                <img src="images/payroll/10-structure-modal-empty.png" alt="Empty Structure Modal">
                <div class="screenshot-caption">Empty Create Salary Structure modal</div>
            </div>

            <h4>Step 3: Add Components to Structure</h4>
            <p>Click "Add Component" to add salary components:</p>

            <div class="screenshot-container">
                <img src="images/payroll/11-structure-add-component.png" alt="Adding Components">
                <div class="screenshot-caption">Adding components to the salary structure with calculation settings</div>
            </div>

            <h4>Step 4: Complete the Structure Configuration</h4>
            <div class="screenshot-container">
                <img src="images/payroll/12-structure-modal-filled.png" alt="Filled Structure Modal">
                <div class="screenshot-caption">Completed salary structure with all components configured</div>
            </div>

            <h4>Step 5: View the Created Structure</h4>
            <div class="screenshot-container">
                <img src="images/payroll/13-structure-created-success.png" alt="Structure Created">
                <div class="screenshot-caption">Salary structure created successfully and displayed in the list</div>
            </div>

            <h3>Structure Versioning</h3>
            <p>Salary structures support versioning for handling mid-year changes. When you modify a structure, you can create a new version with an effective date.</p>

            <h4>Viewing Version History</h4>
            <div class="screenshot-container">
                <img src="images/payroll/14-version-history-modal.png" alt="Version History">
                <div class="screenshot-caption">Version History modal showing all versions of a salary structure</div>
            </div>

            <h4>Version Details</h4>
            <div class="screenshot-container">
                <img src="images/payroll/15-version-details-components.png" alt="Version Details">
                <div class="screenshot-caption">Detailed view of a specific version showing all component configurations</div>
            </div>

            <h4>Creating a New Version</h4>
            <p>When salary components change (e.g., government revises PF percentage), create a new version:</p>

            <div class="screenshot-container">
                <img src="images/payroll/16-create-new-version-modal.png" alt="Create New Version">
                <div class="screenshot-caption">Create New Version modal with effective date and change reason</div>
            </div>

            <h3>Bulk Employee Assignment</h3>
            <p>Assign a salary structure to multiple employees at once:</p>

            <div class="screenshot-container">
                <img src="images/payroll/17-bulk-assign-modal.png" alt="Bulk Assign Modal">
                <div class="screenshot-caption">Bulk Assign modal for assigning structure to multiple employees simultaneously</div>
            </div>

            <h3>Preview Salary Calculation</h3>
            <p>Preview how salaries will be calculated before assigning to employees:</p>

            <div class="screenshot-container">
                <img src="images/payroll/18-preview-calculation-input.png" alt="Preview Input">
                <div class="screenshot-caption">Enter CTC amount to preview salary breakdown</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/19-preview-calculation-result.png" alt="Preview Result">
                <div class="screenshot-caption">Calculated salary breakdown showing all components, gross, deductions, and net pay</div>
            </div>

            <h3>Editing a Structure</h3>
            <div class="screenshot-container">
                <img src="images/payroll/20-edit-structure-modal.png" alt="Edit Structure">
                <div class="screenshot-caption">Edit Salary Structure modal with existing configuration</div>
            </div>

            <div class="info-box warning">
                <span class="icon">&#9888;&#65039;</span>
                <div>
                    <strong>Caution:</strong> When editing a structure that has employees assigned, consider creating a new version instead of direct editing. This preserves history and allows for retroactive arrears calculation.
                </div>
            </div>
        </section>

        <!-- Section 5: Location Taxes -->
        <section id="location-taxes">
            <h2><span class="section-number">5</span> Location Taxes</h2>
            <p>Location Taxes allow you to configure office-specific tax rules like Professional Tax (PT) that vary by state/location.</p>

            <h3>Understanding Location Taxes</h3>
            <p>Location taxes are managed through two sub-tabs:</p>
            <ul>
                <li><strong>Tax Types:</strong> Define the types of taxes (e.g., Professional Tax, State Tax)</li>
                <li><strong>Office Tax Rules:</strong> Configure specific rules for each office</li>
            </ul>

            <h3>Step 1: Create Tax Types</h3>
            <p>First, create the tax types your organization needs:</p>

            <div class="screenshot-container">
                <img src="images/payroll/21-location-taxes-empty.png" alt="Location Taxes Empty">
                <div class="screenshot-caption">Empty Location Taxes page showing Tax Types sub-tab</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/22-tax-type-modal-empty.png" alt="Tax Type Modal Empty">
                <div class="screenshot-caption">Empty Create Tax Type modal</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/23-tax-type-modal-filled.png" alt="Tax Type Modal Filled">
                <div class="screenshot-caption">Creating Professional Tax as a tax type</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/24-tax-type-created.png" alt="Tax Type Created">
                <div class="screenshot-caption">Professional Tax type created successfully</div>
            </div>

            <h3>Step 2: Create Office Tax Rules</h3>
            <p>Switch to "Office Tax Rules" sub-tab and create rules for each office:</p>

            <div class="screenshot-container">
                <img src="images/payroll/25-office-tax-rules-empty.png" alt="Office Tax Rules Empty">
                <div class="screenshot-caption">Empty Office Tax Rules sub-tab</div>
            </div>

            <h4>Rule Types</h4>
            <table>
                <thead>
                    <tr>
                        <th>Calculation Type</th>
                        <th>Description</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Fixed</strong></td>
                        <td>Same amount for all employees</td>
                        <td>PT = &#8377;200/month</td>
                    </tr>
                    <tr>
                        <td><strong>Percentage</strong></td>
                        <td>Calculated as % of salary</td>
                        <td>State Tax = 2% of Gross</td>
                    </tr>
                    <tr>
                        <td><strong>Slab-Based</strong></td>
                        <td>Different rates for different salary ranges</td>
                        <td>PT varies by income slab</td>
                    </tr>
                </tbody>
            </table>

            <h4>Creating a Slab-Based Rule</h4>
            <div class="screenshot-container">
                <img src="images/payroll/26-tax-rule-slab-based.png" alt="Slab Based Rule">
                <div class="screenshot-caption">Configuring a slab-based tax rule with multiple income slabs</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/27-tax-rule-slabs-configured.png" alt="Slabs Configured">
                <div class="screenshot-caption">Multiple tax slabs configured for Professional Tax</div>
            </div>

            <h4>Creating a Fixed Rule</h4>
            <div class="screenshot-container">
                <img src="images/payroll/28-tax-rule-fixed-filled.png" alt="Fixed Rule">
                <div class="screenshot-caption">Creating a fixed amount Professional Tax rule</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/30-office-tax-rules-with-rule.png" alt="Rules List">
                <div class="screenshot-caption">Office Tax Rules list showing configured rules</div>
            </div>

            <h3>Tax Preview</h3>
            <p>Preview how taxes will be calculated for a specific salary:</p>

            <div class="screenshot-container">
                <img src="images/payroll/31-tax-preview-modal-empty.png" alt="Tax Preview Empty">
                <div class="screenshot-caption">Tax Preview modal to test calculations</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/32-tax-preview-result.png" alt="Tax Preview Result">
                <div class="screenshot-caption">Tax calculation result showing applicable tax amount</div>
            </div>

            <h3>Copy Rules Between Offices</h3>
            <p>Copy tax rules from one office to another:</p>

            <div class="screenshot-container">
                <img src="images/payroll/33-copy-rules-modal.png" alt="Copy Rules Modal">
                <div class="screenshot-caption">Copy Tax Rules modal for duplicating rules across offices</div>
            </div>
        </section>

        <!-- Section 6: Payroll Drafts -->
        <section id="payroll-drafts">
            <h2><span class="section-number">6</span> Payroll Drafts</h2>
            <p>Payroll Drafts are where you create and process monthly payroll before finalizing. Drafts can be reviewed, modified, and recalculated until you're ready to finalize.</p>

            <h3>Step-by-Step: Creating and Processing a Payroll Draft</h3>

            <h4>Step 1: View the Drafts Tab</h4>
            <div class="screenshot-container">
                <img src="images/payroll/34-drafts-empty.png" alt="Drafts Empty">
                <div class="screenshot-caption">Empty Payroll Drafts tab before any drafts are created</div>
            </div>

            <h4>Step 2: Click Create Draft</h4>
            <div class="screenshot-container">
                <img src="images/payroll/35-create-draft-modal.png" alt="Create Draft Modal">
                <div class="screenshot-caption">Create Payroll Draft modal with period and office selection</div>
            </div>

            <h4>Step 3: Fill Draft Details</h4>
            <div class="screenshot-container">
                <img src="images/payroll/36-create-draft-filled.png" alt="Draft Filled">
                <div class="screenshot-caption">Completed Create Draft form with December 2024, All Offices selected</div>
            </div>

            <h4>Step 4: View Created Draft</h4>
            <div class="screenshot-container">
                <img src="images/payroll/37-draft-created.png" alt="Draft Created">
                <div class="screenshot-caption">Draft created successfully with "Pending" status</div>
            </div>

            <h4>Step 5: Process the Draft</h4>
            <p>Click the Process button to calculate all employee payslips:</p>

            <div class="screenshot-container">
                <img src="images/payroll/38-process-draft-confirm.png" alt="Process Confirmation">
                <div class="screenshot-caption">Confirmation dialog before processing payroll</div>
            </div>

            <h4>Step 6: Review Processed Payslips</h4>
            <div class="screenshot-container">
                <img src="images/payroll/39-draft-processed-payslips.png" alt="Processed Payslips">
                <div class="screenshot-caption">Draft details showing all calculated employee payslips</div>
            </div>

            <h4>Step 7: View Individual Payslip Details</h4>
            <div class="screenshot-container">
                <img src="images/payroll/40-payslip-details-modal.png" alt="Payslip Details">
                <div class="screenshot-caption">Individual payslip showing earnings breakdown, deductions, and net pay</div>
            </div>

            <h4>Step 8: Finalize the Draft</h4>
            <p>When satisfied with all payslips, finalize the draft:</p>

            <div class="screenshot-container">
                <img src="images/payroll/41-finalize-draft-confirm.png" alt="Finalize Confirmation">
                <div class="screenshot-caption">Confirmation dialog before finalizing - this action cannot be undone</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/42-draft-finalized-success.png" alt="Finalized Success">
                <div class="screenshot-caption">Draft finalized successfully - moved to Finalized Runs</div>
            </div>

            <h3>Draft Actions</h3>
            <table>
                <thead>
                    <tr>
                        <th>Action</th>
                        <th>Description</th>
                        <th>When to Use</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Process</strong></td>
                        <td>Calculate payslips for all employees</td>
                        <td>After creating draft or making changes</td>
                    </tr>
                    <tr>
                        <td><strong>Recalculate</strong></td>
                        <td>Recalculate after attendance/leave changes</td>
                        <td>When attendance was corrected</td>
                    </tr>
                    <tr>
                        <td><strong>Finalize</strong></td>
                        <td>Lock draft and create finalized run</td>
                        <td>When ready for approval and payment</td>
                    </tr>
                    <tr>
                        <td><strong>Rename</strong></td>
                        <td>Change draft name</td>
                        <td>For organization purposes</td>
                    </tr>
                    <tr>
                        <td><strong>Delete</strong></td>
                        <td>Remove draft completely</td>
                        <td>If draft was created in error</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box warning">
                <span class="icon">&#9888;&#65039;</span>
                <div>
                    <strong>Important:</strong> Once a draft is finalized, it cannot be undone. Always review all payslips carefully before finalizing.
                </div>
            </div>
        </section>

        <!-- Section 7: Finalized Runs -->
        <section id="finalized-runs">
            <h2><span class="section-number">7</span> Finalized Runs</h2>
            <p>Finalized Runs are completed payroll periods ready for approval and payment. Once finalized, payslips are locked and cannot be modified.</p>

            <h3>Step-by-Step: Approving and Paying a Payroll Run</h3>

            <h4>Step 1: View the Finalized Runs Tab</h4>
            <div class="screenshot-container">
                <img src="images/payroll/43-finalized-runs-tab.png" alt="Finalized Runs Tab">
                <div class="screenshot-caption">Finalized Runs tab showing completed payroll runs</div>
            </div>

            <h4>Step 2: View Run Details</h4>
            <div class="screenshot-container">
                <img src="images/payroll/44-finalized-run-details.png" alt="Run Details">
                <div class="screenshot-caption">Detailed view of finalized run with all employee payslips</div>
            </div>

            <h4>Step 3: Approve the Run</h4>
            <p>Click Approve to mark the run as approved for payment:</p>

            <div class="screenshot-container">
                <img src="images/payroll/45-approve-run-confirm.png" alt="Approve Confirmation">
                <div class="screenshot-caption">Confirmation dialog for approving payroll run</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/46-run-approved-status.png" alt="Approved Status">
                <div class="screenshot-caption">Payroll run showing "Approved" status</div>
            </div>

            <h4>Step 4: Mark as Paid</h4>
            <p>After disbursing salaries, mark the run as paid:</p>

            <div class="screenshot-container">
                <img src="images/payroll/47-mark-paid-modal.png" alt="Mark Paid Modal">
                <div class="screenshot-caption">Mark as Paid modal to enter payment details</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/48-mark-paid-filled.png" alt="Mark Paid Filled">
                <div class="screenshot-caption">Payment details filled with date and reference number</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/49-run-paid-status.png" alt="Paid Status">
                <div class="screenshot-caption">Payroll run showing "Paid" status with payment reference</div>
            </div>

            <h3>Run Status Progression</h3>
            <table>
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Description</th>
                        <th>Next Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Processed</strong></td>
                        <td>Just finalized, awaiting approval</td>
                        <td>Approve</td>
                    </tr>
                    <tr>
                        <td><strong>Approved</strong></td>
                        <td>Approved for payment</td>
                        <td>Mark as Paid</td>
                    </tr>
                    <tr>
                        <td><strong>Paid</strong></td>
                        <td>Salaries disbursed</td>
                        <td>Complete</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box tip">
                <span class="icon">&#128161;</span>
                <div>
                    <strong>Export Options:</strong> Use the Export button to download CSV files for bank transfers or payroll records.
                </div>
            </div>
        </section>

        <!-- Section 8: Loans & Advances -->
        <section id="loans">
            <h2><span class="section-number">8</span> Loans & Advances</h2>
            <p>The Loans & Advances feature allows employees to apply for salary advances or loans that are automatically deducted from their monthly payroll as EMI.</p>

            <h3>Understanding Loan Types</h3>
            <table>
                <thead>
                    <tr>
                        <th>Loan Type</th>
                        <th>Description</th>
                        <th>Interest</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Salary Advance</strong></td>
                        <td>Short-term advance against upcoming salary</td>
                        <td>Usually interest-free</td>
                    </tr>
                    <tr>
                        <td><strong>Personal Loan</strong></td>
                        <td>Longer-term loan with EMI repayment</td>
                        <td>May include interest</td>
                    </tr>
                    <tr>
                        <td><strong>Emergency Loan</strong></td>
                        <td>Quick disbursement for emergencies</td>
                        <td>May be interest-free</td>
                    </tr>
                </tbody>
            </table>

            <h3>Step-by-Step: Complete Loan Lifecycle</h3>

            <h4>Step 1: View the Loans Tab</h4>
            <div class="screenshot-container">
                <img src="images/payroll/50-loans-tab-empty.png" alt="Loans Tab Empty">
                <div class="screenshot-caption">Empty Loans & Advances tab before any loans are created</div>
            </div>

            <h4>Step 2: Apply for a Loan</h4>
            <p>Click "Apply for Loan" to open the application modal:</p>

            <div class="screenshot-container">
                <img src="images/payroll/51-apply-loan-modal-empty.png" alt="Apply Loan Empty">
                <div class="screenshot-caption">Empty Apply for Loan modal</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/52-apply-loan-modal-filled.png" alt="Apply Loan Filled">
                <div class="screenshot-caption">Completed loan application with amount, tenure, and details</div>
            </div>

            <h4>Step 3: View Pending Loan</h4>
            <div class="screenshot-container">
                <img src="images/payroll/53-loan-pending-in-list.png" alt="Loan Pending">
                <div class="screenshot-caption">Loan application showing "Pending" status in the list</div>
            </div>

            <h4>Step 4: View Loan Details</h4>
            <div class="screenshot-container">
                <img src="images/payroll/54-loan-details-modal.png" alt="Loan Details">
                <div class="screenshot-caption">Loan details modal showing repayment schedule and terms</div>
            </div>

            <h4>Step 5: Approve the Loan (HR Admin)</h4>
            <div class="screenshot-container">
                <img src="images/payroll/55-approve-loan-confirm.png" alt="Approve Loan">
                <div class="screenshot-caption">Confirmation dialog for approving loan application</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/57-loan-approved-status.png" alt="Loan Approved">
                <div class="screenshot-caption">Loan showing "Approved" status after approval</div>
            </div>

            <h4>Step 6: Disburse the Loan</h4>
            <p>After approval, disburse the loan to the employee:</p>

            <div class="screenshot-container">
                <img src="images/payroll/64-disburse-loan-modal.png" alt="Disburse Loan Modal">
                <div class="screenshot-caption">Disburse Loan modal for entering payment details</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/65-disburse-loan-filled.png" alt="Disburse Loan Filled">
                <div class="screenshot-caption">Disbursement details with payment mode and reference number</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/66-loan-disbursed-active.png" alt="Loan Active">
                <div class="screenshot-caption">Loan showing "Active" status after disbursement</div>
            </div>

            <h4>Step 7: EMI Deduction in Payroll</h4>
            <p>Once active, the loan EMI is automatically deducted from monthly payroll:</p>

            <div class="screenshot-container">
                <img src="images/payroll/67-january-payroll-processed.png" alt="Payroll with Loan">
                <div class="screenshot-caption">January payroll showing employee with loan EMI deduction (lower net pay)</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/68-payslip-with-loan-emi.png" alt="Payslip with EMI">
                <div class="screenshot-caption">Payslip details showing Loan EMI of &#8377;5,208 as a deduction</div>
            </div>

            <h3>Loan Status Progression</h3>
            <table>
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Description</th>
                        <th>Next Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Pending</strong></td>
                        <td>Application submitted, awaiting HR review</td>
                        <td>Approve or Reject</td>
                    </tr>
                    <tr>
                        <td><strong>Approved</strong></td>
                        <td>Approved by HR, awaiting disbursement</td>
                        <td>Disburse</td>
                    </tr>
                    <tr>
                        <td><strong>Active</strong></td>
                        <td>Loan disbursed, EMI being deducted monthly</td>
                        <td>Automatic EMI</td>
                    </tr>
                    <tr>
                        <td><strong>Completed</strong></td>
                        <td>All EMIs paid, loan closed</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td><strong>Rejected</strong></td>
                        <td>Application rejected by HR</td>
                        <td>None</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box important">
                <span class="icon">&#8505;&#65039;</span>
                <div>
                    <strong>Automatic EMI:</strong> Once a loan is active, the EMI is automatically added as a deduction to the employee's monthly payslip. No manual intervention required.
                </div>
            </div>
        </section>

        <!-- Section 9: Arrears Management -->
        <section id="arrears">
            <h2><span class="section-number">9</span> Arrears Management</h2>
            <p>Arrears are salary differences that arise when salary changes are applied retroactively. The system automatically calculates arrears when you create a salary structure version with a past effective date.</p>

            <h3>Understanding Arrears</h3>
            <p>Arrears occur when:</p>
            <ul>
                <li>A salary structure is changed with a past effective date</li>
                <li>A salary increment is announced retroactively</li>
                <li>A new component is added with backdated effect</li>
            </ul>

            <h3>Step-by-Step: Creating Retroactive Arrears</h3>

            <h4>Step 1: View the Arrears Tab</h4>
            <div class="screenshot-container">
                <img src="images/payroll/58-arrears-tab-empty-state.png" alt="Arrears Empty">
                <div class="screenshot-caption">Empty Arrears tab when no arrears exist</div>
            </div>

            <h4>Step 2: Create a Version with Retroactive Date</h4>
            <p>In Salary Structures, create a new version with a past effective date:</p>

            <div class="screenshot-container">
                <img src="images/payroll/59-version-history-modal.png" alt="Version History">
                <div class="screenshot-caption">Version History showing existing version (v1)</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/60-create-version-modal.png" alt="Create Version">
                <div class="screenshot-caption">Creating a new version with retroactive effective date</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/61-create-version-filled-retroactive.png" alt="Version Filled">
                <div class="screenshot-caption">New version with increased Basic Pay (55%) effective November 1, 2025</div>
            </div>

            <div class="screenshot-container">
                <img src="images/payroll/62-version-created-two-versions.png" alt="Two Versions">
                <div class="screenshot-caption">Version History showing both v1 and v2</div>
            </div>

            <h4>Step 3: Manage Arrears</h4>
            <p>Click "Manage Arrears" to see calculated arrears for affected employees:</p>

            <div class="screenshot-container">
                <img src="images/payroll/63-manage-arrears-empty.png" alt="Manage Arrears">
                <div class="screenshot-caption">Manage Arrears modal showing pending arrears (if any payslips exist for the retroactive period)</div>
            </div>

            <h3>Arrears Calculation</h3>
            <table>
                <thead>
                    <tr>
                        <th>Element</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Old Salary</strong></td>
                        <td>What was paid based on previous structure version</td>
                    </tr>
                    <tr>
                        <td><strong>New Salary</strong></td>
                        <td>What should have been paid with new structure version</td>
                    </tr>
                    <tr>
                        <td><strong>Difference</strong></td>
                        <td>Arrear amount = New Salary - Old Salary</td>
                    </tr>
                    <tr>
                        <td><strong>Affected Months</strong></td>
                        <td>All months between effective date and current date</td>
                    </tr>
                </tbody>
            </table>

            <h3>Arrears Actions</h3>
            <table>
                <thead>
                    <tr>
                        <th>Action</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Apply</strong></td>
                        <td>Add arrear amount to next payroll</td>
                    </tr>
                    <tr>
                        <td><strong>Cancel</strong></td>
                        <td>Mark arrear as not applicable</td>
                    </tr>
                    <tr>
                        <td><strong>Bulk Apply</strong></td>
                        <td>Apply multiple arrears at once</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box tip">
                <span class="icon">&#128161;</span>
                <div>
                    <strong>Automatic Calculation:</strong> Arrears are automatically calculated when you create a structure version with a past effective date. The system compares what was paid vs what should have been paid for each affected month.
                </div>
            </div>
        </section>

        <!-- Section: Setup Checklist -->
        <section id="checklist">
            <h2><span class="section-number">&#10003;</span> Setup Checklist</h2>
            <p>Follow this checklist to ensure your payroll system is fully configured:</p>

            <ol class="steps">
                <li>
                    <strong>Create Salary Components</strong><br>
                    Define all earnings (Basic, HRA, Allowances) and deductions (PF, PT) your organization needs.
                </li>
                <li>
                    <strong>Create Salary Structures</strong><br>
                    Combine components into structures. Create at least one default structure.
                </li>
                <li>
                    <strong>Configure Location Taxes</strong><br>
                    Set up Professional Tax and other location-specific taxes for each office.
                </li>
                <li>
                    <strong>Assign Salaries to Employees</strong><br>
                    Assign salary structures with CTC to all employees via the Employees page.
                </li>
                <li>
                    <strong>Process Monthly Payroll</strong><br>
                    Create drafts, process, review, finalize, approve, and mark as paid each month.
                </li>
            </ol>

            <h3>Monthly Payroll Checklist</h3>
            <ol class="steps">
                <li><strong>Complete Attendance:</strong> Ensure all attendance is regularized and approved</li>
                <li><strong>Approve Leaves:</strong> Process all pending leave requests</li>
                <li><strong>Review Adjustments:</strong> Check for any pending salary adjustments</li>
                <li><strong>Create Payroll Draft:</strong> Create draft for the month</li>
                <li><strong>Process Draft:</strong> Calculate all payslips</li>
                <li><strong>Review Payslips:</strong> Check individual payslips for accuracy</li>
                <li><strong>Finalize Draft:</strong> Lock and create finalized run</li>
                <li><strong>Get Approval:</strong> Obtain management approval</li>
                <li><strong>Disburse Salaries:</strong> Process bank transfers</li>
                <li><strong>Mark as Paid:</strong> Record payment in system</li>
            </ol>

            <div class="info-box tip">
                <span class="icon">&#127881;</span>
                <div>
                    <strong>You're Ready!</strong> Once all these steps are complete, your payroll system is fully operational.
                </div>
            </div>
        </section>
    </main>

    <a href="#" class="back-to-top" title="Back to Top">&#8593;</a>

    <footer>
        <p>HyperDroid HRMS Knowledge Base | Last Updated: December 2025</p>
        <p>Need help? Contact <a href="mailto:support@hyperdroid.io">support@hyperdroid.io</a></p>
    </footer>

    <script>
        // ===== DOM Elements =====
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const html = document.documentElement;
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        // ===== Theme Handling =====
        function getPreferredTheme() {
            const saved = localStorage.getItem('kb-theme');
            if (saved) return saved;
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function applyTheme(theme) {
            if (theme === 'dark') {
                html.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '\u2600\uFE0F';
            } else {
                html.setAttribute('data-theme', 'light');
                themeIcon.textContent = '\uD83C\uDF19';
            }
        }

        applyTheme(getPreferredTheme());

        themeToggle.addEventListener('click', () => {
            const current = html.getAttribute('data-theme') || 'light';
            const newTheme = current === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            localStorage.setItem('kb-theme', newTheme);
        });

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('kb-theme')) {
                applyTheme(e.matches ? 'dark' : 'light');
            }
        });

        // ===== Collapsible Navigation Groups =====
        function toggleNavGroup(header) {
            const group = header.parentElement;
            group.classList.toggle('collapsed');

            // Save collapsed state to localStorage
            const groupIndex = Array.from(document.querySelectorAll('.nav-group')).indexOf(group);
            const collapsedGroups = JSON.parse(localStorage.getItem('kb-collapsed-groups-payroll') || '[]');

            if (group.classList.contains('collapsed')) {
                if (!collapsedGroups.includes(groupIndex)) {
                    collapsedGroups.push(groupIndex);
                }
            } else {
                const idx = collapsedGroups.indexOf(groupIndex);
                if (idx > -1) collapsedGroups.splice(idx, 1);
            }

            localStorage.setItem('kb-collapsed-groups-payroll', JSON.stringify(collapsedGroups));
        }

        // Restore collapsed states on load
        function restoreCollapsedStates() {
            const collapsedGroups = JSON.parse(localStorage.getItem('kb-collapsed-groups-payroll') || '[]');
            const groups = document.querySelectorAll('.nav-group');
            collapsedGroups.forEach(idx => {
                if (groups[idx]) {
                    groups[idx].classList.add('collapsed');
                }
            });
        }
        restoreCollapsedStates();

        // ===== Mobile Menu Toggle =====
        function openSidebar() {
            sidebar.classList.add('open');
            sidebarOverlay.classList.add('active');
            menuToggle.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
            menuToggle.classList.remove('active');
            document.body.style.overflow = '';
        }

        menuToggle.addEventListener('click', () => {
            if (sidebar.classList.contains('open')) {
                closeSidebar();
            } else {
                openSidebar();
            }
        });

        sidebarOverlay.addEventListener('click', closeSidebar);

        // Close sidebar on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && sidebar.classList.contains('open')) {
                closeSidebar();
            }
        });

        // ===== Smooth Scroll for Sidebar Links =====
        document.querySelectorAll('.sidebar a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    // Close mobile sidebar if open
                    if (window.innerWidth <= 900) {
                        closeSidebar();
                    }

                    // Smooth scroll with offset
                    const offset = 120;
                    const targetPosition = target.getBoundingClientRect().top + window.scrollY - offset;
                    window.scrollTo({ top: targetPosition, behavior: 'smooth' });
                }
            });
        });

        // ===== Active Section Highlighting (Intersection Observer) =====
        const sections = document.querySelectorAll('main > section[id]');
        const navLinks = document.querySelectorAll('.sidebar a[href^="#"]');

        const observerOptions = {
            root: null,
            rootMargin: '-10% 0px -70% 0px',
            threshold: 0
        };

        function setActiveLink(sectionId) {
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + sectionId) {
                    link.classList.add('active');

                    // Expand the parent group if collapsed
                    const group = link.closest('.nav-group');
                    if (group && group.classList.contains('collapsed')) {
                        group.classList.remove('collapsed');
                    }

                    // Scroll link into view in sidebar if needed
                    if (window.innerWidth > 900) {
                        link.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                    }
                }
            });
        }

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    setActiveLink(entry.target.id);
                }
            });
        }, observerOptions);

        sections.forEach(section => {
            observer.observe(section);
        });

        // ===== Back to Top Button =====
        const backToTop = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 500) {
                backToTop.style.display = 'flex';
            } else {
                backToTop.style.display = 'none';
            }
        });
        backToTop.style.display = 'none';

        // ===== Handle Resize Events =====
        window.addEventListener('resize', () => {
            // Close mobile sidebar when resizing to desktop
            if (window.innerWidth > 900 && sidebar.classList.contains('open')) {
                closeSidebar();
            }
        });
    </script>
</body>
</html>
